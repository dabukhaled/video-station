const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jszip.min-cDX0RZc0.js","assets/react-vendor-BRY8hXab.js"])))=>i.map(i=>d[i]);
import{r as nr,a as ir,g as cr}from"./react-vendor-BRY8hXab.js";import{r as o,T as Ss,R as Qe,a as Pe,L as Ct,X as Ue,F as ke,S as dt,b as Ce,C as Is,P as na,c as Zs,d as dr,V as Ul,e as rs,f as zt,g as St,h as Qs,G as xr,i as Ps,j as ur,D as Bt,k as ia,l as Js,m as at,n as ct,E as ca,o as zl,p as Ks,A as da,q as xa,U as Ns,s as vs,t as Bl,u as Yl,M as hr,v as Jl,w as mr,x as pr,H as gr,W as br,y as fr,z as Gl,B as Gs,I as Ws,J as Wl,K as Xl,N as Hl,O as Ql,Q as yr,Y as jr,Z as wr,_ as Kl,$ as Nr,a0 as vr}from"./icons-BbuTH86C.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const x of document.querySelectorAll('link[rel="modulepreload"]'))c(x);new MutationObserver(x=>{for(const m of x)if(m.type==="childList")for(const p of m.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&c(p)}).observe(document,{childList:!0,subtree:!0});function i(x){const m={};return x.integrity&&(m.integrity=x.integrity),x.referrerPolicy&&(m.referrerPolicy=x.referrerPolicy),x.crossOrigin==="use-credentials"?m.credentials="include":x.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function c(x){if(x.ep)return;x.ep=!0;const m=i(x);fetch(x.href,m)}})();var Xs={exports:{}},ls={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zl;function kr(){if(Zl)return ls;Zl=1;var n=nr(),u=Symbol.for("react.element"),i=Symbol.for("react.fragment"),c=Object.prototype.hasOwnProperty,x=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,m={key:!0,ref:!0,__self:!0,__source:!0};function p(g,$,M){var S,z={},_=null,I=null;M!==void 0&&(_=""+M),$.key!==void 0&&(_=""+$.key),$.ref!==void 0&&(I=$.ref);for(S in $)c.call($,S)&&!m.hasOwnProperty(S)&&(z[S]=$[S]);if(g&&g.defaultProps)for(S in $=g.defaultProps,$)z[S]===void 0&&(z[S]=$[S]);return{$$typeof:u,type:g,key:_,ref:I,props:z,_owner:x.current}}return ls.Fragment=i,ls.jsx=p,ls.jsxs=p,ls}var ea;function Cr(){return ea||(ea=1,Xs.exports=kr()),Xs.exports}var e=Cr(),ks={},ta;function Sr(){if(ta)return ks;ta=1;var n=ir();return ks.createRoot=n.createRoot,ks.hydrateRoot=n.hydrateRoot,ks}var Ir=Sr();const Pr=cr(Ir),Er="modulepreload",Mr=function(n){return"/video-station/"+n},sa={},Lr=function(u,i,c){let x=Promise.resolve();if(i&&i.length>0){let p=function(M){return Promise.all(M.map(S=>Promise.resolve(S).then(z=>({status:"fulfilled",value:z}),z=>({status:"rejected",reason:z}))))};document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),$=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));x=p(i.map(M=>{if(M=Mr(M),M in sa)return;sa[M]=!0;const S=M.endsWith(".css"),z=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${M}"]${z}`))return;const _=document.createElement("link");if(_.rel=S?"stylesheet":Er,S||(_.as="script"),_.crossOrigin="",_.href=M,$&&_.setAttribute("nonce",$),document.head.appendChild(_),S)return new Promise((I,Y)=>{_.addEventListener("load",I),_.addEventListener("error",()=>Y(new Error(`Unable to preload CSS for ${M}`)))})}))}function m(p){const g=new Event("vite:preloadError",{cancelable:!0});if(g.payload=p,window.dispatchEvent(g),!g.defaultPrevented)throw p}return x.then(p=>{for(const g of p||[])g.status==="rejected"&&m(g.reason);return u().catch(m)})},as=n=>{const u=new Set,i=new Set;n.forEach(x=>{x.parentId||u.add(x.id)});let c=!0;for(;c;)c=!1,n.forEach(x=>{x.parentId&&!u.has(x.id)&&!i.has(x.id)&&(u.has(x.parentId)?(u.add(x.id),c=!0):i.has(x.parentId)?i.add(x.id):n.some(p=>p.id===x.parentId)||i.add(x.id))});return n.filter(x=>u.has(x.id))},Xe=(n,u)=>{const i=new Set,c=[n];for(;c.length>0;){const x=c.shift();if(x&&!i.has(x)){i.add(x);const m=u.filter(p=>p.parentId===x);for(const p of m)c.push(p.id)}}return i},ua=o.createContext(void 0),Dr=({children:n})=>{const[u,i]=o.useState({}),[c,x]=o.useState({}),[m,p]=o.useState(!1),g=()=>{const M={position:"fixed",top:"0",right:"-45vw",width:"40vw",height:"100vh",zIndex:99998,transform:"none"},S={position:"fixed",top:"0",right:"0",width:"40vw",height:"100vh",borderRadius:"0",zIndex:99999,transform:"none"};i(M),x(S),p(!0)},$=()=>{i({}),x({}),p(!1)};return e.jsx(ua.Provider,{value:{controlPanelModalStyle:u,itemManagementModalStyle:c,isRepositioned:m,repositionModalsForPreview:g,resetModalPositions:$},children:n})},el=()=>{const n=o.useContext(ua);if(n===void 0)throw new Error("useModalPositions must be used within a ModalPositionProvider");return n},Tr="VideoStationDB",$r=2,oe={REPOSITORY:"repository",PLAYLIST:"playlist",CATEGORIES:"categories",SETTINGS:"settings",SAVED_PLAYLISTS:"savedPlaylists"},xt={MAIN_REPOSITORY:"main_repository",MAIN_PLAYLIST:"main_playlist",USER_CATEGORIES:"user_categories",USER_SETTINGS:"user_settings"},os=()=>new Promise((n,u)=>{const i=indexedDB.open(Tr,$r);i.onerror=c=>{console.error("Database error:",c.target.error),u(c.target.error)},i.onsuccess=c=>{n(c.target.result)},i.onupgradeneeded=c=>{const x=c.target.result;c.target.transaction,x.objectStoreNames.contains(oe.REPOSITORY)||x.createObjectStore(oe.REPOSITORY),x.objectStoreNames.contains(oe.PLAYLIST)||x.createObjectStore(oe.PLAYLIST),x.objectStoreNames.contains(oe.CATEGORIES)||x.createObjectStore(oe.CATEGORIES),x.objectStoreNames.contains(oe.SETTINGS)||x.createObjectStore(oe.SETTINGS),x.objectStoreNames.contains(oe.SAVED_PLAYLISTS)||x.createObjectStore(oe.SAVED_PLAYLISTS,{keyPath:"id"}),c.oldVersion<2&&console.log("Database upgraded to version 2.")}}),Ms=async(n,u,i)=>{const c=await os();return new Promise((x,m)=>{const $=c.transaction([n],"readwrite").objectStore(n).put(u,i);$.onsuccess=()=>x(),$.onerror=()=>{console.error(`Error saving to ${n}:`,$.error),m($.error)}})},Ls=async(n,u)=>{const i=await os();return new Promise((c,x)=>{const g=i.transaction([n],"readonly").objectStore(n).get(u);g.onsuccess=()=>{c(g.result||null)},g.onerror=()=>{console.error(`Error loading from ${n}:`,g.error),x(g.error)}})},tl=n=>Ms(oe.REPOSITORY,n,xt.MAIN_REPOSITORY),ha=()=>Ls(oe.REPOSITORY,xt.MAIN_REPOSITORY),ma=n=>Ms(oe.PLAYLIST,n,xt.MAIN_PLAYLIST),Rr=()=>Ls(oe.PLAYLIST,xt.MAIN_PLAYLIST),pa=n=>Ms(oe.CATEGORIES,n,xt.USER_CATEGORIES),_r=()=>Ls(oe.CATEGORIES,xt.USER_CATEGORIES),sl=n=>Ms(oe.SETTINGS,n,xt.USER_SETTINGS),Ar=()=>Ls(oe.SETTINGS,xt.USER_SETTINGS),la=async n=>{const u=await os();return new Promise((i,c)=>{const p=u.transaction([oe.SAVED_PLAYLISTS],"readwrite").objectStore(oe.SAVED_PLAYLISTS).put(n);p.onsuccess=()=>i(),p.onerror=()=>c(p.error)})},Cs=async()=>{const n=await os();return new Promise((u,i)=>{const m=n.transaction([oe.SAVED_PLAYLISTS],"readonly").objectStore(oe.SAVED_PLAYLISTS).getAll();m.onsuccess=()=>u(m.result||[]),m.onerror=()=>i(m.error)})},Or=async n=>{const u=await os();return new Promise((i,c)=>{const p=u.transaction([oe.SAVED_PLAYLISTS],"readwrite").objectStore(oe.SAVED_PLAYLISTS).delete(n);p.onsuccess=()=>i(),p.onerror=()=>c(p.error)})},qr=async()=>{const[n,u,i,c]=await Promise.all([ha(),Rr(),_r(),Ar()]);return{repository:n,playlist:u,categories:i,settings:c}},Fr=async n=>{const u=[];n.repository!==void 0&&u.push(tl(n.repository)),n.playlist!==void 0&&u.push(ma(n.playlist)),n.categories!==void 0&&u.push(pa(n.categories)),n.settings!==void 0&&u.push(sl(n.settings)),await Promise.all(u)},Hs=async n=>{const u=await ha()||[],i=new Map;u.forEach(x=>i.set(x.id,x)),n.forEach(x=>{const m=i.get(x.id);m?x.timestamp>m.timestamp&&i.set(x.id,x):i.set(x.id,x)});const c=Array.from(i.values());return await new Promise(x=>setTimeout(x,50)),await tl(c),c},Vr={error:"#ef4444"},K={info:(n,...u)=>{},warn:(n,...u)=>{},error:(n,...u)=>{console.error(`%c❌ ${n}`,`color: ${Vr.error}; font-weight: bold;`,...u)},debug:(n,...u)=>{},success:(n,...u)=>{},progress:(n,u,i,...c)=>{}};async function Ur(){try{K.info("Attempting to load from database_chunks...");const n=await zr();return n?(K.success("Successfully loaded from database_chunks"),n):(K.warn("database_chunks not found, falling back to video-station-data.json"),await Br())}catch(n){return K.error("Failed to load initial data from all sources:",n),null}}async function zr(){var n,u,i;try{let c=await fetch("/database_chunks/quick-load-data.json");if(c.ok||(K.warn(`Quick load file not found at absolute path: ${c.statusText}`),c=await fetch("./database_chunks/quick-load-data.json")),!c.ok)return K.warn(`Quick load file not found: ${c.statusText}`),null;const x=await c.text(),m=JSON.parse(x),g=m&&m.quickLoad&&Array.isArray(m.quickLoad.repository)?m.quickLoad:m;return K.info("Quick load data loaded successfully"),{version:"2.0",metadata:m.metadata||{totalItems:((n=g==null?void 0:g.repository)==null?void 0:n.length)||0,quickLoadItems:((u=g==null?void 0:g.repository)==null?void 0:u.length)||0,fullLoadItems:0,lastUpdated:new Date().toISOString(),categories:((i=g==null?void 0:g.categories)==null?void 0:i.length)||0},quickLoad:g||{categories:[],settings:{},playlist:[],savedPlaylists:[],repository:[]},fullLoad:{repository:[]}}}catch(c){return K.warn("Failed to load from database_chunks:",c),null}}async function Br(){try{const n=await fetch("./video-station-data.json");if(!n.ok){K.warn(`Failed to fetch video-station-data.json from relative path: ${n.statusText}`);const c=await fetch("/video-station-data.json");if(!c.ok)return K.error("Fallback fetch also failed. Cannot load data."),null;const x=await c.text(),m=JSON.parse(x);return aa(m)}const u=await n.text(),i=JSON.parse(u);return aa(i)}catch(n){return K.error("Failed to load from single file:",n),null}}function aa(n){return n.version==="2.0"&&n.quickLoad?(K.success("Loaded new format data (v2.0)"),n):(K.warn("Legacy format detected, converting..."),Yr(n))}function Yr(n){const u=n.repository||[],i=n.categories||[],c=n.playlist||[],x=n.savedPlaylists||[],m=n.settings||{},p=new Map;u.forEach(M=>{const S=M.categoryId||"default";p.has(S)||p.set(S,[]),p.get(S).push(M)});const g=[],$=[];return p.forEach(M=>{const S=M.slice(0,200),z=M.slice(200);g.push(...S),$.push(...z)}),{version:"2.0",metadata:{totalItems:u.length,quickLoadItems:g.length,fullLoadItems:$.length,lastUpdated:new Date().toISOString(),categories:i.length},quickLoad:{categories:i,settings:m,playlist:c,savedPlaylists:x,repository:g},fullLoad:{repository:$}}}function Ke(n,u){const i=new Map;return n.forEach(c=>i.set(c.id,c)),u.forEach(c=>{const x=i.get(c.id);x&&c.timestamp&&x.timestamp?c.timestamp>x.timestamp&&i.set(c.id,c):i.set(c.id,c)}),Array.from(i.values())}function Jr(n){const{quickLoadItems:u}=Gr(n.repository),i=new Set;n.playlist.forEach(g=>{g.videoId&&i.add(g.videoId)}),n.savedPlaylists.forEach(g=>{g.items.forEach($=>{$.videoId&&i.add($.videoId)})});const c=n.repository.filter(g=>i.has(g.id)),x=Ke(u,c),m=new Set(x.map(g=>g.id)),p=n.repository.filter(g=>!m.has(g.id));return{version:"2.0",metadata:{totalItems:n.repository.length,quickLoadItems:x.length,fullLoadItems:p.length,lastUpdated:new Date().toISOString(),categories:n.categories.length},quickLoad:{categories:n.categories,settings:n.settings,playlist:n.playlist,savedPlaylists:n.savedPlaylists,repository:x},fullLoad:{repository:p}}}function Gr(n,u){const i=new Map;n.forEach(m=>{const p=m.categoryId||"default";i.has(p)||i.set(p,[]),i.get(p).push(m)});const c=[],x=[];return i.forEach(m=>{const p=m.slice(0,200),g=m.slice(200);c.push(...p),x.push(...g)}),{quickLoadItems:c,fullLoadItems:x}}function Wr(n){const{repository:u,categories:i,playlist:c,savedPlaylists:x,settings:m}=n,p=i.filter(E=>!E.parentId),g=E=>{const W=[E];return i.filter(L=>L.parentId===E).forEach(L=>{W.push(...g(L.id))}),W},$=new Map;p.forEach(E=>{const W=g(E.id),N=u.filter(L=>W.includes(L.categoryId||""));$.set(E.id,N)});const M=[];p.forEach(E=>{const N=($.get(E.id)||[]).slice(0,200);M.push(...N)});const S=new Set;c.forEach(E=>{E.videoId&&S.add(E.videoId)}),x.forEach(E=>{E.items.forEach(W=>{W.videoId&&S.add(W.videoId)})});const z=u.filter(E=>S.has(E.id)),_=new Set(M.map(E=>E.id));z.forEach(E=>{_.has(E.id)||(M.push(E),_.add(E.id))});const I={version:"2.0",metadata:{totalItems:M.length,quickLoadItems:M.length,fullLoadItems:0,lastUpdated:new Date().toISOString(),categories:i.length},quickLoad:{categories:i,settings:m,playlist:c,savedPlaylists:x,repository:M},fullLoad:{repository:[]}},Y=new Map;return p.forEach(E=>{const W=$.get(E.id)||[];W.length>0&&Y.set(E.id,{version:"2.0-category-chunk",metadata:{categoryId:E.id,categoryName:E.name,totalItems:W.length,lastUpdated:new Date().toISOString()},repository:W})}),{quickLoadChunk:I,categoryChunks:Y}}function Xr(n,u){const i=[];for(let c=0;c<n.length;c+=u)i.push(n.slice(c,c+u));return i}function Hr(n){return new Promise(u=>setTimeout(u,n))}const Es=n=>{const u={ا:"a",أ:"a",إ:"i",آ:"aa",ب:"b",ت:"t",ث:"th",ج:"j",ح:"h",خ:"kh",د:"d",ذ:"dh",ر:"r",ز:"z",س:"s",ش:"sh",ص:"s",ض:"d",ط:"t",ظ:"z",ع:"a",غ:"gh",ف:"f",ق:"q",ك:"k",ل:"l",م:"m",ن:"n",ه:"h",و:"w",ي:"y",ى:"a",ة:"h",ء:"a"," ":"_","-":"_",".":"_"};let i="";for(let c=0;c<n.length;c++){const x=n[c];i+=u[x]||x}return i=i.replace(/[^a-zA-Z0-9_]/g,""),i.length<2&&(i="category_"+Math.random().toString(36).substr(2,6)),i.toLowerCase()};async function Qr(){const n="/database_chunks";try{K.info("Starting manual data sync from chunks...");const u=await fetch(`${n}/quick-load-data.json`);if(!u.ok){const _=await fetch("./database_chunks/quick-load-data.json");if(!_.ok)return K.error(`Failed to fetch quick-load-data.json: ${u.statusText}`),null;const I=await _.json(),E=I&&I.quickLoad&&Array.isArray(I.quickLoad.repository)?I.quickLoad:I;if(!E||!Array.isArray(E.repository))return K.error("Quick load chunk is invalid."),null;let W=[...E.repository];const N=E.categories||[],L=E.settings||{},H=E.playlist||[],Z=N.filter(ye=>!ye.parentId);let re=0;return await Promise.all(Z.map(async ye=>{const ge=`category-${Es(ye.name)}.json`,Ze=`./database_chunks/${ge}`;try{const ue=await fetch(Ze);if(!ue.ok){K.warn(`Category chunk not found for ${ye.name} (${ge})`);const ne=`category-${ye.name.replace(/[^a-z0-9]/gi,"_")}.json`;if(ne!==ge){const he=await fetch(`./database_chunks/${ne}`);if(he.ok){const fe=await he.json();if(fe!=null&&fe.repository){W=Ke(W,fe.repository),re++,K.success(`Loaded chunk for category (fallback): ${ye.name}`);return}}}return}const Te=await ue.json();Te&&Array.isArray(Te.repository)&&(W=Ke(W,Te.repository),re++,K.success(`Loaded chunk for category: ${ye.name}`))}catch(ue){K.warn(`Error loading category chunk for ${ye.name}:`,ue)}})),K.success(`Manual sync complete! Loaded ${re} category chunks.`),{version:"2.0-manual-sync",metadata:{totalItems:W.length,quickLoadItems:E.repository.length,fullLoadItems:W.length-E.repository.length,lastUpdated:new Date().toISOString(),categories:N.length},quickLoad:E,fullLoad:{repository:W}}}const i=await u.json(),x=i&&i.quickLoad&&Array.isArray(i.quickLoad.repository)?i.quickLoad:i;if(!x||!Array.isArray(x.repository))return K.error("Quick load chunk is invalid."),null;let m=[...x.repository];const p=x.categories||[],g=x.settings||{},$=x.playlist||[],M=p.filter(_=>!_.parentId);let S=0;return await Promise.all(M.map(async _=>{const Y=`category-${Es(_.name)}.json`,E=`${n}/${Y}`;try{const W=await fetch(E);if(!W.ok){K.warn(`Category chunk not found for ${_.name} (${Y})`);const L=`category-${_.name.replace(/[^a-z0-9]/gi,"_")}.json`;if(L!==Y){const H=await fetch(`${n}/${L}`);if(H.ok){const Z=await H.json();if(Z!=null&&Z.repository){m=Ke(m,Z.repository),S++,K.success(`Loaded chunk for category (fallback): ${_.name}`);return}}}return}const N=await W.json();N&&Array.isArray(N.repository)&&(m=Ke(m,N.repository),S++,K.success(`Loaded chunk for category: ${_.name}`))}catch(W){K.warn(`Error loading category chunk for ${_.name}:`,W)}})),K.success(`Manual sync complete! Loaded ${S} category chunks.`),{version:"2.0-manual-sync",metadata:{totalItems:m.length,quickLoadItems:x.repository.length,fullLoadItems:m.length-x.repository.length,lastUpdated:new Date().toISOString(),categories:p.length},quickLoad:x,fullLoad:{repository:m}}}catch(u){return K.error("Failed to manually sync data from chunks:",u),null}}async function ra(n,u){const i="/database_chunks",c=n.filter(g=>!g.parentId);let x=0,m=0;const p=[];return await Promise.all(c.map(async g=>{const M=`category-${Es(g.name)}.json`,S=`${i}/${M}`;try{const z=await fetch(S);if(!z.ok){const I=`category-${g.name.replace(/[^a-z0-9]/gi,"_")}.json`;if(I!==M){let Y=await fetch(`${i}/${I}`);if(Y.ok||(Y=await fetch(`./database_chunks/${I}`)),Y.ok){const E=await Y.json();if(E!=null&&E.repository&&E.repository.length>0){u(E.repository),x++;return}}}m++,p.push(`Failed to load ${g.name}: ${z.statusText}`);return}const _=await z.json();_&&Array.isArray(_.repository)&&_.repository.length>0&&u(_.repository),x++}catch(z){m++,p.push(`Error loading ${g.name}: ${z}`),console.warn(`Background load: Error loading category chunk for ${g.name}:`,z)}})),{success:x,failed:m,errors:p}}function Kr(n,u,i){const c=i.find(m=>m.id===n);if(!c)return K.error(`Category ${n} not found`),null;const x=u.filter(m=>m.categoryId===n);return{version:"2.0-single-category",metadata:{categoryId:c.id,categoryName:c.name,totalItems:x.length,lastUpdated:new Date().toISOString()},repository:x}}class Zr extends o.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null}}static getDerivedStateFromError(u){return{hasError:!0,error:u}}componentDidCatch(u,i){console.error("Uncaught error:",u,i)}render(){var u;return this.state.hasError?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full w-full bg-slate-900 text-slate-200 p-8 text-center",children:[e.jsx(Ss,{className:"w-16 h-16 text-yellow-500 mb-4"}),e.jsx("h1",{className:"text-2xl font-bold mb-2",children:"عذراً، حدث خطأ غير متوقع"}),e.jsx("p",{className:"text-slate-400 mb-6 max-w-lg",children:((u=this.state.error)==null?void 0:u.message)||"حدث خطأ أثناء عرض هذا العنصر."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>window.location.reload(),className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded-lg font-bold transition-all",children:[e.jsx(Qe,{className:"w-4 h-4"}),"إعادة تحميل التطبيق"]}),e.jsx("button",{onClick:()=>this.setState({hasError:!1,error:null}),className:"flex items-center gap-2 bg-slate-700 hover:bg-slate-600 text-white px-6 py-2 rounded-lg font-bold transition-all",children:"محاولة الاستمرار"})]})]}):this.props.children}}const eo=({isOpen:n,onClose:u,repository:i,setRepository:c,categories:x,settings:m,setSettings:p,handleDeleteItems:g,handleMoveItems:$,handlePreviewItem:M,handleEditVideo:S,setEditingVideo:z,setShowEditModal:_,initialSelectedItems:I,setInitialSelectedItems:Y})=>{const[E,W]=o.useState(null),[N,L]=o.useState([]),[H,Z]=o.useState(!1),[re,F]=o.useState(""),[ye,ze]=o.useState(!1),[ge,Ze]=o.useState(""),[ue,Te]=o.useState(-1),[ne,he]=o.useState(-1),fe=o.useRef(null);o.useEffect(()=>{n?(L(I),Y(I),I.length>0?ze(!0):ze(!1),F(""),Z(!1),Te(-1),he(-1)):(Y([]),L([]))},[n,I,Y]);const ie=f=>{typeof f=="function"?L(P=>{const J=f(P);return Y(J),J}):(L(f),Y(f))},[$e,It]=o.useState(!1),[Be,Pt]=o.useState([]),[Se,ut]=o.useState("websites"),[Ee,Et]=o.useState({x:0,y:0}),[qe,et]=o.useState(!1),[ce,Re]=o.useState({x:0,y:0}),{itemManagementModalStyle:ht,isRepositioned:_e,resetModalPositions:Yt}=el();o.useEffect(()=>{n||Yt()},[n,Yt]);const Jt=f=>{et(!0),Re({x:f.clientX-Ee.x,y:f.clientY-Ee.y})},Mt=Pe.useCallback(f=>{qe&&Et({x:f.clientX-ce.x,y:f.clientY-ce.y})},[qe,ce]),Lt=Pe.useCallback(()=>{et(!1)},[]);Pe.useEffect(()=>(qe?(document.addEventListener("mousemove",Mt),document.addEventListener("mouseup",Lt)):(document.removeEventListener("mousemove",Mt),document.removeEventListener("mouseup",Lt)),()=>{document.removeEventListener("mousemove",Mt),document.removeEventListener("mouseup",Lt)}),[qe,Mt,Lt]);const Dt=o.useMemo(()=>x.filter(f=>f.type==="websites"),[x]),mt=o.useMemo(()=>x.filter(f=>f.type==="elements"),[x]),G=o.useMemo(()=>{if(!E)return[];const f=i.filter(P=>P.categoryId===E&&(ge===""||P.url.toLowerCase().includes(ge.toLowerCase())));switch(m.itemsSortOrder){case"newest":return f.sort((P,J)=>J.timestamp-P.timestamp);case"oldest":return f.sort((P,J)=>P.timestamp-J.timestamp);case"alphabetical":return f.sort((P,J)=>P.title.localeCompare(J.title));case"random":return f.sort(()=>.5-Math.random());default:return f.sort((P,J)=>P.title.localeCompare(J.title))}},[i,E,ge,m.itemsSortOrder]);o.useEffect(()=>{Te(-1),ie([]),Z(!1),he(-1)},[E,ge]),o.useEffect(()=>{if(!n||!fe.current)return;const f=P=>{const J=fe.current;if(!J)return;const le=G,se=le.length;if(se===0)return;let me=ue,A=!1;if(P.key==="ArrowDown")me=Math.min(ue+1,se-1),A=!0;else if(P.key==="ArrowUp")me=Math.max(ue-1,0),A=!0;else if(P.key===" "){if(ue!==-1){const B=le[ue].id;ie(Q=>Q.includes(B)?Q.filter(pe=>pe!==B):[...Q,B]),he(ue)}A=!0}else P.key==="a"&&(P.ctrlKey||P.metaKey)&&(N.length===se?(ie([]),Z(!1)):(ie(le.map(B=>B.id)),Z(!0)),A=!0);if(A&&(P.preventDefault(),P.stopPropagation()),me!==ue){Te(me);const B=J.children[me];B&&B.scrollIntoView({behavior:"smooth",block:"nearest"})}if(P.shiftKey&&(P.key==="ArrowUp"||P.key==="ArrowDown"))if(ne===-1)ie(B=>{const Q=le[ue].id;return B.includes(Q)?B:[...B,Q]}),he(ue);else{const B=Math.min(ne,me),Q=Math.max(ne,me);le.slice(B,Q+1).map(pe=>pe.id),ie(pe=>{const Ne=new Set(pe);if(P.key==="ArrowDown")for(let de=ne;de<=me;de++)Ne.add(le[de].id);else for(let de=me;de<=ne;de++)Ne.add(le[de].id);return Array.from(Ne)})}};return fe.current.focus(),fe.current.addEventListener("keydown",f),()=>{var P;(P=fe.current)==null||P.removeEventListener("keydown",f)}},[n,ue,G,N,ne]),o.useEffect(()=>{ye||F("")},[ye]),o.useEffect(()=>{n&&(ze(!1),F(""))},[n]);const tt=f=>{const P=new Map;return f.forEach(J=>{try{const se=new URL(J.url).hostname;P.has(se)||P.set(se,[]),P.get(se).push(J)}catch{const se="Other";P.has(se)||P.set(se,[]),P.get(se).push(J)}}),P};return n?e.jsx("div",{className:_e?"z-[201]":"fixed inset-0 bg-black/80 backdrop-blur-sm z-[201] flex items-center justify-center p-6",style:_e?ht:{...ht,transform:`translate(${Ee.x}px, ${Ee.y}px)`},children:e.jsxs("div",{className:`bg-slate-900 border border-slate-700 w-full max-w-6xl ${_e?"h-full rounded-none":"h-[90vh] rounded-2xl"} shadow-2xl flex flex-col overflow-hidden`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800 bg-slate-950/80",onMouseDown:Jt,children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ct,{className:"text-cyan-500"})," إدارة العناصر"]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:e.jsx(Ue,{className:"w-5 h-5 text-slate-400"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-900 text-slate-200",dir:"ltr",children:e.jsx("div",{dir:"rtl",className:"h-full",children:e.jsxs("div",{className:`grid ${_e?"grid-cols-1":"grid-cols-3"} gap-6 h-full relative`,children:[e.jsx("div",{className:`${_e?"hidden":"col-span-1"} border-l border-slate-800 p-2 overflow-y-auto`,dir:"ltr",children:e.jsxs("div",{dir:"rtl",children:[e.jsx("h3",{className:"font-bold text-slate-300 mb-4 sticky top-0 bg-slate-900 pb-2 border-b border-slate-800",children:"الأقسام"}),e.jsx("div",{className:"space-y-1",children:x.map(f=>e.jsxs("button",{onClick:()=>{W(f.id),L([]),Z(!1)},className:`w-full flex items-center justify-between p-3 rounded-lg text-sm transition-colors ${E===f.id?"bg-cyan-900/30 text-cyan-400 border border-cyan-900/50":"text-slate-400 hover:bg-slate-800 hover:text-slate-200"}`,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),f.name]}),e.jsx("span",{className:"text-[10px] bg-slate-800 px-2 py-0.5 rounded-full",children:i.filter(P=>P.categoryId===f.id).length})]},f.id))})]})}),e.jsx("div",{className:`${_e?"col-span-1":"col-span-2"} flex flex-col h-full overflow-hidden`,children:E?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-2 border-b border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:N.length===G.length&&G.length>0,onChange:f=>{const P=f.target.checked;Z(P),ie(P?G.map(J=>J.id):[])},className:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-cyan-500 focus:ring-cyan-500"}),e.jsx("span",{className:"text-sm font-bold text-slate-300",children:N.length>0?`تم تحديد ${N.length} عنصر`:"تحديد الكل"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>It(!$e),className:`px-3 py-1.5 rounded text-xs flex items-center gap-1 transition-colors ${$e?"bg-indigo-600 text-white":"bg-slate-800 text-slate-400 hover:bg-slate-700"}`,title:"تجميع حسب الموقع",children:[e.jsx(ke,{className:"w-3 h-3"}),$e?"عرض القائمة":"تجميع حسب الموقع"]}),e.jsx("input",{type:"text",placeholder:"تصفية حسب الرابط...",value:ge,onChange:f=>Ze(f.target.value),className:"bg-slate-800 border border-slate-700 rounded-lg p-1.5 text-xs text-white placeholder-slate-500"}),N.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{i.filter(P=>N.includes(P.id)).forEach(P=>M(P))},className:"px-3 py-1.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded text-xs flex items-center gap-1",children:[e.jsx(dt,{className:"w-3 h-3"})," معاينة"]}),e.jsxs("button",{onClick:()=>ze(!0),className:"px-3 py-1.5 bg-blue-900/30 hover:bg-blue-900/50 text-blue-400 rounded text-xs flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3"})," نقل"]}),e.jsxs("button",{onClick:()=>{g(N),L([]),Z(!1)},className:"px-3 py-1.5 bg-red-900/30 hover:bg-red-900/50 text-red-400 rounded text-xs flex items-center gap-1",children:[e.jsx(Ce,{className:"w-3 h-3"})," حذف"]})]})]})]}),e.jsx("div",{ref:fe,tabIndex:0,className:"flex-1 overflow-y-auto space-y-2 pr-2 outline-none focus:ring-2 focus:ring-cyan-500 rounded-lg",dir:"ltr",children:e.jsx("div",{dir:"rtl",children:G.length>0?$e?Array.from(tt(G).entries()).sort(([,f],[,P])=>P.length-f.length).map(([f,P],J)=>{const le=Be.includes(f),se=P.every(A=>N.includes(A.id)),me=()=>{const A=P.map(B=>B.id);ie(se?B=>B.filter(Q=>!A.includes(Q)):B=>Array.from(new Set([...B,...A])))};return e.jsxs("div",{className:"bg-slate-800/40 rounded-lg p-2 border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer p-2",onClick:()=>Pt(A=>A.includes(f)?A.filter(B=>B!==f):[...A,f]),children:[e.jsx("input",{type:"checkbox",checked:se,onChange:me,onClick:A=>A.stopPropagation(),className:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-indigo-500 focus:ring-indigo-500"}),e.jsxs("span",{className:"text-sm font-mono text-slate-500 w-8 text-right pr-2",children:[J+1,"."]}),e.jsx(Is,{className:`w-4 h-4 transition-transform duration-200 ${le?"rotate-90":""}`}),e.jsx("span",{className:"font-bold text-slate-300",children:f}),e.jsx("span",{className:"text-xs text-slate-500 bg-slate-700 px-2 py-0.5 rounded-full",children:P.length})]}),le&&e.jsx("div",{className:"pl-8 pt-2 space-y-1",children:P.map(A=>{const B=N.includes(A.id);return e.jsxs("div",{className:"flex items-center justify-between gap-2 group",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("input",{type:"checkbox",checked:B,onChange:()=>{ie(B?Q=>Q.filter(pe=>pe!==A.id):Q=>[...Q,A.id])},className:"w-4 h-4 rounded border-slate-600 bg-slate-900 text-indigo-500 focus:ring-indigo-500"}),e.jsx("p",{className:"text-sm text-slate-400 truncate cursor-pointer hover:text-indigo-300",title:A.title,onClick:()=>M(A),children:A.title})]}),e.jsx("button",{onClick:()=>M(A),className:"p-1 text-slate-500 hover:text-green-400 rounded-lg transition-colors opacity-0 group-hover:opacity-100",title:"معاينة",children:e.jsx(dt,{className:"w-4 h-4"})})]},A.id)})})]},f)}):G.map((f,P)=>{const J=P===ue,le=N.includes(f.id),se=me=>{if(Te(P),me.shiftKey&&ne!==-1){const A=Math.min(ne,P),B=Math.max(ne,P),Q=G.slice(A,B+1).map(pe=>pe.id);ie(pe=>{const Ne=new Set(pe);return Q.forEach(de=>{Ne.has(de)?Ne.delete(de):Ne.add(de)}),Array.from(Ne)})}else ie(le?A=>A.filter(B=>B!==f.id):A=>[...A,f.id]),he(P)};return e.jsxs("div",{className:`flex items-center gap-3 p-3 rounded-lg border transition-all cursor-pointer
                                      ${le?"bg-cyan-900/10 border-cyan-900/50":"bg-slate-800/40 border-slate-800 hover:bg-slate-800"}
                                      ${J?"ring-2 ring-blue-500 ring-offset-2 ring-offset-slate-900":""}`,onClick:se,children:[e.jsx("input",{type:"checkbox",checked:le,onChange:me=>{me.target.checked?L(B=>[...B,f.id]):(L(B=>B.filter(Q=>Q!==f.id)),Z(!1))},className:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-cyan-500 focus:ring-cyan-500"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm text-slate-300 truncate",children:f.title}),e.jsx("div",{className:"text-[10px] text-slate-500 truncate",children:f.url})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>M(f),className:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-green-400",title:"معاينة",children:e.jsx(dt,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{z(f),_(!0)},className:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-blue-400",title:"تعديل",children:e.jsx(na,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{L([f.id]),ze(!0)},className:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-yellow-400",title:"نقل",children:e.jsx(ke,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>g([f.id]),className:"p-1 hover:bg-slate-700 rounded text-slate-400 hover:text-red-400",title:"حذف",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]},f.id)}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500",children:[e.jsx(ke,{className:"w-12 h-12 mb-2 opacity-20"}),e.jsx("p",{children:"هذا القسم فارغ"})]})})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500",children:[e.jsx(Ct,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("p",{className:"text-lg",children:"اختر قسماً لعرض محتوياته"})]})}),ye&&e.jsx("div",{className:"absolute inset-0 bg-black/80 flex items-center justify-center z-50 rounded-lg",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 p-6 rounded-xl w-96 shadow-2xl",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-4",children:"نقل العناصر المحددة"}),e.jsxs("p",{className:"text-sm text-slate-400 mb-4",children:["سيتم نقل ",N.length," عنصر إلى القسم المحدد."]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>{F(""),ut("websites")},className:`flex-1 px-3 py-1.5 text-xs font-bold rounded transition-colors ${Se==="websites"?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام المواقع"}),e.jsx("button",{type:"button",onClick:()=>{F(""),ut("elements")},className:`flex-1 px-3 py-1.5 text-xs font-bold rounded transition-colors ${Se==="elements"?"bg-purple-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام العناصر"})]}),Se==="websites"&&Dt.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2",children:"أقسام المواقع"}),e.jsxs("select",{className:"w-full bg-slate-800 border border-slate-700 rounded p-2 text-white",value:re,onChange:f=>F(f.target.value),children:[e.jsx("option",{value:"",children:"اختر قسماً للمواقع..."}),Dt.map(f=>e.jsx("option",{value:f.id,children:f.name},f.id))]})]}),Se==="elements"&&mt.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2",children:"أقسام العناصر"}),e.jsxs("select",{className:"w-full bg-slate-800 border border-slate-700 rounded p-2 text-white",value:re,onChange:f=>F(f.target.value),children:[e.jsx("option",{value:"",children:"اختر قسماً للعناصر..."}),mt.map(f=>e.jsx("option",{value:f.id,children:f.name},f.id))]})]}),Se==="websites"&&Dt.length===0&&e.jsx("p",{className:"text-sm text-slate-500 text-center",children:"لا توجد أقسام مواقع متاحة للنقل."}),Se==="elements"&&mt.length===0&&e.jsx("p",{className:"text-sm text-slate-500 text-center",children:"لا توجد أقسام عناصر متاحة للنقل."})]}),e.jsxs("div",{className:"flex justify-end gap-2 mt-6",children:[e.jsx("button",{onClick:()=>{ze(!1),F("")},className:"px-4 py-2 text-slate-400 hover:text-white",children:"إلغاء"}),e.jsx("button",{onClick:()=>{re?($(N,re),ze(!1),L([]),Z(!1),F("")):alert("الرجاء اختيار قسم")},className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded font-bold",children:"نقل"})]})]})})]})})})]})}):null},ga=({isOpen:n,onClose:u})=>{const[i,c]=o.useState(null),[x,m]=o.useState(!0),[p,g]=o.useState(null),[$,M]=o.useState(new Set),[S,z]=o.useState(new Set(["categories","playlist","savedPlaylists"]));o.useEffect(()=>{n&&(m(!0),g(null),c(null),fetch("/database_chunks/quick-load-data.json").then(N=>{if(!N.ok)throw new Error(`HTTP error! status: ${N.status}`);return N.json()}).then(N=>{c(N),m(!1)}).catch(N=>{console.error("Failed to load or parse quick-load-data.json:",N),g("فشل تحميل الملف. قد يكون غير موجود أو تالف. (quick-load-data.json)"),m(!1)}))},[n]);const _=N=>{M(L=>{const H=new Set(L);return H.has(N)?H.delete(N):H.add(N),H})},I=N=>{z(L=>{const H=new Set(L);return H.has(N)?H.delete(N):H.add(N),H})},Y=o.useMemo(()=>{var N,L,H,Z;return i?{totalVideos:((N=i.repository)==null?void 0:N.length)||0,totalCategories:((L=i.categories)==null?void 0:L.length)||0,totalPlaylist:((H=i.playlist)==null?void 0:H.length)||0,totalSavedPlaylists:((Z=i.savedPlaylists)==null?void 0:Z.length)||0}:null},[i]),E=o.useMemo(()=>{if(!(i!=null&&i.repository))return{};const N={};return i.repository.forEach(L=>{L.categoryId&&(N[L.categoryId]=(N[L.categoryId]||0)+1)}),N},[i]),W=N=>(i==null?void 0:i.repository.filter(L=>L.categoryId===N))||[];return n?e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[400] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl w-full max-w-5xl h-[90vh] flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-slate-800 bg-slate-950",children:[e.jsxs("h2",{className:"text-xl font-bold text-white flex items-center gap-3",children:[e.jsx(Zs,{className:"w-6 h-6 text-cyan-400"}),"محتويات ملف التحميل السريع (quick-load-data.json)"]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:e.jsx(Ue,{className:"w-6 h-6 text-slate-400 hover:text-white"})})]}),e.jsxs("div",{className:"flex-grow overflow-y-auto bg-slate-900 custom-scrollbar",children:[x&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-400 gap-4",children:[e.jsx(dr,{className:"w-10 h-10 animate-spin text-cyan-500"}),e.jsx("p",{children:"جاري تحميل وتحليل البيانات..."})]}),p&&e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-red-400 p-8 text-center",children:[e.jsx(Ss,{className:"w-16 h-16 mb-4 opacity-80"}),e.jsx("p",{className:"text-xl font-bold mb-2",children:"خطأ في قراءة ملف البيانات"}),e.jsx("p",{className:"text-slate-400",children:p}),e.jsx("div",{className:"mt-6 p-4 bg-slate-800 rounded-lg text-sm text-slate-500 max-w-md",children:e.jsx("p",{children:'تأكد من أنك قمت بتصدير بيانات "ملف التحميل السريع" من لوحة التحكم أولاً.'})})]}),!x&&!p&&i&&Y&&e.jsxs("div",{className:"p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700 flex flex-col items-center justify-center text-center",children:[e.jsx(Ul,{className:"w-8 h-8 text-blue-400 mb-2"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:Y.totalVideos}),e.jsx("span",{className:"text-xs text-slate-400",children:"فيديو في المستودع"})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700 flex flex-col items-center justify-center text-center",children:[e.jsx(ke,{className:"w-8 h-8 text-orange-400 mb-2"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:Y.totalCategories}),e.jsx("span",{className:"text-xs text-slate-400",children:"قسم ومجلد"})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700 flex flex-col items-center justify-center text-center",children:[e.jsx(dt,{className:"w-8 h-8 text-green-400 mb-2"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:Y.totalPlaylist}),e.jsx("span",{className:"text-xs text-slate-400",children:"عنصر في القائمة الحالية"})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-xl border border-slate-700 flex flex-col items-center justify-center text-center",children:[e.jsx(rs,{className:"w-8 h-8 text-purple-400 mb-2"}),e.jsx("span",{className:"text-2xl font-bold text-white",children:Y.totalSavedPlaylists}),e.jsx("span",{className:"text-xs text-slate-400",children:"قائمة محفوظة"})]})]}),e.jsxs("div",{className:"bg-slate-800/30 border border-slate-700 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>I("categories"),className:"w-full flex items-center justify-between p-4 bg-slate-800 hover:bg-slate-750 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 font-bold text-lg text-slate-200",children:[e.jsx(ke,{className:"w-5 h-5 text-orange-400"}),"الأقسام والمجلدات"]}),S.has("categories")?e.jsx(zt,{className:"w-5 h-5 text-slate-400"}):e.jsx(St,{className:"w-5 h-5 text-slate-400"})]}),S.has("categories")&&e.jsx("div",{className:"p-4 space-y-2",children:i.categories.length===0?e.jsx("p",{className:"text-center text-slate-500 py-4",children:"لا توجد أقسام مسجلة في الملف."}):i.categories.sort((N,L)=>(N.order??0)-(L.order??0)).map(N=>{const L=E[N.id]||0,H=$.has(N.id),Z=H?W(N.id):[];return e.jsxs("div",{className:"border border-slate-700/50 rounded-lg overflow-hidden bg-slate-900/40",children:[e.jsxs("button",{onClick:()=>_(N.id),className:`w-full flex items-center justify-between p-3 hover:bg-slate-800/50 transition-colors ${L===0?"opacity-60 cursor-default":"cursor-pointer"}`,disabled:L===0,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[L>0?H?e.jsx(zt,{className:"w-4 h-4 text-slate-400"}):e.jsx(St,{className:"w-4 h-4 text-slate-400"}):e.jsx("div",{className:"w-4"}),e.jsx("span",{className:`font-medium ${N.parentId?"text-slate-300":"text-blue-300"}`,children:N.name}),N.parentId&&e.jsx("span",{className:"text-[10px] text-slate-500 bg-slate-800 px-2 py-0.5 rounded-full",children:"فرعي"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:`text-xs px-2 py-1 rounded-full ${L>0?"bg-blue-900/30 text-blue-400":"bg-slate-800 text-slate-600"}`,children:[L," فيديو"]})})]}),H&&L>0&&e.jsx("div",{className:"border-t border-slate-800 bg-slate-950/30 p-2 pr-8 space-y-1 max-h-60 overflow-y-auto",children:Z.map((re,F)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-slate-400 p-1 hover:bg-slate-800/30 rounded",children:[e.jsx(Ul,{className:"w-3 h-3 text-slate-600"}),e.jsx("span",{className:"truncate",children:re.title})]},F))})]},N.id)})})]}),e.jsxs("div",{className:"bg-slate-800/30 border border-slate-700 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>I("playlist"),className:"w-full flex items-center justify-between p-4 bg-slate-800 hover:bg-slate-750 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 font-bold text-lg text-slate-200",children:[e.jsx(dt,{className:"w-5 h-5 text-green-400"}),"قائمة التشغيل الحالية"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-slate-400 bg-slate-900 px-2 py-0.5 rounded border border-slate-700",children:[i.playlist.length," عنصر"]}),S.has("playlist")?e.jsx(zt,{className:"w-5 h-5 text-slate-400"}):e.jsx(St,{className:"w-5 h-5 text-slate-400"})]})]}),S.has("playlist")&&e.jsx("div",{className:"p-4 bg-slate-900/20 max-h-60 overflow-y-auto",children:i.playlist.length===0?e.jsx("p",{className:"text-center text-slate-500",children:"القائمة فارغة"}):e.jsx("div",{className:"space-y-1",children:i.playlist.map((N,L)=>e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-slate-800/40 rounded border border-slate-800",children:[e.jsx("span",{className:"text-xs text-slate-500 w-6",children:L+1}),e.jsx("span",{className:"text-sm text-slate-300 truncate",children:N.title})]},L))})})]}),e.jsxs("div",{className:"bg-slate-800/30 border border-slate-700 rounded-xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>I("savedPlaylists"),className:"w-full flex items-center justify-between p-4 bg-slate-800 hover:bg-slate-750 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 font-bold text-lg text-slate-200",children:[e.jsx(rs,{className:"w-5 h-5 text-purple-400"}),"الذاكرة (القوائم المحفوظة)"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-sm text-slate-400 bg-slate-900 px-2 py-0.5 rounded border border-slate-700",children:[i.savedPlaylists.length," قائمة"]}),S.has("savedPlaylists")?e.jsx(zt,{className:"w-5 h-5 text-slate-400"}):e.jsx(St,{className:"w-5 h-5 text-slate-400"})]})]}),S.has("savedPlaylists")&&e.jsx("div",{className:"p-4 bg-slate-900/20 max-h-60 overflow-y-auto",children:i.savedPlaylists.length===0?e.jsx("p",{className:"text-center text-slate-500",children:"لا توجد قوائم محفوظة"}):e.jsx("div",{className:"space-y-2",children:i.savedPlaylists.map((N,L)=>e.jsxs("div",{className:"p-3 bg-slate-800/60 rounded border border-slate-700",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("h4",{className:"font-bold text-slate-200",children:N.name}),e.jsxs("span",{className:"text-xs text-purple-400 bg-purple-900/20 px-2 py-0.5 rounded",children:[N.items.length," فيديو"]})]}),e.jsxs("div",{className:"text-xs text-slate-500 truncate",children:[N.items.slice(0,3).map(H=>H.title).join(", ")," ",N.items.length>3?"...":""]})]},L))})})]})]})]}),e.jsxs("div",{className:"p-4 border-t border-slate-800 flex justify-between bg-slate-950",children:[e.jsx("div",{className:"text-xs text-slate-500 flex items-center",children:"* البيانات المعروضة هي نسخة مخزنة مؤقتاً في ملف quick-load-data.json"}),e.jsx("button",{onClick:u,className:"px-6 py-2 bg-slate-800 hover:bg-slate-700 text-white rounded-lg transition-colors border border-slate-700",children:"إغلاق"})]})]})}):null},to=({isOpen:n,onClose:u,settings:i,setSettings:c,playlist:x,setPlaylist:m,quickList:p,setQuickList:g,playbackTarget:$,setPlaybackTarget:M,setCurrentIndex:S,repository:z,setRepository:_,categories:I,savedPlaylists:Y,saveCurrentAsPlaylist:E,deleteSavedPlaylist:W,viewMode:N,setViewMode:L,loadSavedPlaylist:H,clearPlaylist:Z,addCategory:re,renameCategory:F,deleteCategoryRecursive:ye,handleCatDragStart:ze,handleCatDragOver:ge,handleCatDrop:Ze,handleReorderCategories:ue,handleDeleteItems:Te,handleMoveItems:ne,handlePreviewItem:he,handleEditVideo:fe,setEditingVideo:ie,setShowEditModal:$e,showItemManagementModal:It,setShowItemManagementModal:Be,initialSelectedItems:Pt,setInitialSelectedItems:Se,handleManualSync:ut,handleExportSingleCategory:Ee,onExportSingle:Et,onExportZip:qe,onExportQuickLoad:et})=>{var Qt;const[ce,Re]=o.useState("display"),[ht,_e]=o.useState(null),[Yt,Jt]=o.useState(""),[Mt,Lt]=o.useState(!1),[Dt,mt]=o.useState(!1),[G,tt]=o.useState(""),[f,P]=o.useState("websites"),[J,le]=o.useState(""),[se,me]=o.useState("websites"),[A,B]=o.useState("websites"),[Q,pe]=o.useState("websites"),Ne=I.filter(r=>r.type==="websites"),de=I.filter(r=>r.type==="elements"),rt=I.filter(r=>r.type===se&&!r.parentId).sort((r,w)=>(r.order??0)-(w.order??0)),[ot,pt]=o.useState(null),[nt,Ds]=o.useState({x:0,y:0}),[Tt,ns]=o.useState(!1),[Gt,Ae]=o.useState({x:0,y:0}),{controlPanelModalStyle:$t,isRepositioned:ve,resetModalPositions:Rt}=el();Pe.useEffect(()=>{n||Rt()},[n,Rt]);const is=r=>{ns(!0),Ae({x:r.clientX-nt.x,y:r.clientY-nt.y})},_t=Pe.useCallback(r=>{Tt&&Ds({x:r.clientX-Gt.x,y:r.clientY-Gt.y})},[Tt,Gt]),Ye=Pe.useCallback(()=>{ns(!1)},[]);Pe.useEffect(()=>(Tt?(document.addEventListener("mousemove",_t),document.addEventListener("mouseup",Ye)):(document.removeEventListener("mousemove",_t),document.removeEventListener("mouseup",Ye)),()=>{document.removeEventListener("mousemove",_t),document.removeEventListener("mouseup",Ye)}),[Tt,_t,Ye]);const[At,cs]=o.useState([]),gt=({category:r,allCategories:w,level:v,editingCategory:V,editName:U,handleEditCategory:D,renameCategory:O,deleteCategoryRecursive:X,handleDragStart:je,handleDragOver:Ge,handleDrop:q,handleDragEnd:We,draggedCategory:ft,handleSetExpandedCategories:Ft,orderNumberChangeHandler:hs})=>{var Zt;const yt=At.includes(r.id),jt=w.filter(ee=>ee.parentId===r.id).sort((ee,Fe)=>(ee.order??0)-(Fe.order??0)),[wt,Nt]=o.useState(!1),[we,Oe]=o.useState(r.order??0);Pe.useEffect(()=>{Oe(r.order??0)},[r.order]);const Kt=ee=>{ee.stopPropagation(),cs(Fe=>Fe.includes(r.id)?Fe.filter(ps=>ps!==r.id):[...Fe,r.id])},rl=ee=>{const Fe=parseInt(ee.target.value,10);isNaN(Fe)||Oe(Fe)},ms=()=>{hs(r.id,we),Nt(!1)};return e.jsxs("div",{className:`space-y-1 ${v>0?"border-l border-slate-700/50 ml-4 pl-4":""}`,children:[e.jsxs("div",{className:`flex items-center gap-3 p-3 bg-slate-800/70 rounded-lg border border-slate-700/50 group ${(ft==null?void 0:ft.id)===r.id?"opacity-50":""}`,draggable:"true",onDragStart:ee=>je(ee,r),onDragOver:Ge,onDrop:ee=>q(ee,r),onDragEnd:We,style:{paddingLeft:`${v*1}rem`},children:[jt.length>0&&e.jsx("button",{onClick:Kt,className:"text-slate-400 hover:text-blue-400",children:yt?e.jsx(Ue,{size:16}):e.jsx(ke,{size:16})}),e.jsx(ke,{className:"w-5 h-5 text-orange-400"}),V===r.id?e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx("input",{value:U,onChange:ee=>Jt(ee.target.value),className:"flex-1 bg-slate-950 border border-slate-600 rounded px-2 py-1 text-xs",autoFocus:!0,onKeyDown:ee=>ee.key==="Enter"&&O(r.id,U)}),e.jsx("button",{onClick:()=>O(r.id,U),className:"text-green-400",children:e.jsx(Is,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_e(null),className:"text-red-400",children:e.jsx(Ue,{className:"w-4 h-4"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:`font-bold ${r.parentId?"text-sm text-yellow-400":"text-md text-blue-300"}`,children:r.name}),e.jsxs("div",{className:"text-[10px] text-slate-500",children:[r.parentId?`(فرعي من: ${(Zt=w.find(ee=>ee.id===r.parentId))==null?void 0:Zt.name})`:"(رئيسي)"," • ",z.filter(ee=>ee.categoryId===r.id).length," فيديو"]})]}),wt?e.jsx("input",{type:"number",value:we,onChange:rl,onBlur:ms,onKeyDown:ee=>{ee.key==="Enter"&&ms()},className:"w-12 bg-slate-950 border border-slate-600 rounded px-1 py-0.5 text-xs text-center",autoFocus:!0}):e.jsxs("span",{onClick:()=>Nt(!0),className:"text-xs text-slate-400 px-2 py-1 rounded cursor-pointer hover:bg-slate-700",children:["Order: ",r.order??0]}),r.id!=="default"&&e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100",children:[e.jsx("button",{onClick:()=>D(r),className:"p-1.5 hover:bg-slate-700 rounded text-slate-400 hover:text-blue-400",children:e.jsx(na,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>X(r.id),className:"p-1.5 hover:bg-slate-700 rounded text-slate-400 hover:text-red-400",children:e.jsx(Ce,{className:"w-4 h-4"})})]})]})]},r.id),yt&&jt.length>0&&e.jsx("div",{className:"mt-1",children:jt.map(ee=>e.jsx(gt,{category:ee,allCategories:w,level:v+1,editingCategory:V,editName:U,handleEditCategory:D,renameCategory:O,deleteCategoryRecursive:X,handleDragStart:je,handleDragOver:Ge,handleDrop:q,handleDragEnd:We,draggedCategory:ft,handleSetExpandedCategories:Ft,orderNumberChangeHandler:hs},ee.id))})]})},[st,Wt]=o.useState(null),[ds,Xt]=o.useState(new Map),[Me,Je]=o.useState([]),[Ts,xs]=o.useState([]),$s=o.useCallback(r=>{cs(w=>w.includes(r)?w.filter(v=>v!==r):[...w,r])},[]),ll=o.useCallback((r,w)=>{const v=I.find(O=>O.id===r);if(!v)return;let V=I.map(O=>({...O}));V=V.map(O=>O.id===r?{...O,order:w}:O);const D=V.filter(O=>O.type===v.type&&O.parentId===v.parentId).sort((O,X)=>(O.order??0)!==(X.order??0)?(O.order??0)-(X.order??0):O.name.localeCompare(X.name));ue(D)},[ue,I]),Ht=(r,w)=>{pt(w),r.dataTransfer.effectAllowed="move",r.dataTransfer.setData("text/plain",w.id)},us=r=>{r.preventDefault(),r.dataTransfer.dropEffect="move"},Ot=(r,w)=>{if(r.preventDefault(),!ot||ot.id===w.id)return;const v=rt,V=v.findIndex(X=>X.id===ot.id),U=v.findIndex(X=>X.id===w.id);if(V===-1||U===-1){console.error("Dragged or target category not found in current list.");return}const D=Array.from(v),[O]=D.splice(V,1);D.splice(U,0,O),ue(D),pt(null)},bt=()=>{pt(null)};Pe.useEffect(()=>{if(ce!=="filtering"||!st){Xt(new Map),xs([]),Je([]);return}const r=z.filter(v=>v.categoryId===st),w=new Map;r.forEach(v=>{try{const V=new URL(v.url).hostname.replace(/^www\./,""),U=w.get(V)||[];w.set(V,[...U,v])}catch{const U="Invalid URL",D=w.get(U)||[];w.set(U,[...D,v])}}),Xt(w),Je([]),xs([])},[st,z,ce]);const al=r=>{_e(r.id),Jt(r.name)},qt=r=>{const w={...i,...r};c(w),sl(w)},Rs=()=>{const r=new Set,w=z.filter(v=>r.has(v.url)?!1:(r.add(v.url),!0));w.length<z.length?confirm(`تم العثور على ${z.length-w.length} فيديو مكرر. هل تريد حذفهم؟`)&&(_(w),alert("تم حذف الفيديوهات المكررة.")):alert("لا توجد فيديوهات مكررة.")};return e.jsxs("div",{className:ve?"z-[200]":"fixed inset-0 bg-black/80 backdrop-blur-sm z-[200] flex items-center justify-center p-6",style:ve?$t:{...$t,transform:`translate(${nt.x}px, ${nt.y}px)`},children:[e.jsxs("div",{className:`bg-slate-900 border border-slate-700 w-full max-w-6xl ${ve?"h-full rounded-none":"h-[90vh] rounded-2xl"} shadow-2xl flex flex-col overflow-hidden`,children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-slate-800 bg-slate-950/80",onMouseDown:is,children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Qs,{className:"text-blue-500"})," لوحة التحكم"]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:e.jsx(Ue,{className:"w-5 h-5 text-slate-400"})})]}),e.jsxs("div",{className:"flex border-b border-slate-800 bg-slate-900/50 flex-wrap",children:[e.jsxs("button",{onClick:()=>Re("display"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${ce==="display"?"text-teal-400 border-b-2 border-teal-400 bg-teal-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(xr,{className:"w-4 h-4"})," العرض"]}),e.jsxs("button",{onClick:()=>Re("quickList"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${ce==="quickList"?"text-green-400 border-b-2 border-green-400 bg-green-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(Ps,{className:"w-4 h-4"})," القائمة السريعة (",p.length,")"]}),e.jsxs("button",{onClick:()=>Re("playlist"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${ce==="playlist"?"text-blue-400 border-b-2 border-blue-400 bg-blue-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(dt,{className:"w-4 h-4"})," قائمة التشغيل (",x.length,")"]}),e.jsxs("button",{onClick:()=>Re("savedPlaylists"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${ce==="savedPlaylists"?"text-purple-400 border-b-2 border-purple-400 bg-purple-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(rs,{className:"w-4 h-4"})," القوائم المحفوظة (",Y.length,")"]}),e.jsxs("button",{onClick:()=>Re("categories"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${ce==="categories"?"text-orange-400 border-b-2 border-orange-400 bg-orange-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(ke,{className:"w-4 h-4"})," إدارة الأقسام (",I.length,")"]}),e.jsxs("button",{onClick:()=>Be(!0),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${ce==="items"?"text-cyan-400 border-b-2 border-cyan-400 bg-cyan-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(Ct,{className:"w-4 h-4"})," إدارة العناصر"]}),e.jsxs("button",{onClick:()=>Re("maintenance"),className:`flex items-center gap-2 px-4 py-3 text-sm font-bold transition-colors ${ce==="maintenance"?"text-yellow-400 border-b-2 border-yellow-400 bg-yellow-900/10":"text-slate-500 hover:text-slate-300"}`,children:[" ",e.jsx(Ss,{className:"w-4 h-4"})," قسم التصدير"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6 bg-slate-900 text-slate-200",dir:"ltr",children:e.jsxs("div",{dir:"rtl",className:"h-full",children:[ce==="filtering"&&e.jsxs("div",{className:"grid grid-cols-3 gap-6 h-full",children:[e.jsx("div",{className:"col-span-1 border-l border-slate-800 p-2 overflow-y-auto",dir:"ltr",children:e.jsxs("div",{dir:"rtl",children:[e.jsx("h3",{className:"font-bold text-slate-300 mb-4 sticky top-0 bg-slate-900 pb-2 border-b border-slate-800",children:"الأقسام"}),e.jsx("div",{className:"space-y-1",children:I.map(r=>e.jsxs("button",{onClick:()=>Wt(r.id),className:`w-full flex items-center justify-between p-3 rounded-lg text-sm transition-colors ${st===r.id?"bg-indigo-900/30 text-indigo-400 border border-indigo-900/50":"text-slate-400 hover:bg-slate-800 hover:text-slate-200"}`,children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4"}),r.name]}),e.jsx("span",{className:"text-[10px] bg-slate-800 px-2 py-0.5 rounded-full",children:z.filter(w=>w.categoryId===r.id).length})]},r.id))})]})}),e.jsx("div",{className:"col-span-2 flex flex-col h-full overflow-hidden",children:st?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 pb-2 border-b border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-indigo-400",children:["مجمّع حسب الموقع في: ",(Qt=I.find(r=>r.id===st))==null?void 0:Qt.name]}),Me.length>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-bold text-slate-300",children:`تم تحديد ${Me.length} عنصر`}),e.jsxs("button",{onClick:r=>{r.stopPropagation(),ne(Me,st||""),Je([])},className:"px-3 py-1.5 bg-blue-900/30 hover:bg-blue-900/50 text-blue-400 rounded text-xs flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3"})," نقل"]}),e.jsxs("button",{onClick:r=>{r.stopPropagation(),Te(Me),Je([])},className:"px-3 py-1.5 bg-red-900/30 hover:bg-red-900/50 text-red-400 rounded text-xs flex items-center gap-1",children:[e.jsx(Ce,{className:"w-3 h-3"})," حذف"]})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto space-y-2 pr-2",dir:"ltr",children:e.jsx("div",{dir:"rtl",children:Array.from(ds.entries()).map(([r,w])=>{const v=Ts.includes(r),V=w.every(D=>Me.includes(D.id)),U=()=>{const D=w.map(O=>O.id);Je(V?O=>O.filter(X=>!D.includes(X)):O=>[...new Set([...O,...D])])};return e.jsxs("div",{className:"bg-slate-800/40 rounded-lg p-2 border border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer p-2",onClick:()=>xs(D=>D.includes(r)?D.filter(O=>O!==r):[...D,r]),children:[e.jsx("input",{type:"checkbox",checked:V,onChange:U,onClick:D=>D.stopPropagation(),className:"w-4 h-4 rounded border-slate-600 bg-slate-800 text-indigo-500 focus:ring-indigo-500"}),e.jsx(Is,{className:`w-4 h-4 transition-transform duration-200 ${v?"rotate-90":""}`}),e.jsx("span",{className:"font-bold text-slate-300",children:r}),e.jsx("span",{className:"text-xs text-slate-500 bg-slate-700 px-2 py-0.5 rounded-full",children:w.length})]}),v&&e.jsx("div",{className:"pl-8 pt-2 space-y-1",children:w.map(D=>{const O=Me.includes(D.id);return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:O,onChange:()=>{Je(O?X=>X.filter(je=>je!==D.id):X=>[...X,D.id])},className:"w-4 h-4 rounded border-slate-600 bg-slate-900 text-indigo-500 focus:ring-indigo-500"}),e.jsx("p",{className:"text-sm text-slate-400 truncate",title:D.title,children:D.title})]},D.id)})})]},r)})})})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-slate-500",children:[e.jsx(ur,{className:"w-16 h-16 mb-4 opacity-20"}),e.jsx("p",{className:"text-lg",children:"اختر قسماً لبدء التصفية"})]})})]}),ce==="display"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg space-y-4 border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-300 border-b border-slate-700 pb-2",children:"إعدادات عرض المستودع"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"طريقة عرض العناصر"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"viewMode",value:"list",checked:N==="list",onChange:()=>L("list")}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"قائمة (العرض الافتراضي)"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"viewMode",value:"grid",checked:N==="grid",onChange:()=>L("grid")}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"شبكة (عرض الصور)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"ترتيب العناصر داخل الأقسام"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"itemsSortOrder",value:"manual",checked:i.itemsSortOrder==="manual"||!i.itemsSortOrder,onChange:r=>c({...i,itemsSortOrder:r.target.value})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"يدوي"})]}),e.jsx("p",{className:"text-xs text-slate-500 -mt-1 ml-6",children:"يتم تفعيله عند تحريك عنصر للأعلى."}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"itemsSortOrder",value:"newest",checked:i.itemsSortOrder==="newest",onChange:r=>c({...i,itemsSortOrder:r.target.value})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"الأحدث"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"itemsSortOrder",value:"oldest",checked:i.itemsSortOrder==="oldest",onChange:r=>c({...i,itemsSortOrder:r.target.value})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"الأقدم"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"itemsSortOrder",value:"alphabetical",checked:i.itemsSortOrder==="alphabetical",onChange:r=>c({...i,itemsSortOrder:r.target.value})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"أبجدي"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"itemsSortOrder",value:"random",checked:i.itemsSortOrder==="random",onChange:r=>c({...i,itemsSortOrder:r.target.value})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"عشوائي"})]})]})]})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg space-y-4 border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-300 border-b border-slate-700 pb-2",children:"وضع العرض"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"اختر وضع العرض"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"displayMode",value:"full",checked:i.displayMode==="full"||!i.displayMode,onChange:()=>qt({displayMode:"full"})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"العرض الكامل (الافتراضي)"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"displayMode",value:"family",checked:i.displayMode==="family",onChange:()=>qt({displayMode:"family"})}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"العرض العائلي (إخفاء أقسام)"})]})]})]}),i.displayMode==="family"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"الأقسام التي سيتم إخفاؤها"}),e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto pr-2 border border-slate-700 p-2 rounded-lg",children:I.map(r=>{var w;return e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-red-600",checked:((w=i.hiddenCategories)==null?void 0:w.includes(r.id))||!1,onChange:v=>{const V=v.target.checked,U=r.id;let D=[...i.hiddenCategories||[]];const O=Xe(U,I);let X;if(V)X=Array.from(new Set([...D,U,...O]));else{const je=new Set([U,...O]);X=D.filter(Ge=>!je.has(Ge))}qt({hiddenCategories:X})}}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:r.name})]},r.id)})})]})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg space-y-4 border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-300 border-b border-slate-700 pb-2",children:"الفتح في نافذة خارجية"}),e.jsx("p",{className:"text-xs text-slate-400",children:"تخصيص بعض الأقسام ليتم فتح وعرض العناصر بها في نافذة خارجية مباشرة."}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>B("websites"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${A==="websites"?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام المواقع"}),e.jsx("button",{type:"button",onClick:()=>B("elements"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${A==="elements"?"bg-purple-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام العناصر"})]}),A==="websites"&&e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto pr-2",children:I.filter(r=>r.type==="websites").map(r=>{var w;return e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-blue-600",checked:((w=i.openInExternalWindowCategories_Websites)==null?void 0:w.includes(r.id))||!1,onChange:v=>{const V=v.target.checked,U=r.id,D="openInExternalWindowCategories_Websites";let O=[...i[D]||[]];const X=Xe(U,I);let je;if(V)je=Array.from(new Set([...O,U,...X]));else{const Ge=new Set([U,...X]);je=O.filter(q=>!Ge.has(q))}qt({[D]:je})}}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:r.name})]},r.id)})}),A==="elements"&&e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto pr-2",children:de.map(r=>{var w;return e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-purple-600",checked:((w=i.openInExternalWindowCategories_Elements)==null?void 0:w.includes(r.id))||!1,onChange:v=>{const V=v.target.checked,U=r.id,D="openInExternalWindowCategories_Elements";let O=[...i[D]||[]];const X=Xe(U,I);let je;if(V)je=Array.from(new Set([...O,U,...X]));else{const Ge=new Set([U,...X]);je=O.filter(q=>!Ge.has(q))}qt({[D]:je})}}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:r.name})]},r.id)})})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg space-y-4 border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-300 border-b border-slate-700 pb-2",children:"إعدادات التشغيل"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"وضع التشغيل"}),e.jsxs("select",{value:i.playbackMode,onChange:r=>c({...i,playbackMode:r.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-sm text-white",children:[e.jsx("option",{value:"sequential",children:"متسلسل (بالترتيب)"}),e.jsx("option",{value:"random",children:"عشوائي"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"وضع البدء الافتراضي"}),e.jsxs("select",{value:i.startupMode,onChange:r=>c({...i,startupMode:r.target.value}),className:"w-full bg-slate-900 border border-slate-700 rounded p-2 text-sm text-white",children:[e.jsx("option",{value:"playlist",children:"تشغيل قائمة التشغيل"}),e.jsx("option",{value:"repository",children:"تشغيل المستودع"})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-2",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:i.autoPlay,onChange:r=>c({...i,autoPlay:r.target.checked}),className:"w-4 h-4 rounded border-slate-600 bg-slate-900 text-blue-600 focus:ring-blue-600"}),e.jsx("span",{className:"text-sm text-slate-300 group-hover:text-blue-400 transition-colors",children:"تشغيل تلقائي (الانتقال للفيديو التالي)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer group",children:[e.jsx("input",{type:"checkbox",checked:i.loop,onChange:r=>c({...i,loop:r.target.checked}),className:"w-4 h-4 rounded border-slate-600 bg-slate-900 text-blue-600 focus:ring-blue-600"}),e.jsx("span",{className:"text-sm text-slate-300 group-hover:text-blue-400 transition-colors",children:"تكرار القائمة"})]})]})]})]})]}),ce==="quickList"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-green-400 flex items-center gap-2",children:[e.jsx(Ps,{})," محتويات القائمة السريعة"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{M("quickList"),alert("تم تفعيل القائمة السريعة."),u()},className:`px-3 py-1 text-xs font-bold rounded transition-colors ${$==="quickList"?"bg-green-500 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"تفعيل هذه القائمة"}),e.jsx("button",{onClick:()=>{confirm("هل أنت متأكد؟")&&g([])},className:"bg-red-600 hover:bg-red-500 text-white px-3 py-1 rounded text-xs font-bold",children:"مسح الكل"})]})]}),e.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg space-y-4 border border-slate-700",children:[e.jsx("h4",{className:"text-sm font-bold text-slate-300 border-b border-slate-700 pb-2",children:"إعدادات التشغيل السريع التلقائي"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"طريقة اختيار الأفلام"}),e.jsxs("div",{className:"flex flex-col space-y-2",children:[e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"quickPlaySelectionMethod",value:"sequential",checked:i.quickPlaySelectionMethod==="sequential",onChange:r=>c(w=>({...w,quickPlaySelectionMethod:r.target.value}))}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"بالترتيب (عنصران مختلفان من كل قسم مختار)"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"quickPlaySelectionMethod",value:"random_one_category",checked:i.quickPlaySelectionMethod==="random_one_category",onChange:r=>c(w=>({...w,quickPlaySelectionMethod:r.target.value}))}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"عشوائي (عنصران مختلفان من قسم واحد عشوائي)"})]}),e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"radio",className:"form-radio text-blue-600",name:"quickPlaySelectionMethod",value:"two_from_each",checked:i.quickPlaySelectionMethod==="two_from_each",onChange:r=>c(w=>({...w,quickPlaySelectionMethod:r.target.value}))}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:"عنصران متتاليان مختلفان في كل مرة من كل قسم مختار"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase",children:"اختيار الأقسام المستهدفة"}),e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{type:"button",onClick:()=>pe("websites"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${Q==="websites"?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام المواقع"}),e.jsx("button",{type:"button",onClick:()=>pe("elements"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${Q==="elements"?"bg-purple-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام العناصر"})]}),Q==="websites"&&e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto pr-2",children:I.filter(r=>r.type==="websites").map(r=>{var w;return e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-green-600",checked:((w=i.quickPlaySelectedCategories)==null?void 0:w.includes(r.id))||!1,onChange:v=>{const V=v.target.checked,U=r.id;let D=[...i.quickPlaySelectedCategories||[]];if(V){D.push(U);const O=Xe(U,I);D=Array.from(new Set([...D,...O]))}else{D=D.filter(X=>X!==U);const O=Xe(U,I);D=D.filter(X=>!O.has(X))}c(O=>({...O,quickPlaySelectedCategories:D}))}}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:r.name})]},r.id)})}),Q==="elements"&&e.jsx("div",{className:"grid grid-cols-2 gap-2 max-h-40 overflow-y-auto pr-2",children:I.filter(r=>r.type==="elements").map(r=>{var w;return e.jsxs("label",{className:"inline-flex items-center",children:[e.jsx("input",{type:"checkbox",className:"form-checkbox text-green-600",checked:((w=i.quickPlaySelectedCategories)==null?void 0:w.includes(r.id))||!1,onChange:v=>{const V=v.target.checked,U=r.id;let D=[...i.quickPlaySelectedCategories||[]];if(V){D.push(U);const O=Xe(U,I);D=Array.from(new Set([...D,...O]))}else{D=D.filter(X=>X!==U);const O=Xe(U,I);D=D.filter(X=>!O.has(X))}c(O=>({...O,quickPlaySelectedCategories:D}))}}),e.jsx("span",{className:"ml-2 text-sm text-slate-300",children:r.name})]},r.id)})}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[e.jsx("button",{onClick:()=>c(r=>({...r,quickPlaySelectedCategories:Q==="websites"?[...Ne.map(w=>w.id),...(i.quickPlaySelectedCategories||[]).filter(w=>de.some(v=>v.id===w))]:[...de.map(w=>w.id),...(i.quickPlaySelectedCategories||[]).filter(w=>Ne.some(v=>v.id===w))]})),className:"text-xs text-blue-400 hover:text-blue-300",children:"تحديد الكل"}),e.jsx("button",{onClick:()=>c(r=>({...r,quickPlaySelectedCategories:Q==="websites"?(i.quickPlaySelectedCategories||[]).filter(w=>!Ne.some(v=>v.id===w)):(i.quickPlaySelectedCategories||[]).filter(w=>!de.some(v=>v.id===w))})),className:"text-xs text-red-400 hover:text-red-300",children:"إلغاء الكل"})]})]})]})," ",p.length>0?e.jsx("div",{className:"space-y-2",children:p.map((r,w)=>{var v;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/70 rounded-lg border border-slate-700/50 group",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("span",{className:"text-xs text-slate-500 font-mono",children:w+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-base text-slate-300 truncate",children:r.title}),r.categoryId&&I.find(V=>V.id===r.categoryId)&&e.jsxs("p",{className:"text-[10px] text-slate-500",children:["المجلد: ",(v=I.find(V=>V.id===r.categoryId))==null?void 0:v.name]})]})]}),e.jsx("button",{onClick:()=>g(V=>V.filter(U=>U.id!==r.id)),className:"p-1.5 text-slate-500 hover:text-red-400 rounded-lg transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(Ce,{className:"w-4 h-4"})})]},r.id+"-"+w)})}):e.jsxs("div",{className:"text-center text-slate-500 py-10",children:[e.jsx("p",{className:"mb-4",children:"القائمة السريعة فارغة."}),e.jsx("button",{onClick:()=>{alert('استخدم زر "تشغيل الآن" بجانب أي فيديو في المستودع لإضافته.'),u()},className:"bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg text-sm font-bold",children:"إضافة من المستودع"})]})]}),ce==="playlist"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-slate-800",children:[e.jsxs("h3",{className:"font-bold text-blue-400 flex items-center gap-2",children:[e.jsx(dt,{})," قائمة التشغيل الحالية"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:E,className:"bg-purple-600 hover:bg-purple-500 text-white px-3 py-1 rounded text-xs font-bold flex items-center gap-1",children:[e.jsx(rs,{className:"w-3 h-3"})," حفظ كقائمة جديدة"]}),e.jsx("button",{onClick:()=>{M("playlist"),alert("تم تفعيل قائمة التشغيل الحالية."),u()},className:`px-3 py-1 text-xs font-bold rounded transition-colors ${$==="playlist"?"bg-blue-500 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"تفعيل هذه القائمة"}),e.jsx("button",{onClick:Z,className:"bg-red-600 hover:bg-red-500 text-white px-3 py-1 rounded text-xs font-bold",children:"مسح الكل"})]})]}),x.length>0?e.jsx("div",{className:"space-y-2",children:x.map((r,w)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/70 rounded-lg border border-slate-700/50 group",children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("span",{className:"text-xs text-slate-500 font-mono",children:w+1}),e.jsx("p",{className:"font-medium text-base text-slate-300 truncate",children:r.title})]}),e.jsx("button",{onClick:()=>m(v=>v.filter(V=>V.playlistId!==r.playlistId)),className:"p-1.5 text-slate-500 hover:text-red-400 rounded-lg transition-colors opacity-0 group-hover:opacity-100",children:e.jsx(Ce,{className:"w-4 h-4"})})]},r.playlistId))}):e.jsx("div",{className:"text-center text-slate-500 py-10",children:"قائمة التشغيل فارغة. أضف فيديوهات من المستودع."})]}),ce==="savedPlaylists"&&e.jsxs("div",{className:"space-y-2",children:[Y.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-slate-800/70 rounded-lg border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-500/20 rounded flex items-center justify-center",children:e.jsx(dt,{className:"w-5 h-5 text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-slate-200",children:r.name}),e.jsxs("p",{className:"text-xs text-slate-500",children:[r.items.length," فيديو"]})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>W(r.id),className:"p-2 hover:bg-red-900/30 text-slate-400 hover:text-red-400 rounded-lg transition-colors",children:e.jsx(Ce,{className:"w-5 h-5"})})})]},r.id)),Y.length===0&&e.jsx("div",{className:"text-center text-slate-500 py-10",children:"لا توجد قوائم تشغيل محفوظة."})]}),ce==="categories"&&e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"space-y-4 mb-6 p-4 border border-slate-700 rounded-lg bg-slate-800/50",children:[e.jsx("h4",{className:"font-bold text-slate-300 border-b border-slate-700 pb-2 mb-3",children:"إضافة قسم جديد"}),e.jsx("input",{type:"text",placeholder:"اسم القسم الجديد",value:G,onChange:r=>tt(r.target.value),className:"w-full bg-slate-900 border border-slate-700 rounded-lg p-2 text-sm text-white placeholder-slate-500"}),e.jsxs("div",{className:"flex gap-4 mt-3",children:[e.jsxs("label",{className:"inline-flex items-center text-sm text-slate-300",children:[e.jsx("input",{type:"radio",name:"newCategoryType",value:"websites",checked:f==="websites",onChange:()=>P("websites"),className:"form-radio text-blue-500"}),e.jsx("span",{className:"ml-2",children:"مواقع"})]}),e.jsxs("label",{className:"inline-flex items-center text-sm text-slate-300",children:[e.jsx("input",{type:"radio",name:"newCategoryType",value:"elements",checked:f==="elements",onChange:()=>P("elements"),className:"form-radio text-purple-500"}),e.jsx("span",{className:"ml-2",children:"عناصر"})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx("button",{onClick:()=>{G.trim()?(re(G,f),tt("")):alert("الرجاء إدخال اسم للقسم.")},className:"flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-2 px-3 rounded-lg text-xs",children:"إضافة قسم رئيسي"}),e.jsxs("select",{value:J,onChange:r=>le(r.target.value),className:"bg-slate-700 border border-slate-600 rounded-lg p-2 text-xs text-white",children:[e.jsx("option",{value:"",children:"اختر القسم الأب"}),I.filter(r=>r.type===f).map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]}),e.jsx("button",{onClick:()=>{G.trim()&&J?(re(G,f,J),tt(""),le("")):G.trim()?alert("الرجاء اختيار قسم أب."):alert("الرجاء إدخال اسم للقسم الفرعي.")},className:"flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-3 rounded-lg text-xs",disabled:I.filter(r=>r.type===f).length===0,children:"إضافة قسم فرعي"})]})]}),e.jsxs("div",{className:"space-y-4 mb-6 p-4 border border-red-700 rounded-lg bg-red-900/20",children:[e.jsx("h4",{className:"font-bold text-red-400 border-b border-red-700 pb-2 mb-3",children:"⭐ إعدادات مجلد المفضلة"}),e.jsx("p",{className:"text-xs text-slate-400 mb-4",children:"اختر مجلد المفضلة الافتراضي لكل قسم. عند الضغط على زر النجمة، سيتم إضافة العنصر إلى هذا المجلد."}),e.jsx("div",{className:"space-y-3",children:I.filter(r=>!r.parentId).map(r=>{var w;return e.jsxs("div",{className:"flex items-center gap-3 p-2 bg-slate-800/50 rounded-lg",children:[e.jsxs("label",{className:"text-sm text-slate-300 min-w-[100px] font-medium",children:[r.name,":"]}),e.jsxs("select",{value:((w=i.categoriesFavoriteFolders)==null?void 0:w[r.id])||"",onChange:v=>{c(V=>({...V,categoriesFavoriteFolders:{...V.categoriesFavoriteFolders,[r.id]:v.target.value}}))},className:"flex-1 bg-slate-700 border border-slate-600 rounded-lg p-1.5 text-xs text-white",children:[e.jsx("option",{value:"",children:"-- لم يتم التحديد --"}),I.filter(v=>v.type===r.type).map(v=>e.jsx("option",{value:v.id,children:v.name},v.id))]})]},r.id)})})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx("button",{type:"button",onClick:()=>me("websites"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${se==="websites"?"bg-blue-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام المواقع"}),e.jsx("button",{type:"button",onClick:()=>me("elements"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${se==="elements"?"bg-purple-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"أقسام العناصر"})]}),e.jsxs("div",{className:"space-y-2",children:[rt.map(r=>e.jsx(gt,{category:r,allCategories:I,level:0,editingCategory:ht,editName:Yt,handleEditCategory:al,renameCategory:F,deleteCategoryRecursive:ye,handleDragStart:Ht,handleDragOver:us,handleDrop:Ot,handleDragEnd:bt,draggedCategory:ot,handleSetExpandedCategories:()=>$s(r.id),orderNumberChangeHandler:ll},r.id)),rt.length===0&&e.jsx("div",{className:"text-center text-slate-500 py-4",children:"لا توجد أقسام من هذا النوع."})]})]}),ce==="maintenance"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-6 bg-gradient-to-br from-purple-900/20 to-purple-800/10 border-2 border-purple-500/30 rounded-xl",children:[e.jsxs("h3",{className:"font-bold text-purple-300 mb-3 flex items-center gap-2 text-lg",children:[e.jsx(Bt,{className:"w-5 h-5"})," تصدير نسخة من البيانات"]}),e.jsx("p",{className:"text-xs text-slate-400 mb-5 leading-relaxed",children:"اختر طريقة التصدير المناسبة لاحتياجاتك. التصدير المضغوط موصى به للحصول على أداء أفضل."}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>{Et?Et():alert("وظيفة التصدير غير متوفرة")},className:"group p-4 bg-gradient-to-br from-blue-900/30 to-blue-800/20 border border-blue-700/50 hover:border-blue-500 rounded-lg transition-all hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-600/20 rounded-full flex items-center justify-center group-hover:bg-blue-600/30 transition-colors",children:e.jsx(Bt,{className:"w-5 h-5 text-blue-400"})}),e.jsxs("div",{className:"text-right flex-1",children:[e.jsx("h4",{className:"font-bold text-blue-300 text-sm",children:"ملف واحد مجمع"}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"video-station-data.json"})]})]}),e.jsx("p",{className:"text-xs text-slate-400 text-right",children:"جميع البيانات في ملف JSON واحد - سهل النقل والمشاركة"})]}),e.jsxs("button",{onClick:()=>{qe?qe():alert(`وظيفة التصدير المضغوط غير متوفرة.

تأكد من تثبيت مكتبة jszip:
npm install jszip`)},className:"group relative p-4 bg-gradient-to-br from-green-900/30 to-green-800/20 border border-green-700/50 hover:border-green-500 rounded-lg transition-all hover:scale-105",children:[e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white text-[9px] font-bold px-2 py-0.5 rounded-full",children:"موصى به"}),e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-green-600/20 rounded-full flex items-center justify-center group-hover:bg-green-600/30 transition-colors",children:e.jsx(ia,{className:"w-5 h-5 text-green-400"})}),e.jsxs("div",{className:"text-right flex-1",children:[e.jsx("h4",{className:"font-bold text-green-300 text-sm",children:"ملف مضغوط ZIP"}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"database_chunks.zip"})]})]}),e.jsx("p",{className:"text-xs text-slate-400 text-right",children:"تحميل أسرع عند فتح التطبيق - يحتوي على ملفات مجزأة"})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2 grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>{et?et():alert("وظيفة تصدير ملف التحميل السريع غير متوفرة")},className:"group p-4 bg-gradient-to-br from-purple-900/30 to-purple-800/20 border border-purple-700/50 hover:border-purple-500 rounded-lg transition-all hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-600/20 rounded-full flex items-center justify-center group-hover:bg-purple-600/30 transition-colors",children:e.jsx(Qe,{className:"w-5 h-5 text-purple-400"})}),e.jsxs("div",{className:"text-right flex-1",children:[e.jsx("h4",{className:"font-bold text-purple-300 text-sm",children:"ملف التحميل الأولي (Quick Load)"}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"quick-load-data.json"})]})]}),e.jsx("p",{className:"text-xs text-slate-400 text-right",children:"يحتوي على الإعدادات، القوائم، و200 عنصر من كل قسم للتحميل السريع"})]}),e.jsxs("button",{onClick:()=>mt(!0),className:"group p-4 bg-gradient-to-br from-cyan-900/30 to-cyan-800/20 border border-cyan-700/50 hover:border-cyan-500 rounded-lg transition-all hover:scale-105",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"w-10 h-10 bg-cyan-600/20 rounded-full flex items-center justify-center group-hover:bg-cyan-600/30 transition-colors",children:e.jsx(Zs,{className:"w-5 h-5 text-cyan-400"})}),e.jsxs("div",{className:"text-right flex-1",children:[e.jsx("h4",{className:"font-bold text-cyan-300 text-sm",children:"عرض محتوى الملف"}),e.jsx("p",{className:"text-[10px] text-slate-500",children:"فحص quick-load-data.json"})]})]}),e.jsx("p",{className:"text-xs text-slate-400 text-right",children:"عرض تفاصيل ملف التحميل الأولي للتأكد من وجود البيانات"})]})]})]})]}),e.jsxs("div",{className:"p-6 bg-yellow-900/10 border border-yellow-500/20 rounded-xl",children:[e.jsxs("h3",{className:"font-bold text-yellow-400 mb-2 flex items-center gap-2",children:[e.jsx(Ss,{className:"w-4 h-4"})," تنظيف المكررات"]}),e.jsx("p",{className:"text-xs text-slate-400 mb-4",children:"البحث عن الفيديوهات التي لها نفس الرابط وحذف النسخ المكررة من المستودع."}),e.jsx("button",{onClick:Rs,className:"bg-yellow-600 hover:bg-yellow-500 text-black px-4 py-2 rounded-lg text-xs font-bold",children:"بدء الفحص"})]}),e.jsxs("div",{className:"p-6 bg-blue-900/10 border border-blue-500/20 rounded-xl",children:[e.jsxs("h3",{className:"font-bold text-blue-400 mb-2 flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"})," مزامنة يدوية من database_chunks"]}),e.jsxs("p",{className:"text-xs text-slate-400 mb-4",children:["تحميل البيانات من مجلد database_chunks ودمجها مع البيانات الحالية في IndexedDB.",e.jsx("br",{}),"تأكد من وجود الملفات في المجلد public/database_chunks/ قبل المزامنة."]}),e.jsxs("button",{onClick:ut,className:"bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded-lg text-xs font-bold flex items-center gap-2",children:[e.jsx(Qe,{className:"w-4 h-4"}),"بدء المزامنة"]})]}),e.jsxs("div",{className:"p-6 bg-green-900/10 border border-green-500/20 rounded-xl",children:[e.jsxs("h3",{className:"font-bold text-green-400 mb-2 flex items-center gap-2",children:[e.jsx(Bt,{className:"w-4 h-4"})," تصدير مجلد منفرد"]}),e.jsx("p",{className:"text-xs text-slate-400 mb-4",children:"اختر مجلداً رئيسياً لتصديره بصيغة JSON منفصلة. يمكن استخدام هذا الملف لاستبدال بيانات المجلد في database_chunks."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:()=>pe("websites"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${Q==="websites"?"bg-green-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"مواقع"}),e.jsx("button",{type:"button",onClick:()=>pe("elements"),className:`px-3 py-1.5 text-xs font-bold rounded transition-colors ${Q==="elements"?"bg-green-600 text-white":"bg-slate-700 hover:bg-slate-600 text-slate-300"}`,children:"عناصر"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 max-h-48 overflow-y-auto pr-2 border border-slate-700 p-2 rounded-lg bg-slate-800/50",children:[I.filter(r=>r.type===Q&&!r.parentId).map(r=>e.jsxs("button",{onClick:()=>Ee(r.id),className:"flex items-center justify-between p-2 bg-slate-700 hover:bg-slate-600 rounded text-sm text-slate-300 transition-colors group",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-4 h-4 text-green-400"}),r.name]}),e.jsx("span",{className:"text-xs text-slate-500 bg-slate-800 px-2 py-0.5 rounded-full",children:z.filter(w=>w.categoryId===r.id).length})]},r.id)),I.filter(r=>r.type===Q&&!r.parentId).length===0&&e.jsx("div",{className:"col-span-2 text-center text-slate-500 py-4 text-xs",children:"لا توجد مجلدات رئيسية من هذا النوع"})]})]})]})]})]})})]}),It&&e.jsx(eo,{isOpen:It,onClose:()=>Be(!1),repository:z,setRepository:_,categories:I,settings:i,setSettings:c,handleDeleteItems:Te,handleMoveItems:ne,handlePreviewItem:he,handleEditVideo:fe,setEditingVideo:ie,setShowEditModal:$e,initialSelectedItems:Pt,setInitialSelectedItems:Se}),e.jsx(ga,{isOpen:Dt,onClose:()=>mt(!1)})]})},so=({isOpen:n,onClose:u,onExportSingle:i,onExportZip:c})=>{const[x,m]=o.useState(!1);return n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-sm z-[300] flex items-center justify-center p-6",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl w-full max-w-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-slate-800",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[e.jsx(Bt,{className:"w-7 h-7 text-blue-500"}),"تصدير نسخة من البيانات"]}),e.jsx("button",{onClick:u,className:"p-2 hover:bg-slate-800 rounded-lg transition-colors",children:e.jsx(Ue,{className:"w-6 h-6 text-slate-400 hover:text-white"})})]}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsx("p",{className:"text-slate-300 text-center mb-6",children:"اختر طريقة التصدير المناسبة لاحتياجاتك"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx("button",{onClick:()=>{i(),u()},className:"group relative p-6 bg-gradient-to-br from-blue-900/30 to-blue-800/20 border-2 border-blue-700/50 hover:border-blue-500 rounded-xl transition-all hover:scale-105 hover:shadow-xl hover:shadow-blue-500/20",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-blue-600/20 rounded-full flex items-center justify-center group-hover:bg-blue-600/30 transition-colors",children:e.jsx(Bt,{className:"w-8 h-8 text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-blue-300 mb-2",children:"ملف واحد مجمع"}),e.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:"تصدير جميع البيانات في ملف JSON واحد"})]}),e.jsxs("div",{className:"pt-3 border-t border-blue-700/30 w-full",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"📄 video-station-data.json"}),e.jsx("p",{className:"text-xs text-blue-400 mt-1",children:"✓ سهل النقل والمشاركة"})]})]})}),e.jsxs("button",{onClick:()=>{c(),u()},className:"group relative p-6 bg-gradient-to-br from-green-900/30 to-green-800/20 border-2 border-green-700/50 hover:border-green-500 rounded-xl transition-all hover:scale-105 hover:shadow-xl hover:shadow-green-500/20",children:[e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-green-600/20 rounded-full flex items-center justify-center group-hover:bg-green-600/30 transition-colors",children:e.jsx(ia,{className:"w-8 h-8 text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-green-300 mb-2",children:"ملف مضغوط (ZIP)"}),e.jsx("p",{className:"text-sm text-slate-400 leading-relaxed",children:"تصدير مجزأ للتحميل السريع"})]}),e.jsxs("div",{className:"pt-3 border-t border-green-700/30 w-full",children:[e.jsx("p",{className:"text-xs text-slate-500",children:"📦 database_chunks.zip"}),e.jsx("p",{className:"text-xs text-green-400 mt-1",children:"✓ تحميل أسرع عند فتح التطبيق"})]})]}),e.jsx("div",{className:"absolute -top-3 -right-3 bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg",children:"موصى به"})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-slate-800/50 border border-slate-700 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-slate-300 flex items-center gap-2",children:[e.jsx(Zs,{className:"w-5 h-5 text-cyan-400"}),"أداة فحص البيانات"]}),e.jsx("p",{className:"text-xs text-slate-400 mt-1",children:"لعرض محتويات ملف التحميل الأولي مباشرةً."})]}),e.jsx("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-red-600 hover:bg-red-500 text-white text-lg font-bold rounded-lg transition-colors",style:{border:"4px solid yellow",padding:"20px",fontSize:"24px"},children:"!!! عرض ملف التحميل السريع !!!"})]})]}),e.jsx("div",{className:"p-6 border-t border-slate-800 flex justify-end",children:e.jsx("button",{onClick:u,className:"px-6 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",children:"إلغاء"})})]})}),e.jsx(ga,{isOpen:x,onClose:()=>m(!1)})]}):null},lo=({vid:n,itemIndex:u,currentVideoId:i,categories:c,onVideoClick:x,onPreview:m,onPlayNow:p,onAddToPlaylist:g,onEdit:$,onDelete:M,onMoveToTop:S,onAddToFavorites:z,viewMode:_,isSelected:I,setItemRef:Y,favoriteVideoUrls:E})=>{const[W,N]=o.useState(!1),[L,H]=o.useState(!1),Z=o.useRef(null),re=E==null?void 0:E.has(n.url);return o.useEffect(()=>{const F=ye=>{Z.current&&!Z.current.contains(ye.target)&&H(!1)};return L?document.addEventListener("mousedown",F):document.removeEventListener("mousedown",F),()=>{document.removeEventListener("mousedown",F)}},[L]),_==="grid"?e.jsxs("div",{ref:Y,className:`group relative aspect-video max-h-42 bg-slate-800 rounded-lg overflow-hidden cursor-pointer shadow-lg transition-all duration-300 hover:scale-105 hover:shadow-yellow-500/30 ${I?"ring-4 ring-yellow-500 bg-yellow-900/30":"hover:ring-2 hover:ring-yellow-500/50"}`,onClick:F=>x(F,n),children:[I&&e.jsx("div",{className:"absolute top-2 left-2 z-20",children:e.jsx("div",{className:"bg-yellow-500 rounded-full p-1 shadow-lg",children:e.jsx("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})})}),re&&e.jsx("div",{className:"absolute top-2 right-12 z-20 pointer-events-none",children:e.jsx(Js,{className:"w-6 h-6 text-yellow-500 fill-current drop-shadow-md"})}),n.movies_img&&!W?e.jsx("img",{src:n.movies_img,alt:n.title,className:"w-full h-full object-cover video-item-image-or-fallback",style:{opacity:"1",visibility:"visible",display:"block"},onError:()=>N(!0)}):e.jsx("div",{className:"w-full h-full bg-slate-900 flex items-center justify-center text-center p-4 text-xl font-bold text-yellow-500 bg-gradient-to-br from-slate-900 to-slate-800 video-item-image-or-fallback",title:n.title,style:{opacity:"1",visibility:"visible",display:"block"},children:e.jsxs("span",{className:"line-clamp-3",children:[typeof u=="number"&&e.jsxs("span",{className:"text-yellow-400 font-mono text-lg",children:[u+1,". "]}),n.title||"بلا عنوان"]})}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-black/40"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-2 z-10 bg-black/30 backdrop-blur-sm",children:e.jsxs("h3",{className:"text-sm font-bold text-white line-clamp-2 video-item-title-h3",style:{opacity:"1",visibility:"visible",display:"block"},children:[typeof u=="number"&&e.jsxs("span",{className:"text-yellow-400 font-mono",children:[u+1,". "]}),n.title||"بلا عنوان"]})}),e.jsx("div",{className:"absolute inset-0 bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:e.jsx("button",{onClick:F=>{F.stopPropagation(),p(n)},className:"bg-yellow-600 text-white rounded-full p-4 shadow-lg hover:scale-110 transition-transform",children:e.jsx(at,{className:"w-6 h-6 fill-current"})})}),e.jsxs("div",{className:"absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-20 flex gap-2",children:[e.jsx("button",{onClick:F=>{F.stopPropagation(),z(n)},className:`${re?"bg-yellow-500 hover:bg-yellow-600":"bg-red-600 hover:bg-red-700"} text-white rounded-full p-2 shadow-lg hover:scale-110 transition-transform`,title:"إضافة إلى المفضلة",children:e.jsx(Js,{className:`w-4 h-4 ${re?"fill-current":""}`})}),e.jsx("button",{onClick:F=>{F.stopPropagation(),g(n)},className:"bg-yellow-600 text-white rounded-full p-2 shadow-lg hover:scale-110 transition-transform",title:"إضافة إلى قائمة التشغيل",children:e.jsx(ct,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200 z-30",ref:Z,children:[e.jsx("button",{onClick:F=>{F.stopPropagation(),H(!L)},className:"p-1.5 bg-slate-800/80 hover:bg-slate-700 rounded-full text-slate-200 transition-colors",title:"خيارات",children:e.jsx(ca,{className:"w-4 h-4"})}),L&&e.jsxs("div",{className:"absolute top-full right-0 mt-1 w-40 bg-slate-900 border border-slate-700 rounded-lg shadow-xl overflow-hidden z-40",children:[e.jsxs("button",{onClick:F=>{F.stopPropagation(),S(n.id),H(!1)},className:"w-full text-right px-3 py-2 text-xs text-slate-300 hover:bg-slate-800 flex items-center gap-2 border-b border-slate-800",children:[e.jsx(zl,{className:"w-3.5 h-3.5 text-green-400"}),e.jsx("span",{children:"نقل للأعلى"})]}),e.jsxs("button",{onClick:F=>{F.stopPropagation(),$(n),H(!1)},className:"w-full text-right px-3 py-2 text-xs text-slate-300 hover:bg-slate-800 flex items-center gap-2 border-b border-slate-800",children:[e.jsx(Ks,{className:"w-3.5 h-3.5 text-blue-400"}),e.jsx("span",{children:"تعديل"})]}),e.jsxs("button",{onClick:F=>{F.stopPropagation(),confirm("حذف الفيديو؟")&&M(n.id),H(!1)},className:"w-full text-right px-3 py-2 text-xs text-red-400 hover:bg-slate-800 hover:text-red-300 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"حذف"})]})]})]})]}):e.jsx("div",{ref:Y,className:`group flex flex-col py-2 px-2 rounded-lg transition-all cursor-pointer w-full ${I?"bg-yellow-800/70 ring-2 ring-yellow-500":i===n.id?"ring-2 ring-yellow-500/80 shadow-lg shadow-yellow-500/30 bg-slate-800":"hover:bg-yellow-800/60"}`,onClick:F=>x(F,n),children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:I?e.jsx("div",{className:"bg-yellow-500 rounded-full p-1 shadow-lg",children:e.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M5 13l4 4L19 7"})})}):e.jsx(at,{className:"w-4 h-4 text-slate-500 group-hover:text-yellow-400 transition-colors"})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col gap-1",children:[e.jsxs("span",{className:"text-base font-semibold text-slate-300 group-hover:text-white transition-colors leading-tight line-clamp-2 ml-1",children:[typeof u=="number"&&e.jsxs("span",{className:"text-yellow-400 ml-1 inline-block",children:[u+1,"."]}),n.title]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity h-0 group-hover:h-auto overflow-hidden group-hover:overflow-visible",children:[e.jsx("button",{onClick:F=>{F.stopPropagation(),p(n)},className:"p-1.5 bg-yellow-600/20 hover:bg-yellow-600/40 rounded-md text-yellow-300 hover:text-white transition-colors",title:"تشغيل الآن",children:e.jsx(at,{className:"w-3 h-3"})}),e.jsx("button",{onClick:F=>{F.stopPropagation(),z(n)},className:`p-1.5 rounded-md transition-colors ${re?"bg-yellow-500/20 hover:bg-yellow-500/40 text-yellow-500 hover:text-white":"bg-red-600/20 hover:bg-red-600/40 text-red-300 hover:text-white"}`,title:"إضافة إلى المفضلة",children:e.jsx(Js,{className:`w-3 h-3 ${re?"fill-current":""}`})}),e.jsx("button",{onClick:F=>{F.stopPropagation(),g(n)},className:"p-1.5 bg-slate-700/50 hover:bg-slate-700 rounded-md text-slate-300 hover:text-white transition-colors",title:"إضافة للقائمة",children:e.jsx(ct,{className:"w-3 h-3"})}),e.jsx("button",{onClick:F=>{F.stopPropagation(),S(n.id)},className:"p-1.5 bg-green-600/20 hover:bg-green-600/40 rounded-md text-green-300 hover:text-white transition-colors",title:"نقل إلى الأعلى",children:e.jsx(zl,{className:"w-3 h-3"})}),e.jsx("button",{onClick:F=>{F.stopPropagation(),$(n)},className:"p-1.5 bg-slate-700/50 hover:bg-slate-700 rounded-md text-slate-300 hover:text-white transition-colors",title:"تعديل",children:e.jsx(Ks,{className:"w-3 h-3"})}),e.jsx("button",{onClick:F=>{F.stopPropagation(),confirm("حذف الفيديو؟")&&M(n.id)},className:"p-1.5 bg-red-800/50 hover:bg-red-700 rounded-md text-red-400 hover:text-white transition-colors",title:"حذف",children:e.jsx(Ce,{className:"w-3 h-3"})})]})]})]})})},oa=Pe.memo(lo),ao=({item:n,index:u,currentIndex:i,onPlay:c,onRemove:x,onMove:m})=>e.jsxs("div",{className:`group flex items-center justify-between p-2 rounded-lg transition-all cursor-pointer ${i===u?"bg-blue-600/20":"hover:bg-slate-800"}`,onClick:()=>c(u),children:[e.jsxs("div",{className:"flex items-center gap-3 overflow-hidden",children:[e.jsx("span",{className:"text-xs font-mono text-slate-500",children:u+1}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("p",{className:"text-base font-medium text-slate-300 truncate",children:n.title})})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:p=>{p.stopPropagation(),m(u,u-1)},className:"p-1 hover:bg-slate-700 rounded disabled:opacity-50",disabled:u===0,title:"Move Up",children:e.jsx(da,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),m(u,u+1)},className:"p-1 hover:bg-slate-700 rounded disabled:opacity-50",title:"Move Down",children:e.jsx(xa,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:p=>{p.stopPropagation(),x(n.playlistId)},className:"p-1 text-red-500/80 hover:bg-red-900/50 hover:text-red-400 rounded",title:"Remove",children:e.jsx(Ce,{className:"w-3.5 h-3.5"})})]})]}),ro=Pe.memo(ao),oo=()=>{const n=o.useRef(null),[u,i]=o.useState(null),[c,x]=o.useState([{id:"default",name:"عام",type:"websites"}]),[m,p]=o.useState([]),[g,$]=o.useState([]),[M,S]=o.useState(-1),[z,_]=o.useState(!1),[I,Y]=o.useState(!1),[E,W]=o.useState("single"),[N,L]=o.useState(!1),[H,Z]=o.useState("json"),[re,F]=o.useState("websites"),[ye,ze]=o.useState(!1),[ge,Ze]=o.useState(1),[ue,Te]=o.useState("playlist"),[ne,he]=o.useState("playlist"),[fe,ie]=o.useState(null),[$e,It]=o.useState("default"),[Be,Pt]=o.useState("default"),[Se,ut]=o.useState(["default"]),[Ee,Et]=o.useState(!1),[qe,et]=o.useState(!1),[ce,Re]=o.useState(!1),[ht,_e]=o.useState(!1),[Yt,Jt]=o.useState(!1),[Mt,Lt]=o.useState(!1),[Dt,mt]=o.useState(!1),[G,tt]=o.useState(!1),[f,P]=o.useState(null),[J,le]=o.useState(null),[se,me]=o.useState(null),[A,B]=o.useState(null),[Q,pe]=o.useState(!0),[Ne,de]=o.useState({x:0,y:0}),[rt,ot]=o.useState(!1),[pt,nt]=o.useState(null),[Ds,Tt]=o.useState(1),[ns,Gt]=o.useState(1),[Ae,$t]=o.useState("list"),[ve,Rt]=o.useState(null),[is,_t]=o.useState("websites"),[Ye,At]=o.useState(null),[cs,gt]=o.useState(!1),[st,Wt]=o.useState(!1),[ds,Xt]=o.useState(""),[Me,Je]=o.useState(""),[Ts,xs]=o.useState(!1),[$s,ll]=o.useState(!1),[Ht,us]=o.useState(!1),[Ot,bt]=o.useState([]),[al,qt]=o.useState(!1),[Rs,Qt]=o.useState(!1),[r,w]=o.useState([]),[v,V]=o.useState([]),[U,D]=o.useState(!1),[O,X]=o.useState(""),[je,Ge]=o.useState({}),[q,We]=o.useState({playbackMode:"sequential",startupMode:"playlist",duration:15,autoPlay:!0,loop:!0,autoDetect:!1,selectedCategories:["default"],autoPlayWebVideos:!0,autoZoomWebVideos:!0,openInNewWindowOnFullscreenFail:!0,showControlPanel:!1,startMuted:!1,quickPlaySelectedCategories:["default"],quickPlaySelectionMethod:"sequential",quickPlayOffsets:{},itemsSortOrder:"newest",openInExternalWindowCategories_Websites:[],openInExternalWindowCategories_Elements:[],displayMode:"full",hiddenCategories:[]}),[ft,Ft]=o.useState(!1),[hs,yt]=o.useState(!1),[jt,wt]=o.useState(!0),[Nt,we]=o.useState({phase:"quick",loaded:0,total:0}),[Oe,Kt]=o.useState([]),[rl,ms]=o.useState(null),[Zt,ee]=o.useState([]),[Fe,ps]=o.useState(!1),[fa,es]=o.useState(!1),[Vt,_s]=o.useState(""),[ts,ol]=o.useState("local"),[As,nl]=o.useState([]),[gs,Os]=o.useState(null),[ya,il]=o.useState(!1),ja=t=>{if(!t)return t;try{const s=new URL(t);return["google.com","wikipedia.org","facebook.com","twitter.com"].some(a=>s.hostname.includes(a))?t:(s.searchParams.has("autoplay")||s.searchParams.set("autoplay","1"),s.searchParams.has("mute")||s.searchParams.set("mute","1"),(s.hostname.includes("youtube.com")||s.hostname.includes("youtu.be"))&&(s.searchParams.has("playsinline")||s.searchParams.set("playsinline","1")),s.toString())}catch{return t}},cl=t=>{const a=(window.screen.width-1280)/2,d=(window.screen.height-720)/2,h=`width=1280,height=720,menubar=no,toolbar=no,location=no,status=no,resizable=yes,scrollbars=yes,left=${a},top=${d}`;let j=t;(j.includes("youtube.com")||j.includes("youtu.be"))&&(j.includes("autoplay=1")||(j+=j.includes("?")?"&autoplay=1":"?autoplay=1"),j.includes("mute=1")||(j+="&mute=1"));try{window.open(j,"_blank",h)}catch(C){console.error("Failed to open external window",C)}};o.useRef(null);const Ie=o.useRef(null),it=o.useRef(null),Ut=o.useRef({}),dl=o.useCallback(async()=>{try{await tl(m),await ma(g),await pa(c),await sl(q)}catch(t){console.error("Auto-save to IndexedDB failed:",t)}},[c,m,g,q]);o.useCallback(async()=>{il(!0)},[]);const xl=o.useCallback(async()=>{const t=await Cs(),s={categories:c,repository:m,playlist:g,settings:q,savedPlaylists:t};try{const l=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),a=URL.createObjectURL(l),d=document.createElement("a");d.href=a,d.download="video-station-data.json",document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(a),alert(`تم تصدير الملف بنجاح!

📄 video-station-data.json
إجمالي العناصر: ${m.length}`)}catch(l){console.error("Single file export failed:",l),alert("فشل تصدير الملف.")}},[c,m,g,q]),ul=o.useCallback(async()=>{const t=await Cs(),s={categories:c,repository:m,playlist:g,settings:q,savedPlaylists:t};try{const l=(await Lr(async()=>{const{default:y}=await import("./jszip.min-cDX0RZc0.js").then(k=>k.j);return{default:y}},__vite__mapDeps([0,1]))).default,a=new l,{quickLoadChunk:d,categoryChunks:h}=Wr(s);a.file("quick-load-data.json",JSON.stringify(d,null,2));for(const[y,k]of h.entries()){const T=c.find(be=>be.id===y),xe=(T==null?void 0:T.name)||y,ae=`category-${Es(xe)}.json`;a.file(ae,JSON.stringify(k,null,2))}const j=await a.generateAsync({type:"blob"}),C=URL.createObjectURL(j),b=document.createElement("a");b.href=C,b.download="database_chunks.zip",document.body.appendChild(b),b.click(),document.body.removeChild(b),URL.revokeObjectURL(C),alert(`تم تصدير الملف المضغوط بنجاح!

📦 database_chunks.zip
يحتوي على:
- ملف التحميل السريع (${d.metadata.quickLoadItems} عنصر)
- ${h.size} ملف مجلد رئيسي

قم بفك الضغط ووضع الملفات في مجلد public/database_chunks/`)}catch(l){console.error("ZIP export failed:",l),l instanceof Error&&l.message.includes("Cannot find module")?alert(`خطأ: مكتبة jszip غير مثبتة.

الرجاء تثبيتها أولاً:
npm install jszip`):alert("فشل تصدير الملف المضغوط.")}},[c,m,g,q]);o.useEffect(()=>{(async()=>{wt(!0),we({phase:"quick",loaded:0,total:1});try{console.log("Initializing application...");const s=await qr(),l=a=>{p(a.repository),x(a.categories.map((y,k)=>({...y,order:y.order??k})).sort((y,k)=>(y.order??0)-(k.order??0))),$(a.playlist),We(y=>({...y,...a.settings})),a.savedPlaylists&&bt(a.savedPlaylists);const d={...q,...a.settings},h=a.repository,j=a.playlist,C=a.categories,b=d.startupMode||"playlist";if(Te(b),he(b),b==="playlist"&&j.length>0)S(0),_(d.autoPlay);else if(b==="repository"&&h.length>0){const y=Array.isArray(d.quickPlaySelectedCategories)?d.quickPlaySelectedCategories:C.map(T=>T.id),k=h.filter(T=>y.includes(T.categoryId||"default"));if(k.length>0){let T=[];const xe=d.quickPlaySelectionMethod||"sequential",te={...d.quickPlayOffsets||{}};switch(xe){case"sequential":let ae=te.global_sequential||0;for(let be=0;be<10;be++)T.push(k[(ae+be)%k.length]);te.global_sequential=(ae+10)%k.length;break;case"random_one_category":if(y.length>0){const be=y[Math.floor(Math.random()*y.length)];T=[...h.filter(Le=>Le.categoryId===be)].sort(()=>.5-Math.random()).slice(0,10)}else T=[...k].sort(()=>.5-Math.random()).slice(0,10);break;case"two_from_each":y.forEach(be=>{const Le=[...h.filter(kt=>kt.categoryId===be)].sort(()=>.5-Math.random()).slice(0,2);T.push(...Le)}),T=T.slice(0,10);break}T.length>0&&(Kt(T),he("quickList"),S(0),_(d.autoPlay),We(ae=>({...ae,quickPlayOffsets:te})))}}console.log("UI state and playback initialized.")};if(s&&s.repository.length>0)console.log("Loaded data from IndexedDB."),l(s),we({phase:"complete",loaded:s.repository.length,total:s.repository.length}),wt(!1);else{console.log("Database is empty. Seeding from JSON file.");const a=await Ur();a?(console.log(`Quick load successful. Loaded ${a.quickLoad.repository.length} initial items.`),l(a.quickLoad),await Fr(a.quickLoad),we({phase:"quick",loaded:1,total:1}),wt(!1),(async()=>{var j,C;const h=a.fullLoad.repository;if(h.length>0){console.log(`Starting background load of ${h.length} additional items...`),we({phase:"full",loaded:0,total:h.length});const b=Xr(h,100);let y=0;for(const k of b)await Hr(150),await Hs(k),p(T=>Ke(T,k)),y+=k.length,we(T=>({...T,phase:"full",loaded:y}));console.log("Single file background loading complete.")}else{console.log("Detected chunked data mode. Starting background fetch of category chunks...");const b=(((j=a.metadata)==null?void 0:j.totalItems)||0)-(((C=a.metadata)==null?void 0:C.quickLoadItems)||0);we({phase:"full",loaded:0,total:b>0?b:1e3});let y=0;await ra(a.quickLoad.categories,async k=>{await Hs(k),p(T=>Ke(T,k)),y+=k.length,we(T=>({...T,phase:"full",loaded:y}))}),console.log("Chunked background loading complete.")}console.log("All data loading complete."),p(b=>{const y=b.length;return we({phase:"complete",loaded:y,total:y}),b})})()):(console.error("Failed to load initial data from file."),wt(!1),we({phase:"complete",loaded:0,total:0}))}}catch(s){console.error("Initialization failed:",s),wt(!1)}})()},[]),o.useEffect(()=>{const t=setTimeout(()=>{jt||dl()},3e3);return()=>clearTimeout(t)},[c,m,g,q,dl,jt]),o.useEffect(()=>{const t=()=>Et(!!document.fullscreenElement);return document.addEventListener("fullscreenchange",t),()=>document.removeEventListener("fullscreenchange",t)},[]),o.useEffect(()=>{I&&W("single")},[I]);const ss=o.useRef(null),qs=o.useCallback(t=>{Ee&&t.clientY<100&&(Re(!0),ss.current&&clearTimeout(ss.current),ss.current=setTimeout(()=>{Re(!1)},3e3))},[Ee]);o.useEffect(()=>{if(Ee)return document.addEventListener("mousemove",qs),()=>{document.removeEventListener("mousemove",qs),ss.current&&clearTimeout(ss.current)}},[Ee,qs,Re]),o.useLayoutEffect(()=>{u!==null&&n.current&&(n.current.scrollTop=u,i(null))},[u]);const wa=t=>{if(!G)return;t.preventDefault();const s=t.currentTarget.getBoundingClientRect(),l=(t.clientX-s.left)/s.width*100,a=(t.clientY-s.top)/s.height*100;P({x:l,y:a}),le({x:l,y:a})},Na=t=>{if(!G||!f)return;t.preventDefault();const s=t.currentTarget.getBoundingClientRect(),l=(t.clientX-s.left)/s.width*100,a=(t.clientY-s.top)/s.height*100;le({x:l,y:a})},hl=t=>{if(!G||!f||!J)return;t.preventDefault();const s=Math.abs(J.x-f.x),l=Math.abs(J.y-f.y);if(s>3&&l>3){const a=Math.min(f.x,J.x),d=Math.min(f.y,J.y);B({x:a,y:d,width:s,height:l})}P(null),le(null)},va=()=>{var t;if(A){if(me(A),(t=Ie.current)!=null&&t.parentElement){const s=Ie.current.parentElement.getBoundingClientRect(),l=s.width/(A.width/100*s.width),a=s.height/(A.height/100*s.height),d=Math.min(l,a);Ze(d);const h=A.x+A.width/2,j=A.y+A.height/2,C=h/100*s.width*d,b=j/100*s.height*d,y=s.width/2,k=s.height/2,T=y-C,xe=k-b;de({x:T,y:xe})}B(null),tt(!1),pe(!0)}},ka=()=>{B(null),P(null),le(null)},Ca=t=>{ge===1&&!se||G||(t.preventDefault(),ot(!0),nt({x:t.clientX-Ne.x,y:t.clientY-Ne.y}))},Sa=t=>{if(!rt||!pt)return;t.preventDefault();const s=t.clientX-pt.x,l=t.clientY-pt.y;de({x:s,y:l})},ml=()=>{ot(!1),nt(null)},Ia=()=>{me(null),B(null),Ze(1),de({x:0,y:0}),tt(!1),P(null),le(null),ot(!1),nt(null),Tt(1),Gt(1),pe(!0)},bs=t=>{de(l=>{switch(t){case"up":return{x:l.x,y:l.y+50};case"down":return{x:l.x,y:l.y-50};case"left":return{x:l.x+50,y:l.y};case"right":return{x:l.x-50,y:l.y};default:return l}})},Ve=Pe.useMemo(()=>{switch(ne){case"quickList":return Oe;case"playlist":return g;case"repository":return m.filter(t=>q.selectedCategories.includes(t.categoryId||"default"));default:return g}},[ne,Oe,g,m,q.selectedCategories]),R=fe||Ve[M];o.useEffect(()=>{if(qe&&R&&Ut.current[R.id]){const t=c.find(s=>s.id===R.categoryId);if(t){const s=Se.includes(t.id),l=t.parentId&&Se.includes(t.parentId);(s||l)&&setTimeout(()=>{var a;(a=Ut.current[R.id])==null||a.scrollIntoView({behavior:"smooth",block:"center"})},150)}}},[R,Se,c,qe]);const He=o.useCallback(()=>{if(fe||Ve.length===0)return;let t=0;if(q.playbackMode==="random")t=Math.floor(Math.random()*Ve.length);else if(t=(M+1)%Ve.length,t===0&&!q.loop){_(!1);return}S(t)},[Ve,M,q,fe]),pl=o.useCallback(()=>{if(fe||Ve.length===0)return;const t=(M-1+Ve.length)%Ve.length;S(t)},[Ve,M,fe]);o.useEffect(()=>{if(!Ie.current||!R||!R.url||!z||_l(R.url)||R.url.match(/\.(mp4|webm|ogg)$/i))return;let t=!1;const s=Ie.current;let l=null,a=null;const d=()=>{console.error("Iframe failed to load (network error). Skipping to next video."),He()},h=b=>{a&&clearInterval(a),a=setInterval(()=>{try{(b.ended||b.duration>0&&b.currentTime>=b.duration-1)&&(q.autoPlay&&(console.log("Video ended, advancing to next."),He()),a&&clearInterval(a))}catch{a&&clearInterval(a)}},1e3)},j=()=>{var k;t=!0;let b=!1,y=!1;try{b=!!((k=s.contentWindow)!=null&&k.document.location.href);const T=s.contentDocument;if(T){const xe=[".error",".error-message",".error-page",'[class*="error"]','[id*="error"]',".refused",".connection-refused",'[class*="refused"]','[id*="refused"]'];for(const te of xe){const ae=T.querySelector(te);if(ae&&ae.textContent){const be=ae.textContent.toLowerCase();if(be.includes("refused to connect")||be.includes("connection refused")||be.includes("access denied")||be.includes("forbidden")){y=!0,console.error(`Error detected in iframe: ${be}`);break}}}}}catch{b=!1}if(b&&!y){console.log("Iframe finished loading and is accessible. Starting auto-play enforcer."),l&&clearInterval(l),a&&clearInterval(a);let T=0;const xe=30;l=setInterval(()=>{if(T>=xe){l&&clearInterval(l);return}T++;try{const te=s.contentDocument;if(!te){l&&clearInterval(l);return}const ae=te.querySelector("video");if(ae&&!ae.paused){l&&clearInterval(l),h(ae);return}const be=['button[aria-label*="Play"]','button[aria-label*="play"]',".ytp-play-button",".play-button",'[data-testid="play-button"]',".vjs-big-play-button",'div[role="button"][aria-label*="Play"]'],lt=te.querySelector(be.join(", "));if(lt instanceof HTMLElement&&lt.offsetParent!==null){lt.click();return}if(ae&&ae.paused){ae.muted=!0,ae.play().catch(()=>{});return}}catch{l&&clearInterval(l)}},500)}else console.error("Iframe content is not accessible (likely due to X-Frame-Options)."),console.log("Iframe is not accessible, but we will keep it in the app.")},C=setTimeout(()=>{t||(console.error("Iframe failed to load within timeout period."),console.log("Iframe failed to load, but we will keep it in the app."))},5e3);return s.addEventListener("load",j),s.addEventListener("error",d),()=>{clearTimeout(C),s.removeEventListener("load",j),s.removeEventListener("error",d),l&&clearInterval(l),a&&clearInterval(a)}},[R,q.autoPlay,He]),o.useEffect(()=>{if(!R||!Bs(R.url)){if(it.current&&it.current.destroy){try{document.getElementById("youtube-player-container")&&it.current.destroy()}catch(l){console.error("Error destroying YouTube player:",l)}it.current=null}return}const t=Bs(R.url);if(!t)return;const s=()=>{if(it.current&&it.current.destroy)try{it.current.destroy()}catch(l){console.error("Error destroying YouTube player:",l)}if(document.getElementById("youtube-player-container"))try{it.current=new window.YT.Player("youtube-player-container",{videoId:t,playerVars:{autoplay:1,enablejsapi:1,origin:window.location.origin,host:"https://www.youtube.com",widget_referrer:window.location.href,mute:q.startMuted?1:0},events:{onReady:l=>{q.autoPlay&&l.target.playVideo()},onStateChange:l=>{l.data===0&&q.autoPlay&&He()},onError:l=>{const a=l.data;console.error("YouTube Player error:",a),(a===101||a===150||a===100)&&R&&R.url&&console.log(`YouTube error ${a}, but we will keep it in the app.`),He()}}})}catch(l){console.error("YouTube Player API initialization error:",l)}};if(!window.YT||!window.YT.Player){const l=document.createElement("script");l.src="https://www.youtube.com/iframe_api";const a=document.getElementsByTagName("script")[0];a&&a.parentNode&&a.parentNode.insertBefore(l,a),window.onYouTubeIframeAPIReady=s}else s()},[R,q.autoPlay,He,q.startMuted]),o.useEffect(()=>{R&&ee(t=>{const s=t.findIndex(a=>a.id===R.id);let l=[...t];return s!==-1&&l.splice(s,1),l.unshift(R),l})},[R]);const gl=t=>{var a;if(!((a=Ie.current)!=null&&a.parentElement))return;const s=Ie.current.parentElement.getBoundingClientRect(),l={x:s.width/2,y:s.height/2};Ze(d=>{const h=t==="in"?Math.min(d+.1,5):Math.max(d-.1,.5);return h===d?d:(de(j=>{const C=l.x-(l.x-j.x)*(h/d),b=l.y-(l.y-j.y)*(h/d);return{x:C,y:b}}),h)})},bl=()=>{gl("in")},fl=()=>{gl("out")},yl=()=>{Ia()},Pa=()=>{Ze(1.35),de({x:0,y:0}),me({x:0,y:0,width:100,height:100}),pe(!0)},jl=o.useCallback(t=>{ie(t)},[]),wl=Pe.useMemo(()=>q.categoriesFavoriteFolders?Object.values(q.categoriesFavoriteFolders):[],[q.categoriesFavoriteFolders]),Nl=Pe.useMemo(()=>new Set(m.filter(t=>wl.includes(t.categoryId||"")).map(t=>t.url)),[m,wl]),vl=(t,s)=>{const{ctrlKey:l,metaKey:a,shiftKey:d}=t,h=c.find(j=>j.id===s.categoryId);if(h&&!l&&!a&&!d){const j=[h.id];let C=h;for(;C.parentId;)j.push(C.parentId),C=c.find(k=>k.id===C.parentId)||C;const b=h.type==="websites"&&j.some(k=>{var T;return(T=q.openInExternalWindowCategories_Websites)==null?void 0:T.includes(k)}),y=h.type==="elements"&&j.some(k=>{var T;return(T=q.openInExternalWindowCategories_Elements)==null?void 0:T.includes(k)});if(b||y){cl(s.url);return}}if(l||a)t.preventDefault(),V(j=>j.includes(s.id)?j.filter(C=>C!==s.id):[...j,s.id]);else if(d&&v.length>0){t.preventDefault();const j=m.filter(k=>k.categoryId===s.categoryId),C=v[v.length-1],b=j.findIndex(k=>k.id===C),y=j.findIndex(k=>k.id===s.id);if(b!==-1&&y!==-1){const k=Math.min(b,y),T=Math.max(b,y),xe=j.slice(k,T+1).map(te=>te.id);V(te=>[...new Set([...te,...xe])])}}else V([s.id]),ys(s)},Fs=o.useCallback(t=>{At(t),gt(!0)},[]),Ea=t=>{if(t.preventDefault(),!Ye)return;const s=new FormData(t.currentTarget),l=s.get("title"),a=s.get("url"),d=s.get("categoryId");p(h=>h.map(j=>j.id===Ye.id?{...j,title:l,url:a,categoryId:d||j.categoryId||"default"}:j)),gt(!1),At(null)},Ma=t=>{t.preventDefault();const s=new FormData(t.currentTarget),l=s.get("title"),a=s.get("categoryId"),d=ds||Me;if(l&&d){const h={id:Math.random().toString(36).substr(2,9),title:l,url:d,timestamp:Date.now(),categoryId:a||"default"};p([...m,h]),Wt(!1),alert("تم حفظ الرابط بنجاح!")}},La=t=>{if(t==="default"){alert("لا يمكن حذف محتويات القسم العام بهذه الطريقة.");return}const s=c.find(l=>l.id===t);s&&confirm(`هل أنت متأكد من حذف جميع العناصر داخل قسم "${s.name}"؟ سيتم حذف الفيديوهات نهائياً ولن يتم نقلها.`)&&(p(l=>l.filter(a=>a.categoryId!==t)),alert(`تم حذف جميع العناصر من قسم "${s.name}".`))},kl=t=>{ut(s=>s.includes(t)?s.filter(l=>l!==t):[...s,t])},Da=o.useCallback((t,s,l)=>{if(!t||!t.trim())return;const a={id:Math.random().toString(36).substr(2,9),name:t.trim(),type:s,parentId:l};x(d=>[...d,a])},[]),Ta=o.useCallback(t=>{const s=Xe(t,c),l=new Set([t,...Array.from(s)]);return m.filter(a=>l.has(a.categoryId||"")).length},[m,c]),$a=o.useCallback((t,s)=>{if(!s.trim()){alert("لا يمكن أن يكون اسم القسم فارغًا.");return}x(l=>l.map(d=>d.id===t?{...d,name:s.trim()}:d))},[]),Cl=o.useCallback(t=>{if(t==="default"){alert("لا يمكن حذف القسم العام.");return}x(s=>{const l=s.find(h=>h.id===t);if(!l||!confirm(`هل أنت متأكد من حذف قسم "${l.name}"؟ سيتضمن الحذف جميع الأقسام الفرعية والعناصر المرتبطة به. هذه العملية لا يمكن التراجع عنها.`))return s;const a=Xe(t,s),d=s.filter(h=>!a.has(h.id));return p(h=>h.map(j=>{if(a.has(j.categoryId||"")){let C=l.parentId;for(;C&&a.has(C);){const b=s.find(y=>y.id===C);C=b==null?void 0:b.parentId}return{...j,categoryId:C||"default"}}return j})),ut(h=>h.filter(j=>!a.has(j))),d})},[Xe]),Ra=o.useCallback(t=>{x(s=>{const l=new Map(t.map(d=>[d.id,{...d}]));return s.map(d=>l.has(d.id)?l.get(d.id):d).sort((d,h)=>(d.order??0)-(h.order??0))})},[]);o.useCallback((t,s)=>{p(l=>l.map(a=>a.id===t?{...a,categoryId:s}:a))},[]);const _a=t=>{const s=m.filter(a=>a.categoryId===t);if(s.length===0){alert("المجلد فارغ");return}const l=s.map(a=>({...a,playlistId:`playlist_${Date.now()}_${Math.random()}`,videoId:a.id}));$(a=>[...a,...l]),alert(`تم إضافة ${s.length} فيديو إلى قائمة التشغيل`)},Sl=t=>{if(m.filter(l=>l.categoryId===t).length===0){alert("المجلد فارغ");return}he("repository"),We(l=>({...l,selectedCategories:[t]})),S(0),_(!0)},Aa=async(t,s)=>{if(!t.trim()){alert("الرجاء إدخال روابط");return}const l=t.split(`
`).filter(a=>a.trim()!=="");if(l.length>0){const a=l.map(async h=>{const{title:j,movies_img:C}=await $l(h.trim());return{id:Math.random().toString(36).substr(2,9),title:j,url:h.trim(),movies_img:C,timestamp:Date.now(),categoryId:s}}),d=await Promise.all(a);p(h=>[...h,...d]),alert(`تمت إضافة ${d.length} رابط إلى القسم المحدد بنجاح`),Y(!1)}else alert("لم يتم العثور على روابط صالحة.")},Oa=async t=>{t.preventDefault();const s=new FormData(t.currentTarget),l=s.get("title"),a=s.get("url"),d=s.get("categoryId");if(a){const{title:h,movies_img:j}=await $l(a.trim()),C=l.trim()!==""?l:h,b={id:Math.random().toString(36).substr(2,9),title:C,url:a,movies_img:j,timestamp:Date.now(),categoryId:d||"default"};p([...m,b]),Y(!1)}else alert("الرجاء إدخال رابط للفيديو.")},fs=o.useCallback(t=>{const s={...t,playlistId:Math.random().toString(36).substr(2,9)};$(l=>[...l,s]),M===-1&&S(0)},[M]),Il=o.useCallback(t=>{confirm("حذف الفيديو؟")&&p(s=>s.filter(l=>l.id!==t))},[]),Pl=o.useCallback(async()=>{var s;if(confirm(`هل تريد بدء تحديث البيانات في الخلفية؟

يمكنك استكمال استخدام التطبيق بينما يتم تحميل البيانات الجديدة.`))try{we({phase:"full",loaded:0,total:2e3});const l=await Qr();if(!l){alert("فشل بدء التحديث. تأكد من وجود المجلد database_chunks."),we({phase:"complete",loaded:0,total:0});return}const a=Ke(m,l.quickLoad.repository),d=Ke(c,l.quickLoad.categories);p(a),x(d),We(b=>({...b,...l.quickLoad.settings}));const h=l.quickLoad.categories,j=((s=l.metadata)==null?void 0:s.totalItems)||0;we({phase:"full",loaded:a.length,total:j>0?j:2e3});let C=a.length;await ra(h,async b=>{await Hs(b),p(y=>{const k=Ke(y,b);return C=k.length,k}),we(y=>({...y,phase:"full",loaded:C}))}),we(b=>({...b,phase:"complete",loaded:C,total:C})),alert("تم تحديث البيانات بنجاح! ✅")}catch(l){console.error("Manual sync failed:",l),alert("فشلت عملية المزامنة اليدوية."),we({phase:"complete",loaded:0,total:0})}},[m,c,q]),qa=o.useCallback(t=>{const s=Kr(t,m,c);if(!s){alert("فشل تصدير المجلد.");return}try{const l=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),a=URL.createObjectURL(l),d=document.createElement("a");d.href=a,d.download=`category-${s.metadata.categoryName.replace(/[^a-z0-9]/gi,"_")}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(a),alert(`تم تصدير المجلد "${s.metadata.categoryName}" بنجاح!

عدد العناصر: ${s.metadata.totalItems}`)}catch(l){console.error("Export single category failed:",l),alert("فشل تصدير المجلد.")}},[m,c]),El=o.useCallback(t=>{confirm(`هل أنت متأكد من حذف ${t.length} عنصر؟`)&&p(s=>s.filter(l=>!t.includes(l.id)))},[]),Fa=o.useCallback((t,s)=>{p(l=>l.map(a=>t.includes(a.id)?{...a,categoryId:s}:a))},[]),Ml=o.useCallback(t=>{n.current&&i(n.current.scrollTop),We(s=>({...s,itemsSortOrder:"manual"})),p(s=>{const l=s.findIndex(b=>b.id===t);if(l===-1)return i(null),s;const a={...s[l],timestamp:Date.now()},d=a.categoryId,h=s.findIndex(b=>b.categoryId===d);if(l===h)return i(null),s.map(b=>b.id===t?a:b);const j=[...s];j.splice(l,1);const C=j.findIndex(b=>b.categoryId===d);return C!==-1?j.splice(C,0,a):j.unshift(a),j})},[]),Ll=o.useCallback(t=>{var C,b;let s=c.find(y=>y.id===t.categoryId),l=s==null?void 0:s.id;if(s)for(;s.parentId;){const y=c.find(k=>k.id===s.parentId);if(!y)break;s=y,l=y.id}if(!l){alert("لم يتم العثور على القسم الرئيسي لهذا العنصر.");return}const a=(C=q.categoriesFavoriteFolders)==null?void 0:C[l];if(!a){alert(`الرجاء تحديد مجلد المفضلة لهذا القسم في لوحة التحكم أولاً.
قسم الإعدادات -> إعدادات مجلد المفضلة.`),Ft(!0);return}if(a===t.categoryId){alert("العنصر موجود بالفعل في مجلد المفضلة هذا.");return}if(m.some(y=>y.url===t.url&&y.categoryId===a)){alert("هذا العنصر موجود بالفعل في المفضلة.");return}const h={...t,id:`fav_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,categoryId:a,timestamp:Date.now()};p(y=>[...y,h]);const j=((b=c.find(y=>y.id===a))==null?void 0:b.name)||"المفضلة";alert(`تم نسخ العنصر إلى "${j}" بنجاح.`)},[c,q.categoriesFavoriteFolders,m]),{repositionModalsForPreview:Dl}=el(),Va=()=>{Ft(!1),yt(!1)},Ua=o.useCallback(t=>{ie(t),Ft(!0),yt(!0),Dl()},[Dl]),za=o.useCallback(t=>{$(s=>{const l=s.filter(a=>a.playlistId!==t);return l.length===0?(S(-1),_(!1)):M>=l.length&&S(l.length-1),l})},[M]),Ba=o.useCallback(t=>{S(t),_(!0),he("playlist"),ie(null)},[]),Ya=o.useCallback((t,s)=>{$(l=>{const a=[...l];if(s<0||s>=a.length)return a;const[d]=a.splice(t,1);return a.splice(s,0,d),M===t?S(s):M>t&&M<=s?S(h=>h-1):M<t&&M>=s&&S(h=>h+1),a})},[M]),Ja=()=>{confirm("هل أنت متأكد من حذف كل الفيديوهات؟")&&p([])},Tl=()=>{confirm("هل أنت متأكد من مسح قائمة التشغيل الحالية؟")&&(ne==="playlist"?($([]),he("quickList"),Oe.length>0?(S(0),_(!0)):window.location.reload()):$([]))},Ga=t=>{if(t.preventDefault(),!!Vt.trim())if(ts==="google"){const s=`https://www.google.com/search?q=${encodeURIComponent(Vt)}&igu=1`,a={...{id:"google-search-"+Date.now(),title:`Google: ${Vt}`,url:s,timestamp:Date.now(),categoryId:"default"},playlistId:"temp_"+Date.now()};$(d=>[a,...d]),S(0),he("playlist"),_(!0),es(!1),_s("")}else{const s=m.filter(l=>l.title&&l.title.toLowerCase().includes(Vt.toLowerCase())||l.url&&l.url.toLowerCase().includes(Vt.toLowerCase()));nl(s)}},Wa=t=>{const s={...t,playlistId:"search_"+Date.now()};$(l=>[s,...l]),S(0),he("playlist"),_(!0),es(!1),_s(""),nl([])},Xa=async()=>{const t=await Cs(),l=JSON.stringify({categories:c,repository:m,playlist:g,settings:q,savedPlaylists:t},null,2),a=new Blob([l],{type:"application/json"}),d=URL.createObjectURL(a),h=document.createElement("a"),j=confirm(`هل تريد حفظ الملف باسم "video-station-data.json" مباشرة؟
(موافق: video-station-data.json، إلغاء: video_station_full_data.json)`);h.href=d,h.download=j?"video-station-data.json":"video_station_full_data.json",h.click(),URL.revokeObjectURL(d),alert("تم تصدير جميع بيانات التطبيق بنجاح!")},Ha=async()=>{try{const t=await Cs(),a=Jr({repository:m,categories:c,playlist:g,savedPlaylists:t,settings:q}).quickLoad,d=JSON.stringify(a,null,2),h=new Blob([d],{type:"application/json"}),j=URL.createObjectURL(h),C=document.createElement("a");C.href=j,C.download="quick-load-data.json",C.click(),URL.revokeObjectURL(j),alert("تم تصدير ملف التحميل الأولي بنجاح!")}catch(t){console.error("Error exporting quick load data:",t),alert("حدث خطأ أثناء تصدير ملف التحميل الأولي")}},$l=async t=>{try{let l=new URL(t).hostname;l=l.replace(/^www\./,"");const a=Bs(t);if(a){const d=`https://i.ytimg.com/vi/${a}/hqdefault.jpg`;return{title:`YouTube Video (${a})`,movies_img:d}}return{title:l}}catch{return{title:t.length>50?t.substring(0,50)+"...":t}}},Qa=t=>{var s;try{const l=JSON.parse(t);let a=[];if(Array.isArray(l)?a=l:typeof l=="object"&&l!==null&&(Array.isArray(l.movies_info)?a=l.movies_info:Array.isArray(l.videos)?a=l.videos:Array.isArray(l.items)&&(a=l.items)),a.length>0){const d=a.map(h=>{const j=h.title||h.movies_name||h.series_name||h.name||"فيديو بدون عنوان",C=h.url||h.link||h.movies_href||h.series_href||h.src||"#",b=h.movies_img||h.series_img||h.imageUrl;return{id:h.id||Math.random().toString(36).substr(2,9),title:j,url:C,movies_img:b,timestamp:h.timestamp||Date.now(),categoryId:$e}});console.log("importJSON: Normalized data for repository:",d),p(h=>[...h,...d]),alert(`تم استيراد ${d.length} فيديو إلى القسم "${((s=c.find(h=>h.id===$e))==null?void 0:s.name)||"عام"}" بنجاح`),L(!1)}else alert('لم يتم العثور على بيانات صالحة. تأكد من أن الملف يحتوي على مصفوفة فيديوهات أو كائن "movies_info"')}catch(l){alert("خطأ في صيغة JSON: "+l.message)}},Ka=async()=>{if(!window.showOpenFilePicker){alert("متصفحك لا يدعم واجهة برمجة تطبيقات File System Access API. يرجى استخدام أحدث إصدار من Chrome أو Edge.");return}try{const[t]=await window.showOpenFilePicker({types:[{description:"JSON Files",accept:{"application/json":[".json"]}}],multiple:!1}),s=await t.getFile(),l=await s.text();try{const a=JSON.parse(l);if(a.categories&&x(a.categories),a.repository){const d=a.repository.map(h=>({...h,categoryId:h.categoryId||"default"}));p(d)}a.playlist&&$(a.playlist),a.settings&&We({...a.settings,selectedCategories:a.settings.selectedCategories||["default"]}),a.savedPlaylists&&bt(a.savedPlaylists),ms(t),alert(`تم تحميل البيانات بنجاح من ملف: ${s.name}`)}catch(a){console.error("Failed to parse selected JSON:",a),alert("خطأ في تحليل ملف JSON المحدد.")}}catch(t){t.name==="AbortError"?console.log("User cancelled file picker."):(console.error("Error opening file picker:",t),alert("فشل في فتح منتقي الملفات أو قراءة الملف."))}},Za=t=>{const s=t.indexOf("@");if(s===-1)return null;const l=t.lastIndexOf(".");let a=l!==-1?t.substring(s+1,l):t.substring(s+1);const d=/_\d+items$/;d.test(a)&&(a=a.replace(d,""));const h=/_items$/;return h.test(a)&&(a=a.replace(h,"")),a},Rl=async t=>{var y;const s=t.target.files;if(!s||s.length===0)return;const l=(y=document.getElementById("create-category-per-file-checkbox"))==null?void 0:y.checked;let a=0,d=0;const h=k=>new Promise(T=>{const xe=new FileReader,te=l?Za(k.name):null;xe.onload=ae=>{var be;try{const lt=(be=ae.target)==null?void 0:be.result,Le=JSON.parse(lt);let kt=[];Array.isArray(Le)?kt=Le:typeof Le=="object"&&Le!==null&&(Array.isArray(Le.movies_info)?kt=Le.movies_info:Array.isArray(Le.videos)?kt=Le.videos:Array.isArray(Le.items)&&(kt=Le.items));const lr=kt.map(De=>{const ar=De.title||De.movies_name||De.series_name||De.name||"فيديو بدون عنوان",rr=De.url||De.link||De.movies_href||De.series_href||De.src||"#",or=De.movies_img||De.series_img||De.imageUrl;return{id:De.id||Math.random().toString(36).substr(2,9),title:ar,url:rr,movies_img:or,timestamp:De.timestamp||Date.now(),categoryId:""}});T({videos:lr,categoryName:te})}catch(lt){console.error(`Error parsing file ${k.name}:`,lt),T({videos:[],categoryName:null})}},xe.onerror=()=>T({videos:[],categoryName:null}),xe.readAsText(k)}),j=await Promise.all(Array.from(s).map(h));let C=[],b=[...c];j.forEach(k=>{if(k.videos.length>0){d++,a+=k.videos.length;let T=$e;if(k.categoryName){const te=b.find(ae=>ae.name===k.categoryName);if(te)T=te.id;else{const ae={id:`cat_${Date.now()}_${Math.random().toString(36).substring(2,9)}`,name:k.categoryName,type:"websites",parentId:l&&$e!=="default"?$e:void 0};b.push(ae),T=ae.id}}const xe=k.videos.map(te=>({...te,categoryId:T}));C.push(...xe)}}),p(k=>[...k,...C]),x(b),a>0?alert(`تم بنجاح استيراد ${a} فيديو من ${d} ملفات.`):alert("لم يتم استيراد أي بيانات صالحة من الملفات المحددة."),L(!1),t.target&&(t.target.value="")},ys=o.useCallback(t=>{he("quickList"),Kt(s=>{const l=s.findIndex(d=>d.id===t.id);let a=[...s];return l!==-1&&a.splice(l,1),a.unshift(t),a}),S(0),_(!0),ie(null)},[]),Vs=(t,s)=>{Os(s),t.dataTransfer.effectAllowed="move"},Us=t=>{t.preventDefault()},zs=(t,s)=>{if(!gs)return;const l=Xe(gs.id,c);if(gs.id===s.id||l.has(s.id)){Os(null);return}const a=c.map(d=>d.id===gs.id?{...d,parentId:s.id}:d);x(a),Os(null)},Bs=t=>{if(!t)return null;let s=null;const l=[/(?:https?:\/\/)?(?:www\.)?youtube\.com\/(?:watch\?v=|embed\/|v\/|shorts\/)([\w-]{11})/,/(?:https?:\/\/)?(?:www\.)?youtu\.be\/([\w-]{11})/];try{for(const a of l){const d=t.match(a);if(d&&d[1]){s=d[1];break}}return s}catch(a){return console.error("Error parsing YouTube URL:",a),null}},_l=t=>{if(!t)return null;let s=null;const l=[/(?:https?:\/\/)?(?:www\.)?youtube\.com\/(?:watch\?v=|embed\/|v\/|shorts\/)([\w-]{11})/,/(?:https?:\/\/)?(?:www\.)?youtu\.be\/([\w-]{11})/];try{for(const a of l){const d=t.match(a);if(d&&d[1]){s=d[1];break}}return s?`https://www.youtube.com/embed/${s}?autoplay=1&enablejsapi=1&origin=${window.location.origin}`:null}catch(a){return console.error("Error parsing YouTube URL:",a),null}},er=o.useRef(null),js=o.useCallback(t=>{if(Ie.current)try{const s=Ie.current.contentWindow;if(!s)return;switch(t){case"back":s.history.back();break;case"forward":s.history.forward();break;case"reload":s.location.reload();break;case"home":R!=null&&R.url&&(Ie.current.src=R.url,Xt(R.url),Je(R.url));break}}catch(s){console.error("Navigation error:",s)}},[R]),tr=o.useCallback(t=>{if(t.preventDefault(),!Ie.current||!Me.trim())return;let s=Me.trim();s.match(/^https?:\/\//i)||(s="https://"+s),Ie.current.src=s,Xt(s)},[Me]);o.useCallback(()=>{if(!(!Ie.current||!confirm(`⚠️ تنبيه:

ملء الشاشة للإطار له قيود:
• لن تتمكن من تكبير الفيديو الداخلي
• قد لا تعمل بعض الأزرار داخل الصفحة

✅ للتحكم الكامل، استخدم زر "النافذة المنفصلة" (الزر الأخضر)

هل تريد المتابعة مع ملء الشاشة للإطار؟`)))try{Ie.current.requestFullscreen&&Ie.current.requestFullscreen()}catch(s){console.error("Fullscreen error:",s),alert("فشل تفعيل ملء الشاشة. استخدم زر النافذة المنفصلة (الأخضر) بدلاً من ذلك.")}},[]),o.useCallback(()=>{if(!(R!=null&&R.url))return;const t=window.screen.width*.9,s=window.screen.height*.9,l=(window.screen.width-t)/2,a=(window.screen.height-s)/2;window.open(R.url,"VideoPopup",`width=${t},height=${s},left=${l},top=${a},toolbar=yes,location=yes,menubar=yes,resizable=yes,scrollbars=yes`)},[R]);const Al=()=>{const t=prompt("أدخل اسم قائمة التشغيل الجديدة:");if(t&&t.trim()){const s={id:Math.random().toString(36).substr(2,9),name:t.trim(),items:[...g]};bt(l=>[...l,s]),la(s),alert("تم حفظ القائمة بنجاح")}},sr=()=>{if(Oe.length===0){alert("قائمة التشغيل السريع فارغة!");return}const t=prompt("أدخل اسم قائمة التشغيل الجديدة:");if(t&&t.trim()){const s={id:Math.random().toString(36).substr(2,9),name:t.trim(),items:Oe.map(l=>({...l,playlistId:`pli_${Date.now()}_${Math.random().toString(36).substring(2,9)}`}))};bt(l=>[...l,s]),la(s),alert("تم حفظ القائمة بنجاح")}},Ol=t=>{confirm("هل أنت متأكد من حذف قائمة التشغيل المحفوظة هذه؟")&&(bt(s=>s.filter(l=>l.id!==t)),Or(t))},Ys=t=>{const s=Ot.find(l=>l.id===t);if(s){if(g.length>0&&!confirm("هل تريد استبدال القائمة الحالية؟"))return;$(s.items),he("playlist"),S(0),_(!0)}},ql=as(c).filter(t=>t.type==="websites"),Fl=as(c).filter(t=>t.type==="elements"),vt=50,ws=Math.round(96/2.54*2),Vl=(t,s,l)=>{const a=je[t]||0,d=Math.ceil(s/vt);return d<=1?null:e.jsxs("div",{className:"flex items-center justify-center gap-2 mt-2 py-2 border-t border-slate-800/50 bg-slate-900/50 rounded-lg",dir:"ltr",children:[e.jsx("button",{onClick:h=>{h.stopPropagation();const j=Math.max(0,a-1);Ge(y=>({...y,[t]:j}));const C=j*vt,b=l[C]||l[l.length-1];b&&setTimeout(()=>{const y=Ut.current[b.id];if(!y)return;const k=n.current&&n.current.contains(y)?n.current:null;if(k){const T=y.getBoundingClientRect(),xe=k.getBoundingClientRect(),te=T.top-xe.top+k.scrollTop-ws;k.scrollTo({top:te,behavior:"smooth"})}else{y.scrollIntoView({behavior:"smooth",block:"start"});try{window.scrollBy({top:ws,behavior:"smooth"})}catch{}}},50)},disabled:a===0,className:"p-1.5 rounded-full bg-slate-800 hover:bg-slate-700 disabled:opacity-30 text-slate-300 transition-colors",title:"الصفحة السابقة",children:e.jsx(vr,{className:"w-4 h-4"})}),e.jsxs("span",{className:"text-xs font-mono text-slate-400 bg-slate-800 px-2 py-0.5 rounded",children:[a+1," / ",d]}),e.jsx("button",{onClick:h=>{h.stopPropagation();const j=Math.min(d-1,a+1);Ge(y=>({...y,[t]:j}));const C=j*vt,b=l[C]||l[l.length-1];b&&setTimeout(()=>{const y=Ut.current[b.id];if(!y)return;const k=n.current&&n.current.contains(y)?n.current:null;if(k){const T=y.getBoundingClientRect(),xe=k.getBoundingClientRect(),te=T.top-xe.top+k.scrollTop-ws;k.scrollTo({top:te,behavior:"smooth"})}else{y.scrollIntoView({behavior:"smooth",block:"start"});try{window.scrollBy({top:ws,behavior:"smooth"})}catch{}}},50)},disabled:a>=d-1,className:"p-1.5 rounded-full bg-slate-800 hover:bg-slate-700 disabled:opacity-30 text-slate-300 transition-colors",title:"الصفحة التالية",children:e.jsx(St,{className:"w-4 h-4"})})]})};return jt?e.jsx("div",{className:"flex items-center justify-center h-screen bg-slate-950 text-white font-sans",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Qe,{className:"w-16 h-16 animate-spin mx-auto mb-4 text-blue-400"}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"...جاري تحميل البيانات"}),e.jsx("p",{className:"text-lg text-gray-400",children:"قد يستغرق هذا بعض الوقت إذا كان حجم البيانات كبيراً"})]})}):e.jsxs("div",{className:"h-screen flex flex-col overflow-hidden bg-slate-950 text-slate-200",children:[e.jsx("input",{type:"file",ref:er,onChange:Rl,className:"hidden",accept:".json",multiple:!0}),N&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-[9999] flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2",children:[e.jsx(Ns,{className:"text-blue-500"})," استيراد بيانات (JSON)"]}),e.jsx("button",{onClick:()=>L(!1),className:"text-slate-500 hover:text-slate-300",children:e.jsx(Ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-2 uppercase tracking-wider",children:"اختر نوع المحتوى للاستيراد"}),e.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800 rounded-lg mb-4",children:[e.jsx("button",{type:"button",onClick:()=>F("websites"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${re==="websites"?"bg-blue-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"مواقع"}),e.jsx("button",{type:"button",onClick:()=>F("elements"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${re==="elements"?"bg-purple-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"عناصر"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:re==="websites"?"اختر قسم المواقع":"اختر قسم العناصر"}),e.jsx("select",{value:$e,onChange:t=>It(t.target.value),className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500 text-sm",children:as(c).filter(t=>t.type===re).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),H==="json"&&e.jsxs("div",{id:"json-import-tab",children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"لصق محتوى JSON أو ارفع ملفات."}),e.jsx("textarea",{id:"import-text",className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500 h-32 text-xs font-mono",placeholder:'[{"title": "...", "url": "..."}]'}),e.jsxs("div",{className:"flex items-center gap-2 text-xs mt-3 mb-3",children:[e.jsx("input",{id:"create-category-per-file-checkbox",type:"checkbox",className:"w-4 h-4 rounded border-slate-700 bg-slate-900 text-blue-500 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"create-category-per-file-checkbox",className:"text-slate-400 select-none",children:"إنشاء قسم لكل ملف (من اسم الملف)"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>{const t=document.getElementById("import-text").value;t&&t.trim().length>0?Qa(t):alert("الرجاء لصق كود JSON أولاً")},className:"flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-blue-600/20",children:"استيراد النص"}),e.jsxs("label",{className:"flex-1 cursor-pointer bg-purple-600 hover:bg-purple-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-purple-600/20 flex items-center justify-center gap-2",children:[e.jsx(Ns,{className:"w-5 h-5"}),e.jsx("span",{children:"رفع ملفات"}),e.jsx("input",{type:"file",className:"hidden",accept:".json",multiple:!0,onChange:Rl})]})]})]})]})}),e.jsxs("header",{className:`bg-slate-900/80 backdrop-blur-md border-b border-slate-800 py-0 px-1 flex items-center justify-between z-20 transition-all duration-300 ${Ee?"hidden":""}`,children:[e.jsx("div",{className:"flex items-center gap-1",children:e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("div",{className:"bg-gradient-to-br from-blue-600 to-cyan-400 p-0.5 rounded-md shadow-lg shadow-blue-500/20",children:e.jsx(at,{className:"w-3 h-3 text-white fill-current"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"font-black text-sm tracking-tight bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent",children:"محطة الفيديو الذكية"}),e.jsx("div",{className:"flex items-center gap-1.5 text-[9px] text-slate-500 font-medium",children:Nt.phase==="full"&&Nt.total>0?e.jsxs("span",{className:"text-blue-400 animate-pulse flex items-center gap-1",children:[e.jsx(Qe,{className:"w-2 h-2 animate-spin"}),"جاري التحديث: ",Math.round(Nt.loaded/Nt.total*100),"%"]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"bg-slate-800/50 px-1 py-0.25 rounded",children:"v2.1"}),e.jsx("span",{children:"•"}),e.jsxs("span",{children:[m.length," فيديو"]})]})})]})]})}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsxs("button",{onClick:Pl,className:"flex items-center gap-1 bg-green-600 hover:bg-green-500 text-white px-1.5 py-0.5 rounded-md text-[10px] font-bold shadow-lg shadow-green-600/20 transition-all hover:scale-105 active:scale-95",title:"تحديث البيانات من المصدر",children:[e.jsx(Qe,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"تحديث"})]}),e.jsxs("button",{onClick:()=>es(!0),className:"flex items-center gap-1 bg-purple-600 hover:bg-purple-500 text-white px-1.5 py-0.5 rounded-md text-[10px] font-bold shadow-lg shadow-purple-600/20 transition-all hover:scale-105 active:scale-95",children:[e.jsx(vs,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"بحث"})]}),e.jsxs("button",{onClick:()=>Y(!0),className:"flex items-center gap-1 bg-blue-600 hover:bg-blue-500 text-white px-1.5 py-0.5 rounded-md text-[10px] font-bold shadow-lg shadow-blue-600/20 transition-all hover:scale-105 active:scale-95",children:[e.jsx(ct,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"إضافة فيديو"})]}),e.jsxs("div",{className:"flex items-center gap-0.5 bg-slate-800/50 p-0.5 rounded-md border border-slate-700/50",children:[e.jsxs("button",{onClick:pl,className:"p-0.5 hover:bg-slate-700 rounded text-slate-300 hover:text-white transition-colors flex items-center gap-0.5",title:"السابق",children:[e.jsx(Bl,{className:"w-3 h-3"}),e.jsx("span",{className:"text-[10px] font-bold",children:"السابق"})]}),e.jsx("div",{className:"h-3 w-px bg-slate-700"}),e.jsxs("button",{onClick:He,className:"p-0.5 hover:bg-slate-700 rounded text-slate-300 hover:text-white transition-colors flex items-center gap-0.5",title:"التالي",children:[e.jsx("span",{className:"text-[10px] font-bold",children:"التالي"}),e.jsx(Yl,{className:"w-3 h-3"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>us(!Ht),className:`p-0.5 rounded-md transition-all ${Ht?"bg-orange-600/20 text-orange-400":"hover:bg-slate-800 text-orange-400"}`,title:"القائمة السريعة",children:e.jsx(hr,{className:"w-3.5 h-3.5 text-orange-400"})}),Ht&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 w-96 bg-slate-900 border border-slate-700 rounded-xl shadow-2xl z-50 overflow-hidden",children:[e.jsx("div",{className:"p-3 border-b border-slate-800 font-bold text-xs text-slate-400",children:"الوصول السريع"}),e.jsx("div",{className:"max-h-60 overflow-y-auto p-1",children:ne==="quickList"&&Oe.length>0||Ve.length>0?(ne==="quickList"?Oe:Ve).slice(0,10).map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 group",children:[e.jsxs("button",{onClick:()=>{he("quickList");const a=(Oe.length>0?Oe:Ve).findIndex(d=>d.id===t.id);S(a!==-1?a:0),_(!0),us(!1),ie(null)},className:`flex-1 text-right text-base p-2 rounded hover:bg-slate-800 truncate ${(R==null?void 0:R.id)===t.id?"text-blue-400 bg-blue-900/10":"text-slate-300"}`,children:[s+1,". ",t.title]}),e.jsx("button",{onClick:l=>{l.stopPropagation(),fs(t)},className:"p-1.5 bg-blue-600/20 hover:bg-blue-600/40 rounded-md text-blue-300 hover:text-white transition-colors opacity-0 group-hover:opacity-100",title:"إضافة إلى قائمة التشغيل",children:e.jsx(ct,{className:"w-3.5 h-3.5"})})]},t.id+"_quick_"+s)):e.jsx("div",{className:"text-center text-xs text-slate-500 py-4",children:"لا توجد عناصر في القائمة الحالية"})})]})]}),e.jsxs("div",{className:"flex items-center gap-0.5",children:[e.jsx("button",{onClick:()=>$t("list"),className:`p-0.5 rounded-md transition-all ${Ae==="list"?"bg-blue-600 text-white shadow-lg":"text-slate-400 hover:bg-slate-800"}`,title:"عرض كقائمة",children:e.jsx(Ps,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>$t("grid"),className:`p-0.5 rounded-md transition-all ${Ae==="grid"?"bg-blue-600 text-white shadow-lg":"text-slate-400 hover:bg-slate-800"}`,title:"عرض كشبكة (بطاقات)",children:e.jsx(Qs,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"h-4 w-px bg-slate-800 mx-1.5"}),e.jsx("button",{onClick:()=>{R!=null&&R.url&&cl(R.url)},disabled:!R,className:"p-0.5 rounded-md text-slate-400 hover:bg-slate-800 hover:text-blue-400 transition-all disabled:opacity-30 disabled:cursor-not-allowed",title:"فتح في نافذة خارجية",children:e.jsx(Jl,{className:"w-3.5 h-3.5"})}),e.jsxs("button",{onClick:()=>{document.fullscreenElement?document.exitFullscreen():document.documentElement.requestFullscreen().catch(t=>{console.error("Error attempting to enable full-screen mode:",t.message)})},className:"flex items-center gap-1 bg-slate-800/50 hover:bg-slate-700/80 text-slate-300 px-2 py-0.5 rounded-md text-[10px] font-bold transition-all border border-slate-700 hover:border-slate-600",title:"تبديل وضع ملء الشاشة",children:[e.jsx(mr,{className:"w-3 h-3"}),e.jsx("span",{children:"ملء الشاشة"})]}),e.jsxs("button",{onClick:()=>Ft(!0),className:"flex items-center gap-1 bg-gradient-to-r from-slate-800 to-slate-700 hover:from-slate-700 hover:to-slate-600 text-white px-2 py-0.5 rounded-md text-[10px] font-bold transition-all border border-slate-600 shadow-lg",children:[e.jsx(Qs,{className:"w-3 h-3"}),e.jsx("span",{children:"لوحة التحكم"})]}),e.jsxs("button",{onClick:()=>{const t=q.startupMode==="playlist"?"repository":"playlist";We(s=>({...s,startupMode:t})),alert(`تم تعيين وضع التشغيل الافتراضي إلى: ${t==="playlist"?"قائمة التشغيل":"قائمة التشغيل السريعة"}`)},className:"flex items-center gap-1 bg-slate-800 hover:bg-slate-700 text-slate-300 px-2 py-0.5 rounded-md text-[10px] font-bold transition-all border border-slate-700 hover:border-slate-600",title:"تبديل وضع التشغيل الافتراضي عند بدء التشغيل",children:[q.startupMode==="playlist"?e.jsx(Ps,{className:"w-3 h-3"}):e.jsx(pr,{className:"w-3 h-3"}),e.jsxs("span",{className:q.startupMode==="playlist"?"text-green-500":"text-red-500",children:["وضع البدء: ",q.startupMode==="playlist"?"قائمة التشغيل":"تشغيل سريع"]})]}),e.jsx("div",{className:"h-4 w-px bg-slate-800 mx-1.5"}),e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx("button",{onClick:Ka,className:"p-0.5 hover:bg-slate-800 rounded-md text-slate-400 hover:text-purple-400 transition-colors",title:"تحميل بيانات مخصصة",children:e.jsx(Ns,{className:"w-3 h-3"})}),e.jsx("button",{onClick:Xa,className:"p-0.5 hover:bg-slate-800 rounded-md text-slate-400 hover:text-green-400 transition-colors",title:"تصدير نسخة",children:e.jsx(Bt,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>L(!0),className:"p-0.5 hover:bg-slate-800 rounded-md text-slate-400 hover:text-blue-400 transition-colors",title:"استيراد (إضافة لبيانات حالية)",children:e.jsx(Ns,{className:"w-3 h-3"})})]}),e.jsx("div",{className:"h-4 w-px bg-slate-800 mx-1.5"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>ps(!Fe),className:`p-0.5 rounded-md transition-all ${Fe?"bg-blue-600/20 text-blue-400":"hover:bg-slate-800 text-slate-400"}`,title:"سجل المشاهدة",children:e.jsx(gr,{className:"w-3.5 h-3.5"})}),Fe&&e.jsxs("div",{className:"absolute top-full left-0 mt-2 w-80 bg-slate-900 border border-slate-700 rounded-xl shadow-2xl z-50 overflow-hidden",children:[e.jsxs("div",{className:"p-3 border-b border-slate-800 font-bold text-xs text-slate-400 flex justify-between items-center",children:[e.jsx("span",{children:"سجل المشاهدة"}),e.jsx("button",{onClick:()=>{confirm("هل تريد مسح سجل المشاهدة بالكامل؟")&&ee([])},className:"text-red-400 hover:text-red-300 text-xs",children:"مسح الكل"})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto p-1",children:Zt.length>0?Zt.map((t,s)=>e.jsxs("div",{className:"flex items-center gap-2 group p-2 hover:bg-slate-800 rounded",children:[e.jsx("button",{onClick:()=>{ys(t),ps(!1)},className:"flex-1 text-right text-xs truncate text-slate-300 hover:text-white",children:t.title}),e.jsx("button",{onClick:()=>fs(t),className:"p-1.5 bg-blue-600/20 hover:bg-blue-600/40 rounded-md text-blue-300 hover:text-white transition-colors opacity-0 group-hover:opacity-100",title:"إضافة إلى قائمة التشغيل",children:e.jsx(ct,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>{confirm("حذف هذا الفيديو من السجل؟")&&ee(l=>l.filter((a,d)=>d!==s))},className:"p-1.5 bg-red-600/20 hover:bg-red-600/40 rounded-md text-red-300 hover:text-white transition-colors opacity-0 group-hover:opacity-100",title:"حذف",children:e.jsx(Ce,{className:"w-3.5 h-3.5"})})]},t.id+"_history_"+s)):e.jsx("div",{className:"text-center text-xs text-slate-500 py-4",children:"لا يوجد سجل مشاهدة"})})]})]})]})]}),Ee&&ce&&e.jsxs("div",{className:"fixed top-0 left-0 right-0 p-4 z-50 flex justify-between items-center bg-gradient-to-b from-black/70 to-transparent",children:[e.jsx("div",{}),e.jsxs("div",{className:"absolute left-1/2 -translate-x-1/2 flex items-center gap-2 bg-black/50 rounded-full px-3 py-1 backdrop-blur-sm border border-white/10 shadow-xl",children:[e.jsx("span",{className:"text-xs text-slate-400 font-bold mr-2 hidden sm:inline",children:"Zoom:"}),e.jsx("button",{onClick:Pa,className:"p-1.5 hover:bg-white/20 text-blue-400 rounded-full transition-colors",title:"Auto Crop / Smart Zoom",children:e.jsx(br,{className:"w-4 h-4"})}),e.jsx("div",{className:"h-4 w-px bg-white/20 mx-1"}),e.jsx("button",{onClick:()=>tt(!G),className:`p-1.5 hover:bg-white/20 rounded-full transition-colors ${G?"text-green-400 bg-white/10":"text-slate-300"}`,title:"Manual Crop Mode",children:e.jsx(fr,{className:"w-4 h-4"})}),(G||ge!==1)&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:fl,className:"p-1.5 hover:bg-white/20 text-slate-300 rounded-full transition-colors",children:e.jsx(Gl,{className:"w-3 h-3"})}),e.jsxs("span",{className:"text-xs text-white w-8 text-center",children:[Math.round(ge*100),"%"]}),e.jsx("button",{onClick:bl,className:"p-1.5 hover:bg-white/20 text-slate-300 rounded-full transition-colors",children:e.jsx(ct,{className:"w-3 h-3"})}),e.jsx("button",{onClick:yl,className:"p-1.5 hover:bg-white/20 text-red-300 rounded-full transition-colors",title:"Reset",children:e.jsx(Qe,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:pl,className:"p-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-colors opacity-80",title:"السابق",children:e.jsx(Bl,{className:"w-5 h-5"})}),e.jsx("button",{onClick:He,className:"p-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-colors opacity-80",title:"التالي",children:e.jsx(Yl,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>_e(t=>!t),className:"p-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-colors opacity-80",title:"قائمة التشغيل",children:e.jsx(Ct,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>et(t=>!t),className:"p-2 bg-white/10 hover:bg-white/20 text-white rounded-full transition-colors opacity-80",title:"المستودع / القائمة السريعة",children:e.jsx(Gs,{className:"w-5 h-5"})})]})]}),Ee&&!ce&&e.jsx("div",{className:"fixed top-0 left-0 right-0 h-4 z-50 hover:h-16 transition-all duration-300 flex justify-center items-start pt-1",onMouseEnter:()=>Re(!0),children:e.jsx("div",{className:"w-24 h-1 bg-slate-700/50 rounded-full"})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[qe&&e.jsxs("aside",{className:`
            flex flex-col border-r border-slate-800 bg-slate-900/80 backdrop-blur-sm shrink-0 transition-all duration-300
            ${ve?"fixed inset-0 z-50 w-full h-full":Ae==="list"?"w-96":"w-[60vw]"}
          `,children:[e.jsxs("div",{className:"p-3 border-b border-slate-800 flex items-center justify-between sticky top-0 bg-slate-900/95 z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 font-bold text-slate-300",children:[e.jsx(Gs,{className:"w-4 h-4"}),e.jsxs("span",{children:["المستودع (",m.length,")"]}),v.length>0&&e.jsxs("span",{className:"bg-blue-600 text-white text-xs px-2 py-0.5 rounded-full",children:[v.length," محدد"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[ve&&e.jsx("button",{onClick:()=>Rt(null),className:"p-1.5 bg-green-600/20 hover:bg-green-600/40 text-green-300 rounded",title:"العودة للحالة العادية",children:e.jsx(Ws,{className:"w-5 h-5"})}),!ve&&e.jsx("button",{onClick:()=>Rt("all"),className:"p-1.5 hover:bg-blue-900/30 text-blue-400 rounded transition-colors",title:"فتح في ملء الشاشة",children:e.jsx(Wl,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>_t(t=>t==="websites"?"elements":"websites"),className:"p-1.5 hover:bg-slate-800 rounded text-xs font-mono text-slate-500 hover:text-white transition-colors",title:"تغيير العرض",children:e.jsx("span",{className:"text-red-500",children:is==="websites"?"مواقع":"عناصر"})}),v.length>0&&e.jsx("button",{onClick:()=>yt(!0),className:"p-1.5 hover:bg-blue-900/30 text-blue-400 rounded transition-colors",title:`نقل ${v.length} عنصر`,children:e.jsx(ke,{className:"w-3.5 h-3.5"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>D(!U),className:`p-1.5 rounded transition-colors ${U?"bg-slate-800 text-white":"hover:bg-red-900/30 text-slate-500 hover:text-red-400"}`,title:"خيارات إضافية",children:e.jsx(ca,{className:"w-3.5 h-3.5"})}),U&&e.jsxs("div",{className:"absolute top-full left-0 mt-1 w-40 bg-slate-900 border border-slate-700 rounded-lg shadow-xl z-50 overflow-hidden",children:[v.length>0&&e.jsxs("button",{onClick:()=>{confirm(`هل تريد حذف ${v.length} عنصر؟`)&&(El(v),V([])),D(!1)},className:"w-full text-right px-3 py-2 text-xs text-red-400 hover:bg-slate-800 hover:text-red-300 flex items-center gap-2 border-b border-slate-800",children:[e.jsx(Ce,{className:"w-3.5 h-3.5"}),e.jsxs("span",{children:["حذف المحدد (",v.length,")"]})]}),e.jsxs("button",{onClick:()=>{Ja(),D(!1)},className:"w-full text-right px-3 py-2 text-xs text-red-400 hover:bg-slate-800 hover:text-red-300 flex items-center gap-2",children:[e.jsx(Ce,{className:"w-3.5 h-3.5"}),e.jsx("span",{children:"مسح الكل"})]})]})]}),e.jsx("button",{onClick:()=>et(!1),className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 transition-colors",children:e.jsx(Ue,{className:"w-4 h-4"})})]})]}),e.jsx("div",{dir:"ltr",className:"flex-1 overflow-y-auto",ref:n,children:e.jsx("div",{dir:"rtl",className:"p-2 space-y-4",children:c.filter(t=>!t.parentId&&t.type===is).sort((t,s)=>(t.order??0)-(s.order??0)).map(t=>{var a;if(ve&&ve!=="all"&&ve!==t.id||q.displayMode==="family"&&((a=q.hiddenCategories)!=null&&a.includes(t.id)))return null;let s=m.filter(d=>d.categoryId===t.id);switch(q.itemsSortOrder){case"newest":s=s.sort((d,h)=>h.timestamp-d.timestamp);break;case"oldest":s=s.sort((d,h)=>d.timestamp-h.timestamp);break;case"alphabetical":s=s.sort((d,h)=>d.title.localeCompare(h.title));break;case"random":s=s.sort(()=>.5-Math.random());break}const l=c.filter(d=>d.parentId===t.id);return e.jsxs("div",{className:"space-y-1",onDragOver:Us,onDrop:d=>zs(d,t),children:[e.jsxs("div",{className:"flex items-center justify-between group sticky top-0 bg-slate-900/90 backdrop-blur-sm py-2 z-10 cursor-move",draggable:!0,onDragStart:d=>Vs(d,t),children:[e.jsxs("div",{className:"flex items-center gap-2 cursor-pointer hover:text-blue-400 transition-colors",onClick:()=>kl(t.id),children:[Se.includes(t.id)?e.jsx(zt,{className:"w-3 h-3 text-slate-500"}):e.jsx(St,{className:"w-3 h-3 text-slate-500"}),e.jsxs("h3",{className:`font-bold uppercase tracking-wider flex items-center gap-2 ${t.parentId?"text-xs text-slate-400":"text-base text-blue-300"}`,children:[t.id==="default"?e.jsx(Xl,{className:"w-4 h-4"}):e.jsx(ke,{className:"w-4 h-4"}),t.name,e.jsx("span",{className:"bg-slate-800 px-1.5 rounded-full text-[9px] min-w-[1.5rem] text-center",children:Ta(t.id)})]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>Rt(t.id),className:"p-1 hover:bg-blue-900/30 text-slate-600 hover:text-blue-400 rounded",title:"ملء الشاشة للقسم",children:e.jsx(Wl,{className:"w-3 h-3"})}),t.id!=="default"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>Sl(t.id),className:"p-1 hover:bg-green-900/30 text-slate-600 hover:text-green-400 rounded",children:e.jsx(at,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>_a(t.id),className:"p-1 hover:bg-purple-900/30 text-slate-600 hover:text-purple-400 rounded",children:e.jsx(Ct,{className:"w-3 h-3"})}),e.jsx("button",{onClick:()=>La(t.id),className:"p-1 hover:bg-red-900/30 text-slate-600 hover:text-red-400 rounded",children:e.jsx(Ce,{className:"w-3 h-3"})})]})]})]}),Se.includes(t.id)&&e.jsxs("div",{className:`
                          ${ve?"flex flex-col gap-4 p-4":Ae==="grid"?"flex flex-wrap gap-2 p-2":"pl-3 border-l py-1 border-slate-800 ml-1.5"}
                          ${Ae==="grid"&&!ve?"pl-0 ml-0 border-l-0":""}
                        `,children:[l.sort((d,h)=>(d.order??0)-(h.order??0)).map(d=>{var C;if(q.displayMode==="family"&&((C=q.hiddenCategories)!=null&&C.includes(d.id)))return null;let h=m.filter(b=>b.categoryId===d.id);switch(q.itemsSortOrder){case"newest":h=h.sort((b,y)=>y.timestamp-b.timestamp);break;case"oldest":h=h.sort((b,y)=>b.timestamp-y.timestamp);break;case"alphabetical":h=h.sort((b,y)=>b.title.localeCompare(y.title));break;case"random":h=h.sort(()=>.5-Math.random());break}const j=Se.includes(d.id);return e.jsxs("div",{className:"w-full flex flex-col",onDragOver:Us,onDrop:b=>zs(b,d),children:[e.jsxs("div",{className:`flex items-center justify-between group py-2 ${Ae==="grid"&&!ve?"px-2":"px-3"} bg-slate-800/50 rounded cursor-move`,draggable:!0,onDragStart:b=>Vs(b,d),children:[e.jsxs("div",{className:"flex items-center gap-2 text-base text-yellow-400 cursor-pointer hover:text-blue-400 transition-colors",onClick:()=>kl(d.id),children:[j?e.jsx(zt,{className:"w-4 h-4 text-slate-500"}):e.jsx(St,{className:"w-4 h-4 text-slate-500"}),e.jsx(ke,{className:"w-4 h-4 text-yellow-500"}),e.jsx("span",{children:d.name}),e.jsxs("span",{className:"text-xs opacity-50",children:["(",h.length,")"]})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:b=>{b.stopPropagation(),Sl(d.id)},className:"p-1.5 hover:bg-green-900/30 text-slate-600 hover:text-green-400 rounded",children:e.jsx(at,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:b=>{b.stopPropagation(),Cl(d.id)},className:"p-1.5 hover:bg-red-900/30 text-slate-600 hover:text-red-400 rounded",children:e.jsx(Ce,{className:"w-3.5 h-3.5"})})]})]}),j&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:ve?"grid grid-cols-4 gap-3 p-4":Ae==="grid"?"grid grid-cols-2 gap-2 p-2 pl-0 ml-0 border-l-0":"",children:(()=>{const y=(je[d.id]||0)*vt;return h.slice(y,y+vt).map((T,xe)=>e.jsx("div",{className:"w-full",children:e.jsx(oa,{itemIndex:y+xe,vid:T,currentVideoId:R==null?void 0:R.id,categories:c,onVideoClick:vl,onPreview:jl,onPlayNow:ys,onAddToPlaylist:fs,onEdit:Fs,onDelete:Il,onMoveToTop:Ml,onAddToFavorites:Ll,viewMode:Ae,isSelected:v.includes(T.id),setItemRef:te=>Ut.current[T.id]=te,favoriteVideoUrls:Nl})},T.id))})()}),Vl(d.id,h.length,h)]})]},d.id)}),(()=>{const h=(je[t.id]||0)*vt,j=s.slice(h,h+vt);return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:ve?"grid grid-cols-4 gap-3 p-4":Ae==="grid"?"grid grid-cols-2 gap-2 p-2 pl-0 ml-0 border-l-0":"",children:j.map((C,b)=>e.jsx("div",{className:"w-full",children:e.jsx(oa,{itemIndex:h+b,vid:C,currentVideoId:R==null?void 0:R.id,categories:c,onVideoClick:vl,onPreview:jl,onPlayNow:ys,onAddToPlaylist:fs,onEdit:Fs,onDelete:Il,onMoveToTop:Ml,onAddToFavorites:Ll,viewMode:Ae,isSelected:v.includes(C.id),setItemRef:y=>Ut.current[C.id]=y,favoriteVideoUrls:Nl})},C.id))}),Vl(t.id,s.length,s)]})})()]})]},t.id)})})})]}),!ht&&e.jsx("button",{onClick:()=>_e(!0),className:"absolute left-0 top-1/2 transform -translate-y-1/2 z-30 p-2 bg-slate-800/90 hover:bg-slate-700 rounded-r-lg transition-colors shadow-lg",title:"إظهار قائمة التشغيل",children:e.jsx(Ct,{className:"w-5 h-5 text-slate-300"})}),e.jsx("main",{className:"flex-1 flex flex-col bg-black relative",children:e.jsx(Zr,{children:e.jsx("div",{className:"flex-1 relative group w-full h-full flex items-center justify-center bg-zinc-950",children:R?e.jsx("div",{className:"w-full h-full relative",children:_l(R.url)?e.jsx("div",{id:"youtube-player-container",className:"w-full h-full"}):R.url.match(/\.(mp4|webm|ogg)$/i)?e.jsx("video",{className:"w-full h-full object-contain",src:R.url,controls:!0,autoPlay:q.autoPlay,muted:q.startMuted,loop:q.loop,onEnded:()=>q.autoPlay&&He(),onError:()=>{console.error("Error playing direct video, skipping to next."),He()}}):e.jsxs("div",{className:"w-full h-full flex flex-col",children:[e.jsxs("div",{className:"bg-slate-800 p-2 flex items-center gap-2 border-b border-slate-700",children:[e.jsxs("div",{className:"flex items-center bg-slate-900 rounded-lg p-1",children:[e.jsx("button",{onClick:()=>js("back"),className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 hover:text-white",disabled:!Ts,children:e.jsx(Ws,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>js("forward"),className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 hover:text-white",disabled:!$s,children:e.jsx(Hl,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>js("reload"),className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 hover:text-white",children:e.jsx(Qe,{className:"w-3.5 h-3.5"})}),e.jsx("button",{onClick:()=>js("home"),className:"p-1.5 hover:bg-slate-800 rounded text-slate-400 hover:text-white",children:e.jsx(Xl,{className:"w-3.5 h-3.5"})})]}),e.jsxs("form",{onSubmit:tr,className:"flex-1 flex items-center gap-2 bg-slate-900 rounded-lg px-3 py-1.5 border border-slate-700 focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500 transition-all",children:[e.jsx("div",{className:"text-slate-500",children:e.jsx(vs,{className:"w-3.5 h-3.5"})}),e.jsx("input",{type:"text",value:Me,onChange:t=>Je(t.target.value),className:"flex-1 bg-transparent border-none outline-none text-xs font-mono text-slate-300 placeholder-slate-600",placeholder:"Search or enter URL..."}),(R==null?void 0:R.url)!==Me&&e.jsx("button",{type:"submit",className:"text-blue-500 hover:text-blue-400 text-[10px] font-bold uppercase",children:"Go"}),e.jsx("button",{type:"button",onClick:()=>Wt(!0),className:"text-slate-500 hover:text-green-400",title:"حفظ الرابط الحالي",children:e.jsx(Ql,{className:"w-3.5 h-3.5"})})]})]}),e.jsxs("div",{className:"flex-1 overflow-hidden bg-white relative",onMouseDown:G?wa:Ca,onMouseMove:G?Na:Sa,onMouseUp:G?hl:ml,onMouseLeave:G?hl:ml,style:{cursor:G?"crosshair":se&&!G?rt?"grabbing":"grab":"default"},children:[e.jsx("iframe",{ref:Ie,className:"w-full h-full",style:{transform:se?`translate(${Ne.x}px, ${Ne.y}px) scale(${ge*Ds}, ${ge*ns})`:`scale(${ge})`,transformOrigin:"0 0",border:"none",pointerEvents:G||rt?"none":"auto",transition:rt?"none":"transform 0.3s ease-out"},src:ja(R.url),title:R.title,sandbox:"allow-scripts allow-same-origin allow-presentation allow-forms allow-modals",allow:"fullscreen; autoplay; encrypted-media; picture-in-picture; display-capture; web-share"}),G&&A&&e.jsx("div",{className:"absolute pointer-events-none z-40",style:{left:`${A.x}%`,top:`${A.y}%`,width:`${A.width}%`,height:`${A.height}%`,border:"3px dashed #f59e0b",backgroundColor:"rgba(245, 158, 11, 0.15)",boxShadow:"0 0 0 9999px rgba(0, 0, 0, 0.5)"},children:e.jsxs("div",{className:"absolute -top-12 left-1/2 transform -translate-x-1/2 flex gap-2 pointer-events-auto",children:[e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),va()},className:"bg-green-600 hover:bg-green-500 text-white p-2 rounded-full shadow-lg transition-transform hover:scale-110",title:"تأكيد القص",children:e.jsx(Is,{className:"w-5 h-5"})}),e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),ka()},className:"bg-red-600 hover:bg-red-500 text-white p-2 rounded-full shadow-lg transition-transform hover:scale-110",title:"إلغاء",children:e.jsx(Ue,{className:"w-5 h-5"})})]})}),G&&f&&J&&e.jsx("div",{className:"absolute pointer-events-none",style:{left:`${Math.min(f.x,J.x)}%`,top:`${Math.min(f.y,J.y)}%`,width:`${Math.abs(J.x-f.x)}%`,height:`${Math.abs(J.y-f.y)}%`,border:"3px dashed #3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",boxShadow:A?"none":"0 0 0 9999px rgba(0, 0, 0, 0.5)"},children:e.jsxs("div",{className:"absolute -bottom-8 left-0 bg-blue-600 text-white text-xs px-2 py-1 rounded",children:[Math.round(Math.abs(J.x-f.x)),"% × ",Math.round(Math.abs(J.y-f.y)),"%"]})}),G&&!f&&!A&&e.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-4 py-2 rounded-lg shadow-lg flex items-center gap-2 pointer-events-none",children:[e.jsx(yr,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-bold",children:"اسحب لرسم المستطيل"})]})]}),!Q&&(se&&!G||ge!==1&&!G)&&e.jsx("button",{onClick:()=>pe(!0),className:"absolute bottom-8 right-8 bg-slate-900/80 backdrop-blur text-white p-3 rounded-full shadow-lg border border-slate-700 hover:bg-blue-600 transition-all z-50 animate-pulse",title:"إظهار أدوات التحكم",children:e.jsx(jr,{className:"w-6 h-6"})}),Q&&(se&&!G||ge!==1&&!G)&&e.jsxs("div",{className:"absolute bottom-8 left-1/2 transform -translate-x-1/2 bg-slate-900/95 backdrop-blur-md border border-slate-700 rounded-2xl p-4 shadow-2xl z-50",children:[e.jsx("button",{onClick:()=>pe(!1),className:"absolute -top-3 -right-3 bg-slate-800 text-slate-400 hover:text-white hover:bg-red-600 rounded-full p-1 shadow-md border border-slate-700 transition-colors",title:"إخفاء الأدوات",children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{className:"text-center text-xs font-bold text-slate-400 uppercase tracking-wider mb-1",children:"ضبط يدوي"}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx("button",{onClick:()=>bs("up"),className:"p-2 bg-slate-800 hover:bg-blue-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تحريك لأعلى",children:e.jsx(da,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>bs("left"),className:"p-2 bg-slate-800 hover:bg-blue-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تحريك لليسار",children:e.jsx(Hl,{className:"w-5 h-5"})}),e.jsx("div",{className:"p-2 bg-slate-950 rounded-lg",children:e.jsx(wr,{className:"w-5 h-5 text-slate-500"})}),e.jsx("button",{onClick:()=>bs("right"),className:"p-2 bg-slate-800 hover:bg-blue-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تحريك لليمين",children:e.jsx(Ws,{className:"w-5 h-5"})})]}),e.jsx("button",{onClick:()=>bs("down"),className:"p-2 bg-slate-800 hover:bg-blue-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تحريك لأسفل",children:e.jsx(xa,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"h-px bg-slate-700 my-1"}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("button",{onClick:fl,className:"p-2 bg-slate-800 hover:bg-purple-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تصغير",children:e.jsx(Gl,{className:"w-4 h-4"})}),e.jsx("div",{className:"px-3 py-1 bg-slate-950 rounded-lg min-w-[60px] text-center",children:e.jsxs("span",{className:"text-sm font-bold text-blue-400",children:[Math.round(ge*100),"%"]})}),e.jsx("button",{onClick:bl,className:"p-2 bg-slate-800 hover:bg-purple-600 text-white rounded-lg transition-all hover:scale-110 active:scale-95",title:"تكبير",children:e.jsx(ct,{className:"w-4 h-4"})})]}),e.jsxs("button",{onClick:yl,className:"w-full py-2 bg-red-600/20 hover:bg-red-600 text-red-400 hover:text-white rounded-lg transition-all flex items-center justify-center gap-2 text-sm font-bold",title:"إعادة تعيين",children:[e.jsx(Qe,{className:"w-4 h-4"}),e.jsx("span",{children:"إعادة تعيين"})]})]})]})]})}):e.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center text-slate-700",children:[e.jsx(at,{className:"w-20 h-20 mb-4 opacity-10"}),e.jsx("p",{className:"text-lg font-medium opacity-50",children:ue==="playlist"?"القائمة فارغة، أضف فيديوهات":"اختر أقساماً للتشغيل من المستودع"})]})})})}),!qe&&e.jsx("button",{onClick:()=>et(!0),className:"fixed right-0 top-1/2 transform -translate-y-1/2 z-30 p-2 bg-slate-800/90 hover:bg-slate-700 rounded-l-lg transition-colors shadow-lg",title:"إظهار المستودع",children:e.jsx(Gs,{className:"w-5 h-5 text-slate-300"})}),ht&&e.jsxs("aside",{className:"relative w-72 border-l border-slate-800 bg-slate-900/50 flex flex-col shrink-0",children:[e.jsx("button",{onClick:()=>_e(!1),className:"absolute top-1/2 right-0 transform translate-x-1/2 -translate-y-1/2 z-30 p-2 bg-green-800/90 hover:bg-green-700 rounded-full transition-colors shadow-lg text-white",title:"إخفاء قائمة التشغيل",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5",children:e.jsx("path",{d:"m15 18-6-6 6-6"})})}),e.jsxs("div",{className:"p-4 border-b border-slate-800 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 font-bold text-slate-300",children:[e.jsx(Ct,{className:"w-4 h-4"}),e.jsx("span",{children:"قائمة التشغيل"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:Al,className:"text-[10px] text-green-400 hover:text-white border border-slate-700 hover:border-green-800 hover:bg-green-900/50 px-2 py-0.5 rounded transition-colors flex items-center gap-1",title:"حفظ القائمة الحالية",children:[e.jsx(rs,{className:"w-3 h-3"})," حفظ"]}),e.jsxs("button",{onClick:()=>Qt(!0),className:"text-[10px] text-slate-300 hover:text-white border border-slate-700 hover:bg-slate-800 px-2 py-0.5 rounded transition-colors flex items-center gap-1",title:"إدارة القوائم المحفوظة",children:[e.jsx(Kl,{className:"w-3 h-3"})," إدارة"]}),e.jsx("button",{onClick:Tl,className:"text-[10px] text-slate-500 hover:text-red-400 transition-colors",title:"مسح القائمة الحالية",children:"مسح"})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-2",children:g.length===0?e.jsx("div",{className:"h-40 flex flex-col items-center justify-center text-slate-500 text-sm text-center px-4",children:e.jsx("p",{children:"القائمة فارغة، انقر على أي فيديو من المستودع للإضافة"})}):g.map((t,s)=>e.jsx(ro,{item:t,index:s,currentIndex:ne==="playlist"?M:-1,onPlay:Ba,onRemove:za,onMove:Ya},t.playlistId))})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(ct,{className:"text-blue-500"})," إضافة فيديو جديد"]}),e.jsx("button",{onClick:()=>Y(!1),className:"text-slate-500 hover:text-slate-300",children:e.jsx(Ue,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"أقسام المواقع"}),e.jsxs("select",{value:ql.some(t=>t.id===Be)?Be:"",onChange:t=>Pt(t.target.value),className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",disabled:!0,children:"-- اختر قسم مواقع --"}),ql.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"أقسام العناصر"}),e.jsxs("select",{value:Fl.some(t=>t.id===Be)?Be:"",onChange:t=>Pt(t.target.value),className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",disabled:!0,children:"-- اختر قسم عناصر --"}),Fl.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"flex border-b border-slate-800 mb-4",children:[e.jsx("button",{onClick:()=>W("single"),className:`px-4 py-2 text-sm font-bold transition-colors ${E==="single"?"text-blue-400 border-b-2 border-blue-400":"text-slate-400 hover:text-white"}`,children:"فيديو واحد"}),e.jsx("button",{onClick:()=>W("multiple"),className:`px-4 py-2 text-sm font-bold transition-colors ${E==="multiple"?"text-blue-400 border-b-2 border-blue-400":"text-slate-400 hover:text-white"}`,children:"روابط متعددة"})]}),E==="single"&&e.jsxs("form",{onSubmit:Oa,className:"space-y-4",children:[e.jsx("input",{type:"hidden",name:"categoryId",value:Be}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"عنوان الفيديو"}),e.jsx("input",{name:"title",required:!0,autoFocus:!0,className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",placeholder:"مثال: فيديو الطبيعة الخلابة"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"الرابط (Direct / YouTube / Web)"}),e.jsx("input",{name:"url",required:!0,className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-blue-600/20",children:"حفظ الفيديو"}),e.jsx("button",{type:"button",onClick:()=>Y(!1),className:"flex-1 bg-slate-800 hover:bg-slate-700 font-bold py-3 rounded-lg transition-all",children:"إلغاء"})]})]}),E==="multiple"&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"ألصق قائمة بالروابط (كل رابط في سطر جديد). سيتم استخدام اسم الموقع كعنوان."}),e.jsx("textarea",{id:"add-multiple-links-text",className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500 h-48 text-sm",placeholder:`https://example.com/page1
https://anothersite.net/video
https://www.youtube.com/watch?v=...`}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{const t=document.getElementById("add-multiple-links-text").value;Aa(t,Be)},className:"flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-green-600/20",children:"إضافة الروابط"}),e.jsx("button",{type:"button",onClick:()=>Y(!1),className:"flex-1 bg-slate-800 hover:bg-slate-700 font-bold py-3 rounded-lg transition-all",children:"إلغاء"})]})]})]})}),cs&&Ye&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(Ks,{className:"text-blue-500"})," تعديل بيانات الفيديو"]}),e.jsxs("form",{onSubmit:Ea,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"عنوان الفيديو"}),e.jsx("input",{name:"title",required:!0,autoFocus:!0,defaultValue:Ye.title,className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",placeholder:"مثال: فيديو الطبيعة الخلابة"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"الرابط (Direct / YouTube / Web)"}),e.jsx("input",{name:"url",required:!0,defaultValue:Ye.url,className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"القسم"}),e.jsx("select",{name:"categoryId",defaultValue:Ye.categoryId||"default",className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",children:as(c).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-blue-600/20",children:"حفظ التعديلات"}),e.jsx("button",{type:"button",onClick:()=>{gt(!1),At(null)},className:"flex-1 bg-slate-800 hover:bg-slate-700 font-bold py-3 rounded-lg transition-all",children:"إلغاء"})]})]})]})}),st&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-md shadow-2xl",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(Ql,{className:"text-green-500"})," حفظ الرابط إلى المستودع"]}),e.jsxs("form",{onSubmit:Ma,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"عنوان الصفحة"}),e.jsx("input",{name:"title",required:!0,autoFocus:!0,className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",placeholder:"أدخل عنوان الصفحة..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"الرابط"}),e.jsx("input",{type:"text",value:ds||Me,readOnly:!0,className:"w-full bg-slate-700 border-none rounded-lg p-3 outline-none ring-1 ring-slate-600 text-slate-400"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-slate-500 mb-1 uppercase tracking-wider",children:"القسم"}),e.jsx("select",{name:"categoryId",className:"w-full bg-slate-800 border-none rounded-lg p-3 outline-none ring-1 ring-slate-700 focus:ring-2 focus:ring-blue-500",children:as(c).map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{type:"submit",className:"flex-1 bg-green-600 hover:bg-green-500 text-white font-bold py-3 rounded-lg transition-all shadow-lg shadow-green-600/20",children:"حفظ الرابط"}),e.jsx("button",{type:"button",onClick:()=>Wt(!1),className:"flex-1 bg-slate-800 hover:bg-slate-700 font-bold py-3 rounded-lg transition-all",children:"إلغاء"})]})]})]})}),Rs&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl",children:[e.jsxs("h2",{className:"text-xl font-bold mb-4 flex items-center gap-2",children:[e.jsx(Kl,{className:"text-purple-500"})," إدارة قوائم التشغيل"]}),e.jsx("div",{className:"mb-4 space-y-2 max-h-60 overflow-y-auto p-2 bg-slate-800/20 rounded-lg",children:Ot.length===0?e.jsx("div",{className:"text-center text-slate-500 py-4",children:"لا توجد قوائم محفوظة"}):Ot.map(t=>e.jsxs("div",{className:"flex items-center gap-2 p-2 bg-slate-800 rounded-lg",children:[e.jsxs("div",{className:"flex-1 cursor-pointer",onClick:()=>Ys(t.id),children:[e.jsx("div",{className:"font-bold text-sm",children:t.name}),e.jsxs("div",{className:"text-xs text-slate-500",children:[t.items.length," فيديو"]})]}),e.jsxs("button",{onClick:()=>Ys(t.id),className:"p-1.5 px-3 bg-green-600/20 hover:bg-green-600/40 rounded-md text-green-300 hover:text-white transition-colors flex items-center gap-1.5 text-xs",title:"فتح القائمة",children:[e.jsx(at,{className:"w-3 h-3"})," فتح"]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),Ol(t.id)},className:"p-1.5 text-slate-500 hover:bg-red-900/30 hover:text-red-400 rounded-md",title:"حذف القائمة",children:e.jsx(Ce,{className:"w-4 h-4"})})]},t.id))}),e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:sr,className:"flex-1 bg-green-700 hover:bg-green-600 text-white font-bold py-2 rounded-lg transition-all text-xs",children:"حفظ قائمة التشغيل السريع"}),e.jsx("button",{onClick:()=>Qt(!1),className:"flex-1 bg-slate-800 hover:bg-slate-700 font-bold py-2 rounded-lg transition-all text-xs",children:"إغلاق"})]})})]})}),ye&&e.jsx("div",{className:"fixed inset-0 bg-black/80 backdrop-blur-md z-[100] flex items-center justify-center p-6 overflow-y-auto",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-3xl p-8 w-full max-w-3xl shadow-2xl text-right",children:[e.jsx("h2",{className:"text-3xl font-black mb-6 bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",children:"دليل تشغيل المحطة"}),e.jsxs("div",{className:"space-y-6 text-slate-300",children:[e.jsxs("section",{className:"bg-slate-800/40 p-5 rounded-2xl border border-white/5",children:[e.jsxs("h3",{className:"font-bold text-blue-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs",children:"1"}),"المستودع (المخزن الرئيسي)"]}),e.jsx("p",{className:"text-sm leading-relaxed",children:"ابدأ بإضافة روابط الفيديوهات إلى المستودع. يمكنك إضافة روابط مباشرة (mp4, webm)، أو روابط يوتيوب، أو حتى روابط صفحات ويب عادية. المستودع يُحفظ تلقائياً في متصفحك."})]}),e.jsxs("section",{className:"bg-slate-800/40 p-5 rounded-2xl border border-white/5",children:[e.jsxs("h3",{className:"font-bold text-blue-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs",children:"2"}),"قائمة التشغيل (Playlist)"]}),e.jsx("p",{className:"text-sm leading-relaxed",children:'انقر على الفيديوهات الموجودة في المستودع لإضافتها إلى قائمة التشغيل. سيقوم التطبيق بتشغيل الفيديوهات في القائمة واحداً تلو الآخر بناءً على "المدة" المحددة في الإعدادات.'})]}),e.jsxs("section",{className:"bg-slate-800/40 p-5 rounded-2xl border border-white/5",children:[e.jsxs("h3",{className:"font-bold text-blue-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-blue-500/20 flex items-center justify-center text-xs",children:"3"}),"إعدادات التشغيل التلقائي"]}),e.jsx("p",{className:"text-sm leading-relaxed",children:'من الشريط السفلي، حدد مدة عرض كل فيديو. عند تفعيل "تشغيل تلقائي"، سينتقل المشغل للفيديو التالي بمجرد انتهاء الوقت المحدد، حتى لو لم ينتهِ الفيديو الأصلي. هذا مفيد جداً للمراقبة أو العروض التقديمية.'})]}),e.jsxs("section",{className:"bg-slate-800/40 p-5 rounded-2xl border border-white/5",children:[e.jsxs("h3",{className:"font-bold text-green-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center text-xs",children:"4"}),"ميزات المتصفح المدمج"]}),e.jsx("p",{className:"text-sm leading-relaxed mb-2",children:"عند تشغيل صفحات الويب، يظهر شريط تنقل متقدم يتيح لك:"}),e.jsxs("ul",{className:"text-xs space-y-1 mr-4 list-disc",children:[e.jsx("li",{children:"التنقل للأمام والخلف بين الصفحات"}),e.jsx("li",{children:"تحديث الصفحة أو العودة للصفحة الرئيسية"}),e.jsx("li",{children:"إدخال عنوان URL جديد للتصفح داخل الإطار"}),e.jsx("li",{children:"التحكم في التكبير/التصغير (50% - 300%)"}),e.jsx("li",{children:"تفعيل وضع ملء الشاشة للإطار نفسه (زر Maximize)"}),e.jsx("li",{children:"فتح الرابط في تبويب جديد خارج التطبيق"}),e.jsx("li",{className:"text-green-400 font-bold",children:"⭐ فتح في نافذة منفصلة (زر أخضر) - للتحكم الكامل بالفيديو والروابط!"})]})]}),e.jsxs("section",{className:"bg-gradient-to-br from-purple-900/40 to-pink-900/40 p-5 rounded-2xl border border-purple-500/30",children:[e.jsxs("h3",{className:"font-bold text-purple-300 mb-3 flex items-center gap-2",children:[e.jsx("span",{className:"w-6 h-6 rounded-full bg-purple-500/30 flex items-center justify-center text-xs",children:"5"}),"⚠️ مشكلة تكبير الفيديو الداخلي والحل"]}),e.jsxs("div",{className:"text-sm leading-relaxed space-y-3",children:[e.jsxs("div",{className:"bg-red-900/30 border border-red-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-red-300 font-bold text-xs mb-1",children:"❌ المشكلة:"}),e.jsx("p",{className:"text-xs text-red-200",children:"بسبب قيود أمان المتصفح، لا يمكن تكبير الفيديو الموجود داخل صفحة ويب معروضة في إطار (iframe). عند الضغط على زر ملء الشاشة داخل الفيديو، لن يستجيب."})]}),e.jsxs("div",{className:"bg-green-900/30 border border-green-500/30 rounded-lg p-3",children:[e.jsx("p",{className:"text-green-300 font-bold text-xs mb-1",children:"✅ الحل الأمثل:"}),e.jsxs("p",{className:"text-xs text-green-200",children:["استخدم زر ",e.jsx(Nr,{className:"w-3 h-3 inline text-green-400"})," ",e.jsx("strong",{className:"text-green-400",children:"(النافذة المنفصلة - الزر الأخضر)"}),"لفتح الصفحة في نافذة متصفح منفصلة. هذا يتيح لك:"]}),e.jsxs("ul",{className:"text-[10px] text-green-100 mt-2 mr-4 space-y-1 list-disc",children:[e.jsx("li",{children:"تكبير الفيديو بملء الشاشة بشكل طبيعي"}),e.jsx("li",{children:"النقر على جميع الروابط والأزرار"}),e.jsx("li",{children:"التحكم الكامل كأنك في متصفح عادي"})]})]}),e.jsx("p",{className:"text-[10px] text-slate-400 italic",children:"💡 نصيحة: لفيديوهات YouTube، استخدم زر ملء الشاشة في مشغل YouTube مباشرة (يعمل بدون مشاكل)"})]})]}),e.jsxs("section",{className:"bg-slate-800/40 p-5 rounded-2xl border border-white/5",children:[e.jsxs("h3",{className:"font-bold text-red-400 mb-2 flex items-center gap-2",children:[e.jsx(Jl,{className:"w-5 h-5"})," تنبيه حول سياسة الأمان (CORS)"]}),e.jsx("p",{className:"text-xs leading-relaxed opacity-70",children:"عند تشغيل روابط لمواقع ويب خارجية (مثل Google)، قد لا تظهر بعض الصفحات بسبب سياسات الأمان في المتصفح التي تمنع عرض المواقع داخل إطار (Iframe). ننصح باستخدام روابط مباشرة أو روابط تدعم الـ Embedding."})]})]}),e.jsx("button",{onClick:()=>ze(!1),className:"mt-8 w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 text-white font-black py-4 rounded-2xl transition-all shadow-xl shadow-blue-600/20 uppercase tracking-widest",children:"فهمت، لنبدأ الآن"})]})}),fa&&e.jsx("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-slate-900 border border-slate-800 rounded-2xl p-6 w-full max-w-lg shadow-2xl",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h2",{className:"text-xl font-bold flex items-center gap-2 text-white",children:[e.jsx(vs,{className:"w-6 h-6 text-purple-500"})," بحث"]}),e.jsx("button",{onClick:()=>es(!1),className:"text-slate-500 hover:text-white transition-colors",children:e.jsx(Ue,{className:"w-6 h-6"})})]}),e.jsxs("form",{onSubmit:Ga,className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 p-1 bg-slate-800 rounded-lg",children:[e.jsx("button",{type:"button",onClick:()=>ol("local"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${ts==="local"?"bg-purple-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"المستودع"}),e.jsx("button",{type:"button",onClick:()=>ol("google"),className:`flex-1 py-2 px-4 rounded-md text-sm font-bold transition-all ${ts==="google"?"bg-blue-600 text-white shadow":"text-slate-400 hover:text-white"}`,children:"Google"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",autoFocus:!0,value:Vt,onChange:t=>_s(t.target.value),className:"w-full bg-slate-800 border border-slate-700 rounded-lg py-3 px-4 pl-10 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 text-right",placeholder:ts==="local"?"ابحث عن فيديو...":"ابحث في جوجل...",dir:"auto"}),e.jsx(vs,{className:"absolute left-3 top-3.5 text-slate-500 w-5 h-5"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{type:"button",onClick:()=>es(!1),className:"px-4 py-2 text-slate-400 hover:text-white font-medium",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"px-6 py-2 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 text-white font-bold rounded-lg shadow-lg shadow-purple-900/20",children:"بحث"})]})]}),ts==="local"&&As.length>0&&e.jsxs("div",{className:"mt-4 max-h-60 overflow-y-auto border-t border-slate-800 pt-2",children:[e.jsxs("p",{className:"text-xs text-slate-500 mb-2",children:["نتائج البحث (",As.length,")"]}),e.jsx("div",{className:"space-y-1",children:As.map(t=>{const s=c.find(l=>l.id===t.categoryId);return e.jsxs("button",{onClick:()=>Wa(t),className:"w-full flex items-center justify-between p-2 hover:bg-slate-800 rounded-lg group text-right",children:[e.jsxs("div",{className:"flex-1 truncate",children:[e.jsx("div",{className:"text-sm text-slate-300 group-hover:text-white truncate",children:t.title}),e.jsxs("div",{className:"text-[10px] text-slate-500 truncate flex items-center gap-1",children:[e.jsx(ke,{className:"w-3 h-3"}),s?s.name:"غير مصنف"]})]}),e.jsx(at,{className:"w-4 h-4 text-slate-600 group-hover:text-purple-400 opacity-0 group-hover:opacity-100 transition-all"})]},t.id)})})]})]})}),ft&&e.jsx(to,{isOpen:ft,quickList:Oe,setQuickList:Kt,playbackTarget:ne,setPlaybackTarget:he,onClose:Va,settings:q,setSettings:We,playlist:g,setPlaylist:$,setCurrentIndex:S,repository:m,categories:c,loadSavedPlaylist:Ys,savedPlaylists:Ot,deleteSavedPlaylist:Ol,saveCurrentAsPlaylist:Al,setRepository:p,addCategory:Da,renameCategory:$a,deleteCategoryRecursive:Cl,clearPlaylist:Tl,viewMode:Ae,setViewMode:$t,handleReorderCategories:Ra,handleDeleteItems:El,handleMoveItems:Fa,handlePreviewItem:Ua,handleEditVideo:Fs,setEditingVideo:At,setShowEditModal:gt,showItemManagementModal:hs,setShowItemManagementModal:yt,initialSelectedItems:v,setInitialSelectedItems:V,handleCatDragStart:Vs,handleCatDragOver:Us,handleCatDrop:zs,handleManualSync:Pl,handleExportSingleCategory:qa,onExportSingle:xl,onExportZip:ul,onExportQuickLoad:Ha}),e.jsx(so,{isOpen:ya,onClose:()=>il(!1),onExportSingle:xl,onExportZip:ul})]})},ba=document.getElementById("root");if(!ba)throw new Error("Could not find root element to mount to");const no=Pr.createRoot(ba);no.render(e.jsx(Pe.StrictMode,{children:e.jsx(Dr,{children:e.jsx(oo,{})})}));
